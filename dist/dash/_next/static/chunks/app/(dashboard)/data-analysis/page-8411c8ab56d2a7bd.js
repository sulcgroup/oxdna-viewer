(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[376],{18623:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>q});var s=r(69298),a=r(12488),n=r(83130),l=r(87849),o=r(95715),i=r(33315),c=r(15893),d=r(88922),u=r(26181),h=r(62232),m=r(79242),x=r(8463),f=r(26164);let p={light:"",dark:".dark"},j=n.createContext(null);function g(){let e=n.useContext(j);if(!e)throw Error("useChart must be used within a <ChartContainer />");return e}let v=n.forwardRef((e,t)=>{let{id:r,className:a,children:l,config:i,...c}=e,d=n.useId(),u="chart-".concat(r||d.replace(/:/g,""));return(0,s.jsx)(j.Provider,{value:{config:i},children:(0,s.jsxs)("div",{"data-chart":u,ref:t,className:(0,f.cn)("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",a),...c,children:[(0,s.jsx)(b,{id:u,config:i}),(0,s.jsx)(o.u,{children:l})]})})});v.displayName="Chart";let b=e=>{let{id:t,config:r}=e,a=Object.entries(r).filter(e=>{let[,t]=e;return t.theme||t.color});return a.length?(0,s.jsx)("style",{dangerouslySetInnerHTML:{__html:Object.entries(p).map(e=>{let[r,s]=e;return"\n".concat(s," [data-chart=").concat(t,"] {\n").concat(a.map(e=>{var t;let[s,a]=e,n=(null==(t=a.theme)?void 0:t[r])||a.color;return n?"  --color-".concat(s,": ").concat(n,";"):null}).join("\n"),"\n}\n")}).join("\n")}}):null};h.m;let y=n.forwardRef((e,t)=>{let{active:r,payload:a,className:l,indicator:o="dot",hideLabel:i=!1,hideIndicator:c=!1,label:d,labelFormatter:u,labelClassName:h,formatter:m,color:x,nameKey:p,labelKey:j}=e,{config:v}=g(),b=n.useMemo(()=>{var e;if(i||!(null==a?void 0:a.length))return null;let[t]=a,r="".concat(j||t.dataKey||t.name||"value"),n=N(v,t,r),l=j||"string"!=typeof d?null==n?void 0:n.label:(null==(e=v[d])?void 0:e.label)||d;return u?(0,s.jsx)("div",{className:(0,f.cn)("font-medium",h),children:u(l,a)}):l?(0,s.jsx)("div",{className:(0,f.cn)("font-medium",h),children:l}):null},[d,u,a,i,h,v,j]);if(!r||!(null==a?void 0:a.length))return null;let y=1===a.length&&"dot"!==o;return(0,s.jsxs)("div",{ref:t,className:(0,f.cn)("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",l),children:[y?null:b,(0,s.jsx)("div",{className:"grid gap-1.5",children:a.map((e,t)=>{let r="".concat(p||e.name||e.dataKey||"value"),a=N(v,e,r),n=x||e.payload.fill||e.color;return(0,s.jsx)("div",{className:(0,f.cn)("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground","dot"===o&&"items-center"),children:m&&(null==e?void 0:e.value)!==void 0&&e.name?m(e.value,e.name,e,t,e.payload):(0,s.jsxs)(s.Fragment,{children:[(null==a?void 0:a.icon)?(0,s.jsx)(a.icon,{}):!c&&(0,s.jsx)("div",{className:(0,f.cn)("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":"dot"===o,"w-1":"line"===o,"w-0 border-[1.5px] border-dashed bg-transparent":"dashed"===o,"my-0.5":y&&"dashed"===o}),style:{"--color-bg":n,"--color-border":n}}),(0,s.jsxs)("div",{className:(0,f.cn)("flex flex-1 justify-between leading-none",y?"items-end":"items-center"),children:[(0,s.jsxs)("div",{className:"grid gap-1.5",children:[y?b:null,(0,s.jsx)("span",{className:"text-muted-foreground",children:(null==a?void 0:a.label)||e.name})]}),e.value&&(0,s.jsx)("span",{className:"font-mono font-medium tabular-nums text-foreground",children:e.value.toLocaleString()})]})]})},e.dataKey)})})]})});y.displayName="ChartTooltip",m.s;let w=n.forwardRef((e,t)=>{let{className:r,hideIcon:a=!1,payload:n,verticalAlign:l="bottom",nameKey:o}=e,{config:i}=g();return(null==n?void 0:n.length)?(0,s.jsx)("div",{ref:t,className:(0,f.cn)("flex items-center justify-center gap-4","top"===l?"pb-3":"pt-3",r),children:n.map(e=>{let t="".concat(o||e.dataKey||"value"),r=N(i,e,t);return(0,s.jsxs)("div",{className:(0,f.cn)("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[(null==r?void 0:r.icon)&&!a?(0,s.jsx)(r.icon,{}):(0,s.jsx)("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:e.color}}),null==r?void 0:r.label]},e.value)})}):null});function N(e,t,r){if("object"!=typeof t||null===t)return;let s="payload"in t&&"object"==typeof t.payload&&null!==t.payload?t.payload:void 0,a=r;return r in t&&"string"==typeof t[r]?a=t[r]:s&&r in s&&"string"==typeof s[r]&&(a=s[r]),a in e?e[a]:e[r]}w.displayName="ChartLegend";var k=r(41694),S=r(92839),E=r(16631),F=r(42077);let C=n.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(E.bL,{ref:t,className:(0,f.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...a,children:(0,s.jsx)(E.C1,{className:(0,f.cn)("flex items-center justify-center text-current"),children:(0,s.jsx)(F.A,{className:"h-4 w-4"})})})});C.displayName=E.bL.displayName;var _=r(71183);let I={potential:!0,kinetic:!1,total:!1},L={potential:{label:"Potential",color:"hsl(var(--chart-1))"},kinetic:{label:"Kinetic",color:"hsl(var(--chart-2))"},total:{label:"Total",color:"hsl(var(--chart-3))"}};function D(e){let{jobId:t}=e,[r,a]=(0,n.useState)([]),[f,p]=(0,n.useState)(!0),[j,g]=(0,n.useState)(I),{toast:b}=(0,S.dj)();return((0,n.useEffect)(()=>{!async function(){if(t){p(!0);try{let e=await l.F.getEnergyData(t);if(e.time&&e.time.length>0){let t=e.time.map((t,r)=>({time:t,potential:e.potential[r],kinetic:e.kinetic[r],total:e.total[r]}));a(t)}else a([])}catch(e){console.error("Failed to fetch energy data:",e),b({title:"Error",description:"Could not fetch energy data.",variant:"destructive"})}finally{p(!1)}}}()},[t,b]),f)?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-6 pl-4",children:[(0,s.jsx)(k.E,{className:"h-6 w-24"}),(0,s.jsx)(k.E,{className:"h-6 w-24"}),(0,s.jsx)(k.E,{className:"h-6 w-24"})]}),(0,s.jsx)(k.E,{className:"h-[400px] w-full"})]}):0===r.length?(0,s.jsx)("p",{className:"text-center text-muted-foreground py-10",children:"No energy data available for this job."}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"flex items-center space-x-6 pl-4",children:Object.keys(j).map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(C,{id:e,checked:j[e],onCheckedChange:t=>{g(r=>({...r,[e]:!!t}))}}),(0,s.jsx)(_.J,{htmlFor:e,className:"capitalize",style:{color:L[e].color},children:L[e].label})]},e))}),(0,s.jsx)(v,{config:L,className:"aspect-video h-[400px] w-full",children:(0,s.jsx)(o.u,{width:"100%",height:"100%",children:(0,s.jsxs)(i.b,{data:r,margin:{top:5,right:30,left:20,bottom:20},children:[(0,s.jsx)(c.d,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),(0,s.jsx)(d.W,{dataKey:"time",type:"number",domain:["dataMin","dataMax"],tickFormatter:e=>e.toLocaleString(),stroke:"hsl(var(--foreground))",tickLine:{stroke:"hsl(var(--foreground))"},label:{value:"Time / Step",position:"insideBottom",offset:-15}}),(0,s.jsx)(u.h,{stroke:"hsl(var(--foreground))",tickLine:{stroke:"hsl(var(--foreground))"},tickFormatter:e=>e.toPrecision(4),label:{value:"Energy",angle:-90,position:"insideLeft"}}),(0,s.jsx)(h.m,{content:(0,s.jsx)(y,{indicator:"dot"}),cursor:{stroke:"hsl(var(--accent))",strokeWidth:1.5},wrapperStyle:{outline:"none"}}),(0,s.jsx)(m.s,{content:(0,s.jsx)(w,{})}),j.potential&&(0,s.jsx)(x.N,{type:"monotone",dataKey:"potential",stroke:L.potential.color,strokeWidth:2,dot:!1,activeDot:{r:6}}),j.kinetic&&(0,s.jsx)(x.N,{type:"monotone",dataKey:"kinetic",stroke:L.kinetic.color,strokeWidth:2,dot:!1,activeDot:{r:6}}),j.total&&(0,s.jsx)(x.N,{type:"monotone",dataKey:"total",stroke:L.total.color,strokeWidth:2,dot:!1,activeDot:{r:6}})]})})})]})}var P=r(79717),A=r(91238),J=r(22374),R=r(46583),W=r(40567),B=r.n(W),K=r(28330),T=r(71612),Z=r(73854),M=r(93013);function O(e){let{jobId:t}=e,[r,a]=(0,n.useState)(null),[o,i]=(0,n.useState)(null),[c,d]=(0,n.useState)(!1),[u,h]=(0,n.useState)(!1),[m,x]=(0,n.useState)(null);return(0,n.useEffect)(()=>{c&&(async()=>{if(t){h(!0),x(null);try{if(!r){let{files:e}=await l.F.listJobFiles(t),r=e.find(e=>e.endsWith(".top"));if(r){let e=await l.F.downloadFile(t,r);a(new File([e],r))}else throw Error("Topology file (.top) not found.")}let e="last_conf.dat",s=await l.F.downloadFile(t,e);i(new File([s],e))}catch(e){x(e instanceof Error?e.message:"An unknown error occurred."),console.error(e)}finally{h(!1)}}})()},[t,c,r]),(0,s.jsxs)(P.Zp,{children:[(0,s.jsx)(P.aR,{children:(0,s.jsx)(P.ZB,{children:"Configuration Preview"})}),(0,s.jsxs)(P.Wu,{children:[!c&&(0,s.jsx)(R.$,{onClick:()=>d(!0),children:"View Last Configuration"}),c&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(R.$,{onClick:()=>d(!1),variant:"outline",className:"mb-4",children:"Hide Preview"}),(0,s.jsx)(T.Separator,{className:"my-4"}),u&&(0,s.jsx)("p",{children:"Loading preview..."}),m&&(0,s.jsx)("p",{className:"text-red-500",children:m}),!u&&!m&&r&&o&&(0,s.jsx)(M.b,{topFile:r,datFile:o,height:"600px"}),!u&&!m&&(!r||!o)&&(0,s.jsx)("p",{children:"Could not load configuration files for preview."})]})]})]})}var V=r(39618),$=r(47462),H=r(55806),U=r(79309);function z(e){let{jobId:t}=e,[r,a]=(0,n.useState)(null),[o,i]=(0,n.useState)(null),[c,d]=(0,n.useState)(null),[u,h]=(0,n.useState)(""),[m,x]=(0,n.useState)(!1),[f,p]=(0,n.useState)(!1),[j,g]=(0,n.useState)(null),{toast:v}=(0,S.dj)();(0,n.useEffect)(()=>{m&&(async()=>{if(!t)return console.error("fetchFiles called with no jobId.");p(!0),g(null);try{if(!r){let{files:e}=await l.F.listJobFiles(t),r=e.find(e=>e.endsWith(".top"));if(r){let e=await l.F.downloadFile(t,r);a(new File([e],r))}else throw Error("Topology file (.top) not found.")}let e="last_conf.dat",s=await l.F.downloadFile(t,e);i(new File([s],e))}catch(e){g(e instanceof Error?e.message:"An unknown error occurred."),console.error("Error during file fetching:",e)}finally{p(!1)}})()},[t,m,r]),(0,n.useEffect)(()=>{let e=e=>{if(e.origin!==window.location.origin)return void console.log("Message from unknown origin (".concat(e.origin,") blocked."));let{type:t,data:r}=e.data;"oxViewJsonFile"===t&&(d(r),v({title:"Success",description:"Structure data captured from oxView."}))};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[v]);let b=async()=>{if(!c){console.error("handleSave error: No oxViewJson data available."),v({title:"Error",description:"No structure data to save.",variant:"destructive"});return}if(!u.trim()){console.error("handleSave error: No structure name provided."),v({title:"Error",description:"Please enter a name for the structure.",variant:"destructive"});return}try{let e=V.yH,t=(0,U.Kc)(c,{level:9}),r=crypto.randomUUID(),s=crypto.randomUUID(),n={data:t.buffer,commitName:"Initial commit",commitId:s,parent:null},l={id:r,structure:[n],date:Date.now(),structureName:u.trim(),branches:{main:[s]}};await e.structureData.put(l),v({title:"Success!",description:'Structure "'.concat(u.trim(),'" saved to your local library.')}),x(!1),d(null),h(""),a(null),i(null)}catch(e){console.error("Error saving structure to DexieDB:",e),v({title:"Error",description:"Failed to save structure to the library.",variant:"destructive"})}};return(0,s.jsxs)(P.Zp,{children:[(0,s.jsxs)(P.aR,{children:[(0,s.jsx)(P.ZB,{children:"Save to Strucutre Library"}),(0,s.jsx)(P.BT,{children:"Save the final configuration of this job as a new structure in your strucutre library."})]}),(0,s.jsxs)(P.Wu,{children:[!m&&(0,s.jsxs)(R.$,{onClick:()=>{x(!0)},children:[(0,s.jsx)($.A,{className:"mr-2 h-4 w-4"}),"Save Last Conformation to Library"]}),f&&(0,s.jsx)("p",{children:"Loading configuration files..."}),j&&(0,s.jsx)("p",{className:"text-red-500",children:j}),r&&o&&(0,s.jsx)("div",{style:{display:"none"},children:(0,s.jsx)(M.b,{topFile:r,datFile:o,postLoadCommand:"makeOxViewJsonFile('temp', null, true, '".concat(window.location.origin,"')")})}),c&&(0,s.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"structureName",className:"block text-sm font-medium text-gray-700",children:"Please input the name of the strucutre for the library"}),(0,s.jsx)("input",{type:"text",id:"structureName",value:u,onChange:e=>h(e.target.value),placeholder:"e.g., Duplex Last Conf",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"})]}),(0,s.jsxs)(R.$,{onClick:b,children:[(0,s.jsx)(H.A,{className:"mr-2 h-4 w-4"}),"Commit to Library"]})]})]})]})}function q(){let e=(0,a.useSearchParams)().get("jobId");return e?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{children:[(0,s.jsx)(R.$,{variant:"outline",size:"sm",asChild:!0,className:"mb-2",children:(0,s.jsxs)(B(),{href:"/job-status",children:[(0,s.jsx)(K.A,{className:"mr-2 h-4 w-4"}),"Back to Job Status"]})}),(0,s.jsx)("h1",{className:"text-3xl font-bold tracking-tight font-headline",children:"Analysis for Job"}),(0,s.jsxs)("p",{className:"text-muted-foreground font-code text-sm",children:["Job ID: ",e]})]})}),(0,s.jsxs)(P.Zp,{className:"shadow-lg",children:[(0,s.jsx)(P.aR,{children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(A.A,{className:"h-8 w-8 text-primary"}),(0,s.jsxs)("div",{children:[(0,s.jsx)(P.ZB,{className:"text-2xl font-headline",children:"Energy"}),(0,s.jsx)(P.BT,{children:"Visualization of potential, kinetic, and total energy data from the simulation."})]})]})}),(0,s.jsx)(P.Wu,{children:e?(0,s.jsx)(D,{jobId:e}):(0,s.jsx)("p",{children:"Job ID not found."})})]}),e&&(0,s.jsx)(O,{jobId:e}),e&&(0,s.jsx)(z,{jobId:e}),(0,s.jsx)(T.Separator,{}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(J.A,{className:"h-8 w-8 text-primary"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold tracking-tight font-headline",children:"Data Analysis"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Run post-simulation analysis protocols on your job's output files."})]})]}),(0,s.jsx)(P.Zp,{className:"shadow-lg",children:(0,s.jsx)(P.Wu,{className:"pt-6",children:e?(0,s.jsx)(Z.default,{jobId:e}):(0,s.jsx)("p",{children:"Job ID not found."})})})]})]}):(0,s.jsxs)("div",{className:"space-y-6 text-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold tracking-tight font-headline mt-8",children:"Job Not Specified"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Please return to the Job Status page and select a job to view its data."}),(0,s.jsx)(R.$,{variant:"outline",asChild:!0,children:(0,s.jsxs)(B(),{href:"/job-status",children:[(0,s.jsx)(K.A,{className:"mr-2 h-4 w-4"}),"Back to Job Status"]})})]})}},39618:(e,t,r)=>{"use strict";r.d(t,{yH:()=>n});var s=r(38063);class a extends s.Ay{constructor(){super("Structures"),this.version(1).stores({structureData:"id, structureName, isSynced, syncedProjectId, isRemote, publicSourceId, isPublic",remoteStructureData:"id, structureName, isSynced, syncedProjectId, isRemote, publicSourceId, isPublic",temporaryStructure:"id"})}}let n=new a},41694:(e,t,r)=>{"use strict";r.d(t,{E:()=>n});var s=r(69298),a=r(26164);function n(e){let{className:t,...r}=e;return(0,s.jsx)("div",{className:(0,a.cn)("animate-pulse rounded-md bg-muted",t),...r})}},41808:(e,t,r)=>{Promise.resolve().then(r.bind(r,18623))},93013:(e,t,r)=>{"use strict";r.d(t,{b:()=>o});var s=r(69298),a=r(83130),n=r(79717);let l=e=>e?/^[0-9,\s]*$/.test(e)?e.split(",").map(e=>parseInt(e.trim(),10)).filter(e=>!isNaN(e)):(console.warn("Invalid characters in nucleotideIndexes. Aborting script generation."),[]):[];function o(e){let{topFile:t,datFile:r,nucleotideIndexes0:o,nucleotideIndexes1:i,height:c="500px",postLoadCommand:d}=e,u=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let e=u.current;if(!(null==e?void 0:e.contentWindow))return;let s=()=>{var s;let a=[{file:t,ext:"top"},{file:r,ext:"dat"}],n=a.map(e=>new Blob([e.file],{type:"text/plain"})),c=a.map(e=>e.ext),u=[],h=l(o);h.length>0&&u.push("colorElements(new THREE.Color(1, 0, 0), api.getElements([".concat(h.join(","),"]))"));let m=l(i);if(m.length>0&&u.push("colorElements(new THREE.Color(0, 0, 1), api.getElements([".concat(m.join(","),"]))")),d&&u.push(d),u.length>0){let e=u.join(";\n");n.push(new Blob([e],{type:"application/javascript"})),c.push("js")}null==(s=e.contentWindow)||s.postMessage({message:"iframe_drop",files:n,ext:c,inbox_settings:["Monomer","Origin"]},"/")};return e.addEventListener("load",s),()=>{e.removeEventListener("load",s)}},[t,r,o,i,d,u]),(0,s.jsxs)(n.Zp,{className:"mt-4",children:[(0,s.jsx)(n.aR,{children:(0,s.jsx)(n.ZB,{children:"Structure Preview"})}),(0,s.jsx)(n.Wu,{children:(0,s.jsx)("iframe",{ref:u,src:"/",width:"100%",height:c,style:{border:"1px solid hsl(var(--border))"},title:"oxDNA Viewer"})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[359,346,561,762,726,582,212,237,993,282,567,608,451,522,303,922,854,521,801,358],()=>t(41808)),_N_E=e.O()}]);