(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5189],{81897:(e,n,s)=>{"use strict";s.d(n,{default:()=>M});var t=s(69298),i=s(83130),r=s(74450),l=s(65671),o=s(72003),a=s(46583),c=s(43177),d=s(87441),u=s(44359),p=s(84586),x=s(46655),m=s(40025),h=s(87849),j=s(96308),f=s(92839),g=s(58),b=s(30843),y=s(76261),v=s(79717),w=s(71612),N=s(15244),C=s(58931),I=s(93013),R=s(96728);let _=o.Ik({jobName:o.Yj().optional(),samplingType:o.k5(["Umbrella","ForwardFlux"],{required_error:"You must select a sampling type."}),topology:o.bz().refine(e=>e instanceof File,"Topology file is required."),configuration:o.bz().refine(e=>e instanceof File,"Configuration file is required."),testPreEq:o.zM(),nucleotideIndexes0:o.Yj().min(1,"This field is required."),nucleotideIndexes1:o.Yj().min(1,"This field is required."),xmin:o.au.number(),xmax:o.au.number(),steps:o.au.number().int().positive("Must be a positive number"),cpuRun:o.zM(),T:o.Yj().min(1,"Temperature is required."),saltConc:o.au.number(),nWindows:o.au.number().int().positive("Must be a positive number"),stiff:o.au.number(),cpus:o.au.number().int().positive("Must be a positive number"),protein:o.bz().optional(),sequenceDependent:o.zM(),pullingSteps:o.au.number().int().positive("Must be a positive number"),eqSteps:o.au.number().int().positive("Must be a positive number"),meltingTemperature:o.zM(),forceFile:o.bz().optional()});function M(){let{user:e}=(0,m.A)(),{toast:n}=(0,f.dj)(),[s,o]=i.useState(!1),M=(0,l.mN)({resolver:(0,r.u)(_),defaultValues:j.eg});i.useEffect(()=>{let e=sessionStorage.getItem("enhancedSamplingForm");if(e){let n=Object.entries(JSON.parse(e)).reduce((e,n)=>{let[s,t]=n;return["topology","configuration","protein","forceFile"].includes(s)||(e[s]=t),e},{});M.reset(n)}},[M.reset]),i.useEffect(()=>{let e=M.watch(e=>{let n={...e};delete n.topology,delete n.configuration,delete n.protein,delete n.forceFile,sessionStorage.setItem("enhancedSamplingForm",JSON.stringify(n))});return()=>e.unsubscribe()},[M.watch]);let S=async e=>{var s;let t=null==(s=e.target.files)?void 0:s[0];if(t)try{let e=await t.text(),s=N.Hh(e);s.jobName&&M.setValue("jobName",s.jobName),s.nucleotide_indexes_0&&M.setValue("nucleotideIndexes0",s.nucleotide_indexes_0),s.nucleotide_indexes_1&&M.setValue("nucleotideIndexes1",s.nucleotide_indexes_1),s.xmin&&M.setValue("xmin",s.xmin),s.xmax&&M.setValue("xmax",s.xmax),s.stiff&&M.setValue("stiff",s.stiff),s.celcius&&M.setValue("T",String(s.celcius)),s.molarity&&M.setValue("saltConc",s.molarity),s.sequence_dependent&&M.setValue("sequenceDependent",s.sequence_dependent),s.pulling_steps&&M.setValue("pullingSteps",s.pulling_steps),s.equilibration_steps&&M.setValue("eqSteps",s.equilibration_steps),s.production_steps&&M.setValue("steps",s.production_steps),s.test_pulling&&M.setValue("testPreEq",s.test_pulling),s.cpu_run&&M.setValue("cpuRun",s.cpu_run),s.n_cpus&&M.setValue("cpus",s.n_cpus),s.n_windows&&M.setValue("nWindows",s.n_windows),n({title:"YAML file loaded",description:"Form fields have been populated from the uploaded YAML file."})}catch(e){console.error("Error parsing YAML file:",e),n({title:"Error loading YAML file",description:"Could not parse the YAML file. Please check the file format.",variant:"destructive"})}},F=M.watch("nWindows");i.useEffect(()=>{F&&F>0&&M.setValue("cpus",F)},[F,M.setValue]);let q=async(e,s)=>{var t;let i=null==(t=e.target.files)?void 0:t[0];if(i&&(M.setValue(s,i,{shouldValidate:!0}),"topology"===s))try{let e=(await i.text()).split("\n")[0].trim(),s=parseInt(e.split(" ")[0]);if(!isNaN(s)){let e=s>500;M.setValue("cpuRun",!e),n({title:"GPU Setting Updated",description:"Detected ".concat(s," nucleotides. GPU ").concat(e?"enabled":"disabled"," automatically.")})}}catch(e){console.error("Error reading topology file:",e)}};async function V(s){if(!e)return void n({title:"Authentication Error",description:"You must be logged in to submit a job.",variant:"destructive"});let t=parseInt(s.T,10);if(isNaN(t))return void n({title:"Invalid Temperature",description:"Please enter a valid number for temperature.",variant:"destructive"});let i={...s,userID:e.id,T:t,cpus:s.cpus,topology:s.topology,configuration:s.configuration,protein:s.protein instanceof File?s.protein:void 0,forceFile:s.forceFile instanceof File?s.forceFile:void 0};try{let e=await h.F.runEnhancedSamplingJob(i);n({title:"Enhanced Sampling Job Submitted",description:"Job submitted. Backend responded with: ".concat(e)}),M.reset(j.eg),sessionStorage.removeItem("enhancedSamplingForm")}catch(e){console.error("Failed to submit enhanced sampling job:",e),n({title:"Submission Failed",description:e.message||"An unknown error occurred.",variant:"destructive"})}}let z=M.watch("topology"),J=M.watch("configuration"),B=M.watch("nucleotideIndexes0"),A=M.watch("nucleotideIndexes1");return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.lV,{...M,children:(0,t.jsxs)("form",{onSubmit:M.handleSubmit(V),className:"space-y-8",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)(v.Zp,{children:[(0,t.jsx)(v.aR,{children:(0,t.jsx)(v.ZB,{className:"font-headline text-lg",children:"Required Parameters"})}),(0,t.jsxs)(v.Wu,{className:"space-y-4",children:[(0,t.jsx)(c.zB,{control:M.control,name:"jobName",render:e=>{var n;let{field:s}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Job Name"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.p,{placeholder:"A descriptive name for your job",...s,value:null!=(n=s.value)?n:""})}),(0,t.jsx)(c.Rr,{children:"Provide a descriptive name for your job to easily identify it in your job history."}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:M.control,name:"samplingType",render:e=>{let{field:n}=e;return(0,t.jsxs)(c.eI,{className:"space-y-3",children:[(0,t.jsx)(c.lR,{children:"Sampling Type"}),(0,t.jsx)(c.MJ,{children:(0,t.jsxs)(p.z,{onValueChange:n.onChange,defaultValue:n.value,className:"flex space-x-4",children:[(0,t.jsxs)(c.eI,{className:"flex items-center space-x-2",children:[(0,t.jsx)(c.MJ,{children:(0,t.jsx)(p.C,{value:"Umbrella"})}),(0,t.jsx)(c.lR,{className:"font-normal",children:"Umbrella Sampling"})]}),(0,t.jsxs)(c.eI,{className:"flex items-center space-x-2",children:[(0,t.jsx)(c.MJ,{children:(0,t.jsx)(p.C,{value:"ForwardFlux"})}),(0,t.jsx)(c.lR,{className:"font-normal",children:"Forward Flux"})]})]})}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:M.control,name:"topology",render:()=>(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Topology File"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.p,{type:"file",onChange:e=>q(e,"topology")})}),(0,t.jsx)(c.Rr,{children:"Upload the oxDNA topology file (`.top`) that defines the structure and connectivity of your system."}),(0,t.jsx)(c.C5,{})]})}),(0,t.jsx)(c.zB,{control:M.control,name:"configuration",render:()=>(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Configuration File"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.p,{type:"file",onChange:e=>q(e,"configuration")})}),(0,t.jsx)(c.Rr,{children:"Upload an equilibrated oxDNA conformation file (`.dat`) representing the starting state of your simulation."}),(0,t.jsx)(c.C5,{})]})}),(0,t.jsx)(c.zB,{control:M.control,name:"nucleotideIndexes0",render:e=>{let{field:n}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Nucleotide Indexes 0"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.p,{placeholder:"10, 11, 12, 16, 9",...n})}),(0,t.jsx)(c.Rr,{children:"Enter the comma-separated particle IDs (from oxView) that define the first group for distance measurement (center of mass 0)."}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:M.control,name:"nucleotideIndexes1",render:e=>{let{field:n}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Nucleotide Indexes 1"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.p,{placeholder:"14, 21, 30",...n})}),(0,t.jsx)(c.Rr,{children:"Enter the comma-separated particle IDs (from oxView) that define the second group for distance measurement (center of mass 1)."}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(c.zB,{control:M.control,name:"xmin",render:e=>{let{field:n}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"X Minimum"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.p,{type:"number",step:"0.01",...n})}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:M.control,name:"xmax",render:e=>{let{field:n}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"X Maximum"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.p,{type:"number",step:"0.01",...n})}),(0,t.jsx)(c.C5,{})]})}})]}),(0,t.jsx)(c.zB,{control:M.control,name:"testPreEq",render:e=>{let{field:n}=e;return(0,t.jsxs)(c.eI,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[(0,t.jsxs)("div",{className:"space-y-0.5",children:[(0,t.jsx)(c.lR,{children:"Test Pre-Equilibration"}),(0,t.jsx)(c.Rr,{children:"Perform a short, non-equilibrium pulling simulation to test the reaction coordinate. Highly recommended."})]}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(u.d,{checked:n.value,onCheckedChange:n.onChange})})]})}})]})]})}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(v.Zp,{children:[(0,t.jsx)(v.aR,{children:(0,t.jsx)(v.ZB,{className:"font-headline text-lg",children:"Key Arguments"})}),(0,t.jsxs)(v.Wu,{className:"space-y-4",children:[(0,t.jsx)(c.zB,{control:M.control,name:"steps",render:e=>{let{field:n}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Production Steps"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.p,{type:"number",...n})}),(0,t.jsx)(c.Rr,{children:"The number of simulation steps for the production run in each window. More steps lead to better statistics but require more computation time."}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:M.control,name:"T",render:e=>{let{field:n}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Temperature (\xb0C)"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.p,{placeholder:"e.g., 37",...n})}),(0,t.jsx)(c.Rr,{children:"The temperature (in Celsius) at which the simulation will be performed. "}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:M.control,name:"saltConc",render:e=>{let{field:n}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Salt Concentration (M)"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.p,{type:"number",step:"0.01",...n})}),(0,t.jsx)(c.Rr,{children:"Salt concentration in NaCl M (molarity). Affects electrostatic interactions."}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:M.control,name:"nWindows",render:e=>{let{field:n}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Number of Windows"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.p,{type:"number",...n})}),(0,t.jsx)(c.Rr,{children:"The number of parallel simulations (replicas) to run along the reaction coordinate. "}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:M.control,name:"stiff",render:e=>{let{field:n}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Stiffness of Spring (k)"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.p,{type:"number",step:"0.1",...n})}),(0,t.jsx)(c.Rr,{children:"The spring constant for the harmonic restraint. Higher values create a stiffer potential, more tightly confining the sampling in each window."}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:M.control,name:"cpus",render:e=>{let{field:n}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"CPUs"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.p,{type:"number",step:"1",min:"1",...n})}),(0,t.jsx)(c.Rr,{children:"Number of CPUs to use. This is automatically set to the number of windows, as each window runs on a separate CPU."}),(0,t.jsx)(c.C5,{})]})}})]})]}),(0,t.jsx)(x.nD,{type:"single",collapsible:!0,className:"w-full",children:(0,t.jsx)(x.As,{value:"item-1",children:(0,t.jsxs)(v.Zp,{children:[(0,t.jsx)(x.$m,{className:"p-6",children:(0,t.jsx)(v.aR,{className:"p-0",children:(0,t.jsx)(v.ZB,{className:"font-headline text-lg",children:"Advanced Parameters"})})}),(0,t.jsx)(x.ub,{children:(0,t.jsxs)(v.Wu,{className:"space-y-4 pt-0",children:[(0,t.jsx)(c.zB,{control:M.control,name:"pullingSteps",render:e=>{let{field:n}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Pulling Steps"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.p,{type:"number",...n})}),(0,t.jsx)(c.Rr,{children:"Number of steps for the initial, non-equilibrium pulling phase to generate starting conformations for each window."}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:M.control,name:"eqSteps",render:e=>{let{field:n}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Equilibrium Steps"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.p,{type:"number",...n})}),(0,t.jsx)(c.Rr,{children:"Number of equilibration steps for each window"}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:M.control,name:"protein",render:()=>(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Protein File (Optional)"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.p,{type:"file",onChange:e=>q(e,"protein")})}),(0,t.jsx)(c.Rr,{children:"Upload a protein parameter file (`.par`) if your system includes a protein component to be simulated alongside the DNA."}),(0,t.jsx)(c.C5,{})]})}),(0,t.jsx)(c.zB,{control:M.control,name:"forceFile",render:()=>(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Force File (Optional)"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.p,{type:"file",onChange:e=>q(e,"forceFile")})}),(0,t.jsx)(c.Rr,{children:"Upload an oxDNA force file to apply additional external forces or restraints during the simulation."}),(0,t.jsx)(c.C5,{})]})})]})})]})})})]})]}),(0,t.jsx)(w.Separator,{}),(0,t.jsxs)("div",{className:"flex items-center gap-4 mt-8",children:[(0,t.jsxs)(a.$,{type:"button",variant:"outline",onClick:()=>{var e;return null==(e=document.getElementById("yaml-upload"))?void 0:e.click()},children:[(0,t.jsx)(g.A,{className:"mr-2 h-4 w-4"}),"Upload YAML"]}),(0,t.jsx)(d.p,{id:"yaml-upload",type:"file",accept:".yaml,.yml",onChange:S,className:"hidden"}),(0,t.jsxs)(a.$,{type:"button",variant:"outline",onClick:()=>{let e=M.getValues(),n={jobName:e.jobName,nucleotide_indexes_0:e.nucleotideIndexes0,nucleotide_indexes_1:e.nucleotideIndexes1,xmin:e.xmin,xmax:e.xmax,stiff:e.stiff,celcius:Number(e.T),molarity:e.saltConc,sequence_dependent:e.sequenceDependent,pulling_steps:e.pullingSteps,equilibration_steps:e.eqSteps,production_steps:e.steps,test_pulling:e.testPreEq,cpu_run:e.cpuRun,n_cpus:e.cpus,n_windows:e.nWindows},s=new Blob([N.Bh(n)],{type:"text/yaml;charset=utf-8"});(0,C.saveAs)(s,"config.yaml")},children:[(0,t.jsx)(b.A,{className:"mr-2 h-4 w-4"}),"Export YAML"]}),(0,t.jsxs)(a.$,{type:"submit",className:"w-full md:w-auto",children:[(0,t.jsx)(y.A,{className:"mr-2 h-4 w-4"})," Submit Job"]})]})]})}),(0,t.jsxs)("div",{className:"mt-8",children:[(0,t.jsx)(R.Bc,{children:(0,t.jsxs)(R.m_,{children:[(0,t.jsx)(R.k$,{asChild:!0,children:(0,t.jsx)("div",{style:{display:"inline-block"},children:(0,t.jsx)(a.$,{onClick:()=>o(!s),disabled:!z||!J,variant:"outline",style:{pointerEvents:z&&J?"auto":"none"},children:s?"Hide Preview":"oxView Preview"})})}),(!z||!J)&&(0,t.jsx)(R.ZI,{children:(0,t.jsx)("p",{children:"Please upload topology and configuration files to show oxView preview"})})]})}),s&&z&&J&&(0,t.jsx)(I.b,{topFile:z,datFile:J,nucleotideIndexes0:B,nucleotideIndexes1:A})]})]})}},87135:(e,n,s)=>{Promise.resolve().then(s.bind(s,81897))}},e=>{var n=n=>e(e.s=n);e.O(0,[8359,1561,3033,3587,212,257,1282,3557,7812,739,5141,2783,3794,5521,3801,7358],()=>n(87135)),_N_E=e.O()}]);