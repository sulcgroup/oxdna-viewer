(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,51462,e=>{"use strict";var t,r=e.i(65771),a=e.i(20339),s=e.i(3614),n=e.i(15556),i=e.i(42792),o=e.i(88442);function c(){let e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}}function l(){return!!localStorage.getItem("token")}function d(){localStorage.removeItem("token")}function m(e){let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r.buffer}async function u(){if(!l())return console.log("User not logged in, returning empty array"),[];try{let e=await fetch(`${i.API_BASE_URL_PUBLIC_AUTH}/sync/projects`,{headers:c()});if(!e.ok){if(401===e.status)return d(),(0,o.toast)({title:"Session expired",description:"Please login again.",variant:"destructive"}),[];throw Error(`HTTP error! status: ${e.status}`)}return(await e.json()).projects||[]}catch(e){return console.error("getRemoteStructures error:",e),(0,o.toast)({title:"Failed to fetch remote projects",description:e instanceof Error?e.message:"Unknown error",variant:"destructive"}),[]}}async function h(e,t){if(!l())return console.log("User not logged in, returning null"),(0,o.toast)({title:"Login required",description:"Please login to create synced projects",variant:"destructive"}),null;try{let r={projectName:e};t&&(r.projectId=t);let a=await fetch(`${i.API_BASE_URL_PUBLIC_AUTH}/sync/project`,{method:"POST",headers:{"Content-Type":"application/json",...c()},body:JSON.stringify(r)});if(!a.ok){if(401===a.status)return d(),(0,o.toast)({title:"Login required",description:"Please login to create synced projects",variant:"destructive"}),null;throw Error(`HTTP error! status: ${a.status}`)}return(await a.json()).project||null}catch(e){return console.error("createRemoteStructure error:",e),null}}async function f(e,t,r,a){if(!l())return console.log("User not logged in, returning null"),(0,o.toast)({title:"Login required",description:"Please login to add commits to synced projects",variant:"destructive"}),null;try{let r={commitName:t.commitName,commitData:function(e){let t=new Uint8Array(e),r="";for(let e=0;e<t.byteLength;e++)r+=String.fromCharCode(t[e]);return btoa(r)}(t.data),parentCommitId:a};t.commitId&&(r.commitId=t.commitId);let s=await fetch(`${i.API_BASE_URL_PUBLIC_AUTH}/sync/project/${e}/commit`,{method:"POST",headers:{"Content-Type":"application/json",...c()},body:JSON.stringify(r)});if(!s.ok){if(401===s.status)return d(),(0,o.toast)({title:"Login required",description:"Please login to add commits to synced projects",variant:"destructive"}),null;throw Error(`HTTP error! status: ${s.status}`)}return(await s.json()).commit||null}catch(e){return console.error("addRemoteCommit error:",e),null}}async function p(e){if(!l())return(0,o.toast)({title:"Login required",description:"Please login to share commits",variant:"destructive"}),null;try{let t=await fetch(`${i.API_BASE_URL_PUBLIC_AUTH}/share/commit`,{method:"POST",headers:{"Content-Type":"application/json",...c()},body:JSON.stringify({structureData:e})});if(!t.ok){if(401===t.status)return d(),(0,o.toast)({title:"Login required",description:"Please login to share commits",variant:"destructive"}),null;throw Error("Failed to share commit")}return await t.json()}catch(e){return console.error("shareCommit error:",e),null}}async function x(){if(!l())return console.log("User not logged in, returning empty array"),[];try{let e=await fetch(`${i.API_BASE_URL_PUBLIC_AUTH}/share/my-commits`,{headers:c()});if(!e.ok){if(401===e.status)return d(),(0,o.toast)({title:"Login required",description:"Please login to view your shared commits",variant:"destructive"}),[];throw Error("Failed to fetch shared commits")}return(await e.json()).commits||[]}catch(e){return console.error("getMySharedCommits error:",e),[]}}async function y(e){if(!l())return(0,o.toast)({title:"Login required",description:"Please login to toggle project visibility",variant:"destructive"}),{success:!1};try{let t=await fetch(`${i.API_BASE_URL_PUBLIC_AUTH}/sync/project/${e}/public`,{method:"PATCH",headers:c()});if(!t.ok){if(401===t.status)return d(),(0,o.toast)({title:"Login required",description:"Please login to toggle project visibility",variant:"destructive"}),{success:!1};throw Error("Failed to toggle project visibility")}let r=await t.json();return{success:!0,isPublic:r.isPublic}}catch(e){return console.error("toggleProjectPublic error:",e),{success:!1}}}async function g(e){if(!l())return console.log("User not logged in, returning empty array"),[];try{let t=await fetch(`${i.API_BASE_URL_PUBLIC_AUTH}/sync/project/${e}/commits`,{headers:c()});if(!t.ok){if(401===t.status)return d(),(0,o.toast)({title:"Session expired",description:"Please login again.",variant:"destructive"}),[];throw Error(`HTTP error! status: ${t.status}`)}return((await t.json()).commits||[]).map(e=>({id:e.id,commitName:e.commitName,createdAt:e.createdAt,parentCommitId:e.parentCommitId||null}))}catch(e){return console.error("getProjectCommits error:",e),(0,o.toast)({title:"Failed to fetch project commits",description:e instanceof Error?e.message:"Unknown error",variant:"destructive"}),[]}}async function j(e){if(!l())return(0,o.toast)({title:"Login required",description:"Please login to delete synced projects",variant:"destructive"}),!1;try{let t=await fetch(`${i.API_BASE_URL_PUBLIC_AUTH}/sync/project/${e}`,{method:"DELETE",headers:c()});if(!t.ok){if(401===t.status)return d(),(0,o.toast)({title:"Login required",description:"Please login to delete synced projects",variant:"destructive"}),!1;throw Error(`HTTP error! status: ${t.status}`)}return!0}catch(e){return console.error("deleteSyncedProject error:",e),!1}}async function w(e,t){if(!l())return console.log("User not logged in, returning null"),(0,o.toast)({title:"Login required",description:"Please login to read commit data",variant:"destructive"}),null;try{let r=await fetch(`${i.API_BASE_URL_PUBLIC_AUTH}/sync/project/${e}/commit/${t}/data`,{headers:c()});if(!r.ok){if(401===r.status)return d(),(0,o.toast)({title:"Session expired",description:"Please login again.",variant:"destructive"}),null;throw Error(`HTTP error! status: ${r.status}`)}let a=await r.json();return m(a.content)}catch(e){return console.error("readCommitData error:",e),(0,o.toast)({title:"Failed to read commit data",description:e instanceof Error?e.message:"Unknown error",variant:"destructive"}),null}}async function v(e){try{let t=await fetch(`${i.API_BASE_URL_PUBLIC_AUTH}/public/project/${e}/commits`);if(!t.ok)return[];return((await t.json()).commits||[]).map(e=>({id:e.id,commitName:e.commitName,createdAt:e.createdAt,parentCommitId:e.parentCommitId||null}))}catch(e){return console.error("getPublicProjectCommits error:",e),[]}}async function b(e,t){try{let r=await fetch(`${i.API_BASE_URL_PUBLIC_AUTH}/public/project/${e}/commit/${t}/data`);if(!r.ok)return null;let a=await r.json();return m(a.content)}catch(e){return console.error("readPublicCommitData error:",e),null}}function N(e){if(!e||0===e.length)return{main:[]};let t=new Map,r=new Map;for(let a of e){let e=a.commitId||a.id,s=a.parent||a.parentCommitId||null;r.set(e,s),s&&(t.has(s)||t.set(s,[]),t.get(s).push(e))}let a=e.filter(e=>{let r=e.commitId||e.id;return!t.has(r)}),s={};return a.forEach((e,t)=>{let a=e.commitId||e.id,n=0===t?"main":`branch ${t+1}`,i=[],o=a,c=new Set;for(;o&&!c.has(o);)c.add(o),i.unshift(o),o=r.get(o)||null;s[n]=i}),s}async function C(e){try{if(e.publicSourceId&&(!e.isSynced||!e.syncedProjectId))try{let t=await v(e.publicSourceId),r=t?t.length:0,a=e.commits?e.commits.length:0;if(!t)return{status:"public-out-of-sync",direction:"pull",localCommitCount:a,remoteCommitCount:0};let s=new Set(e.commits.map(e=>e.commitId));if(t.some(e=>!s.has(e.id)))return{status:"public-out-of-sync",direction:"pull",localCommitCount:a,remoteCommitCount:r};return{status:"public-synced",localCommitCount:a,remoteCommitCount:r}}catch(t){return console.warn("Public sync status check failed",t),{status:"public-out-of-sync",direction:"pull",localCommitCount:e.commits?e.commits.length:0,remoteCommitCount:0}}if(!e.isSynced||!e.syncedProjectId)return{status:"local",localCommitCount:e.commits?e.commits.length:0};let t=await g(e.syncedProjectId);if(!t)return{status:"out-of-sync",direction:"pull",localCommitCount:e.commits?e.commits.length:0,remoteCommitCount:0};let r=e.commits?e.commits.length:0,a=t.length;if(r===a)return{status:"synced",localCommitCount:r,remoteCommitCount:a};if(r>a)return{status:"out-of-sync",direction:"push",localCommitCount:r,remoteCommitCount:a};return{status:"out-of-sync",direction:"pull",localCommitCount:r,remoteCommitCount:a}}catch(t){return console.error("Error determining project sync status:",t),{status:"local",localCommitCount:e.commits?e.commits.length:0}}}async function k(e,t){try{let r,a,s=t;if(a="object"==typeof e&&null!==e?s=(r=e).id:e,!s)throw console.warn("pullRemoteProject: missing remote project id"),Error("No remote project id provided");let i=await g(s);if(!i||0===i.length)throw Error("No commits found in remote project");let o=[];for(let e of i){let t=await w(s,e.id);if(!t)throw Error(`Failed to download commit ${e.commitName}`);o.push({commitId:e.id,commitName:e.commitName,data:t,parent:e.parentCommitId||null})}if(a){if(!await n.DexieDB.structureData.get(a)){let e={id:s,commits:o,structureName:r&&(r.projectName||r.name)||"Remote Project",date:Date.now(),branches:{main:o.map(e=>e.commitId)},isSynced:!0,syncedProjectId:s,isRemote:!0};await n.DexieDB.structureData.put(e);return}await n.DexieDB.structureData.update(a,{commits:o,date:Date.now(),isSynced:!0,syncedProjectId:s})}else{let e={id:s,commits:o,structureName:r&&(r.projectName||r.name)||"Remote Project",date:Date.now(),branches:{main:o.map(e=>e.commitId)},isSynced:!0,syncedProjectId:s,isRemote:!0};await n.DexieDB.structureData.put(e)}}catch(e){throw console.error("Error pulling remote project:",e),e}}async function P(e){try{let t=e.publicSourceId;if(!t)return;let r=await v(t);if(!r||0===r.length)return;let a=new Set((e.commits||[]).map(e=>e.commitId)),s=r.filter(e=>!a.has(e.id));if(0===s.length)return;for(let r of s){let a=await b(t,r.id);if(!a){console.warn(`refreshPublicClonedProject: Failed to read commit data for ${r.id}`);continue}e.commits.push({commitId:r.id,commitName:r.commitName||"Commit",data:a,parent:r.parentCommitId||null,createdAt:r.createdAt||Date.now()}),e.branches||(e.branches={main:[]}),e.branches.main||(e.branches.main=[]),e.branches.main.push(r.id)}if(e.commits||(e.commits=[]),e.commits.sort((e,t)=>(e.createdAt||0)-(t.createdAt||0)),e.commits.length<=1||e.commits.some((e,t)=>t>0&&e.parent)){let t=N(e.commits);e.branches=t}else e.branches={main:e.commits.map(e=>e.commitId)};await n.DexieDB.structureData.put({...e,date:Date.now()})}catch(e){throw console.error("refreshPublicClonedProject error",e),e}}async function D(e,t){try{let r=await n.DexieDB.structureData.get(e);if(!r)throw Error("Local project not found");if(r.publicSourceId)throw Error("This project was cloned from a public source and cannot be synced upstream.");if(r.isSynced&&r.syncedProjectId){let e=r.syncedProjectId,t=await g(e),a=new Set(t.map(e=>e.id)),s=r.commits.filter(e=>!a.has(e.commitId));if(0===s.length)throw Error("No new commits to push.");for(let t of s)await f(e,t,"main",t.parent);return}let a=await h(t);if(!a)throw Error("Failed to create remote project");for(let e of r.commits)await f(a.id,e,"main",e.parent);await S(e,a.id)}catch(e){throw console.error("Error syncing project to cloud:",e),e}}async function S(e,t){await n.DexieDB.structureData.update(e,{isSynced:!0,syncedProjectId:t})}function M(){let[e,t]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{try{await n.DexieDB.open(),t(!0)}catch(e){console.error("Failed to initialize Dexie database:",e),t(!1)}})()},[]);let r=(0,a.useCallback)(async()=>{if(!e)return console.warn("Database not ready, returning empty array"),[];try{return await n.DexieDB.structureData.toArray()}catch(e){return console.error("Failed to get all projects:",e),[]}},[e]),s=(0,a.useCallback)(async t=>{if(!e)return void console.warn("Database not ready, returning undefined");try{return await n.DexieDB.structureData.get(t)}catch(e){console.error(`Failed to get project ${t}:`,e);return}},[e]),i=(0,a.useCallback)(async t=>{if(!e)throw Error("Database not ready");try{let e=Math.random().toString(36).substring(2)+Date.now().toString(36),r={...t,id:e,date:Date.now()};return await n.DexieDB.structureData.add(r),e}catch(e){throw console.error("Failed to create project:",e),e}},[e]),o=(0,a.useCallback)(async(t,r)=>{if(!e)throw Error("Database not ready");try{await n.DexieDB.structureData.update(t,r)}catch(e){throw console.error(`Failed to update project ${t}:`,e),e}},[e]),c=(0,a.useCallback)(async t=>{if(!e)throw Error("Database not ready");try{await n.DexieDB.structureData.delete(t)}catch(e){throw console.error(`Failed to delete project ${t}:`,e),e}},[e]),l=(0,a.useCallback)(async(t,r)=>{if(!e)throw Error("Database not ready");try{await n.DexieDB.structureData.update(t,{isSynced:!0,syncedProjectId:r})}catch(e){throw console.error(`Failed to mark project ${t} as synced:`,e),e}},[e]);return{isReady:e,getAllProjects:r,getProject:s,createProject:i,updateProject:o,deleteProject:c,markProjectAsSynced:l}}var I=e.i(69496),E=e.i(80559),A=e.i(89930),T=e.i(6817);let U=(0,T.default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var B=e.i(74502);let L=(0,T.default)("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),F=(0,T.default)("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]),$=(0,T.default)("CloudDownload",[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]]),_=(0,T.default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),R=(0,T.default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),H=(0,T.default)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);function q({syncState:e}){let{status:t,direction:a}=e,s=(()=>{if("out-of-sync"===t&&a)switch(a){case"push":return"↑";case"pull":return"↓";case"both":return"↕"}return null})();return(0,r.jsxs)(B.Badge,{variant:(()=>{switch(t){case"local":return"secondary";case"synced":return"success";case"out-of-sync":case"public-out-of-sync":return"warning";case"conflict":return"destructive";default:return"default"}})(),className:"flex items-center gap-1",children:[(()=>{switch(t){case"local":default:return(0,r.jsx)(L,{className:"h-3 w-3"});case"synced":return(0,r.jsx)(R,{className:"h-3 w-3"});case"out-of-sync":if("push"===a)return(0,r.jsx)(F,{className:"h-3 w-3"});if("pull"===a)return(0,r.jsx)($,{className:"h-3 w-3"});return(0,r.jsx)(L,{className:"h-3 w-3"});case"conflict":return(0,r.jsx)(_,{className:"h-3 w-3"});case"public-synced":case"public-out-of-sync":return(0,r.jsx)(H,{className:"h-3 w-3"})}})(),(0,r.jsx)("span",{children:(()=>{switch(t){case"local":return"Local";case"synced":return"Synced";case"out-of-sync":if("push"===a)return"Push";if("pull"===a)return"Pull";return"Out of Sync";case"conflict":return"Conflict";case"public-synced":return"Public";case"public-out-of-sync":return"Update Available";default:return"Unknown"}})()}),s&&(0,r.jsx)("span",{className:"ml-1",children:s})]})}var W=e.i(94385);let z=(0,T.default)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var O=e.i(57605);let X=(0,T.default)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);function Y({refreshCallback:e}={}){let{getProject:t,deleteProject:r,markProjectAsSynced:s}=M(),{toast:n}=(0,o.useToast)(),i=(0,a.useCallback)(async(r,a)=>{try{if(!await t(r))throw Error("Local project not found");return await D(r,a),n({title:"Project synced successfully",description:`${a} has been synced to the cloud`,variant:"default"}),e&&e(),{success:!0,message:"Project synced successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return n({title:"Sync failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[t,n,e]),c=(0,a.useCallback)(async(t,r)=>{try{return await k(t,r),n({title:"Project pulled successfully",description:"Remote project has been pulled to local",variant:"default"}),e&&e(),{success:!0,message:"Project pulled successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return n({title:"Pull failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[n,e]),l=(0,a.useCallback)(async t=>{try{return await r(t),n({title:"Project deleted",description:"Local project has been deleted",variant:"default"}),e&&e(),{success:!0,message:"Project deleted successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return n({title:"Delete failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[r,n,e]),d=(0,a.useCallback)(async r=>{try{let a=await t(r);if(!a?.syncedProjectId)throw Error("Project is not synced to cloud");if(!await j(a.syncedProjectId))throw Error("Failed to delete remote project");return await s(r,""),n({title:"Remote project deleted",description:"Remote project has been deleted",variant:"default"}),e&&e(),{success:!0,message:"Remote project deleted successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return n({title:"Delete failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[t,s,n,e]),m=(0,a.useCallback)(async r=>{try{let a=await t(r);if(!a?.syncedProjectId)throw Error("Project must be synced to toggle public status");let s=await y(a.syncedProjectId);if(!s.success)throw Error("Failed to toggle public status");return n({title:"Public status updated",description:`Project is now ${s.isPublic?"public":"private"}`,variant:"default"}),e&&e(),{success:!0,message:"Public status updated successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return n({title:"Toggle failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[t,n,e]);return{syncToCloud:i,pullFromRemote:c,deleteLocal:l,deleteRemote:d,togglePublic:m,refreshPublicClone:(0,a.useCallback)(async t=>{try{if(!t.publicSourceId)throw Error("Project is not a public clone");return await P(t),n({title:"Public clone refreshed",description:"Project has been updated with latest public commits",variant:"default"}),e&&e(),{success:!0,message:"Public clone refreshed successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return n({title:"Refresh failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[n,e]),resolveConflict:(0,a.useCallback)(async(t,r)=>{try{return await k(t.id,r.id),await D(t.id,t.structureName),n({title:"Conflict resolved",description:"Local changes have been preserved and synced to cloud",variant:"default"}),e&&e(),{success:!0,message:"Conflict resolved successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return n({title:"Conflict resolution failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[n,e])}}var J=e.i(10837);let V=(0,T.default)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);var G=e.i(57021),Q=e.i(73672),K=e.i(42115),Z=e.i(76832);let ee=(0,K.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),et=a.forwardRef(({className:e,variant:t,...a},s)=>(0,r.jsx)("div",{ref:s,role:"alert",className:(0,Z.cn)(ee({variant:t}),e),...a}));et.displayName="Alert",a.forwardRef(({className:e,...t},a)=>(0,r.jsx)("h5",{ref:a,className:(0,Z.cn)("mb-1 font-medium leading-none tracking-tight",e),...t})).displayName="AlertTitle";let er=a.forwardRef(({className:e,...t},a)=>(0,r.jsx)("div",{ref:a,className:(0,Z.cn)("text-sm [&_p]:leading-relaxed",e),...t}));er.displayName="AlertDescription";let ea=(0,T.default)("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),es=(0,T.default)("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);function en({commit:e,projectId:t,isCurrentCommit:s=!1,isBranchHead:n=!1,branchName:i,branchColor:c}){let{toast:l}=(0,o.useToast)(),[d,m]=(0,a.useState)(!1),u=async()=>{m(!0);try{let r=await fetch(`/api/project/${t}/commit/${e.commitId}/data`);if(!r.ok)throw Error("Failed to fetch commit data");let a=await r.json(),s=await p(a);if(s&&s.shareUrl)navigator.clipboard.writeText(s.shareUrl),l({title:"Commit shared successfully",description:"Share link copied to clipboard"});else throw Error("Failed to create share link")}catch(e){console.error("Error sharing commit:",e),l({title:"Failed to share commit",description:e instanceof Error?e.message:"Unknown error",variant:"destructive"})}finally{m(!1)}},h=e.createdAt||e.date;return(0,r.jsxs)(I.Card,{className:`relative ${s?"ring-2 ring-blue-500":""}`,children:[(0,r.jsx)(I.CardHeader,{className:"pb-2",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("h3",{className:"font-semibold text-sm",children:e.commitName}),s&&(0,r.jsx)(B.Badge,{variant:"default",className:"text-xs",children:"Current"}),n&&(0,r.jsxs)(B.Badge,{variant:"secondary",className:"text-xs",children:[(0,r.jsx)(es,{className:"h-3 w-3 mr-1"}),i||"Branch Head"]})]}),c&&(0,r.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:c}})]})}),(0,r.jsxs)(I.CardContent,{className:"pt-0",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground mb-3",children:(e=>{if(!e)return"Unknown date";let t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})(h)}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(E.Button,{size:"sm",variant:"outline",onClick:()=>{window.location.href=`/?structureId=${t}&commit=${e.commitId}&load=true`},className:"flex items-center gap-1 text-xs h-8",children:[(0,r.jsx)(O.Eye,{className:"h-3 w-3"}),"View"]}),(0,r.jsxs)(E.Button,{size:"sm",variant:"outline",onClick:u,disabled:d,className:"flex items-center gap-1 text-xs h-8",children:[(0,r.jsx)(ea,{className:"h-3 w-3"}),d?"Sharing...":"Share"]})]})]})]})}let ei=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#14b8a6","#f97316"];function eo({commits:e,currentCommitId:t,branches:a,projectId:s}){if(!e||0===e.length)return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,r.jsx)(es,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No commits found"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"This project doesn't have any commit history yet."})]});let n=new Map;e.forEach(e=>{n.set(e.commitId,e)});let i=new Map;e.forEach(e=>{let t=e.parent;t&&(i.has(t)||i.set(t,[]),i.get(t).push(e.commitId))});let o=new Set;e.forEach(e=>{i.has(e.commitId)||o.add(e.commitId)});let c=new Map,l=0;Object.keys(a).forEach(e=>{c.set(e,ei[l%ei.length]),l++});let d=new Map;Object.entries(a).forEach(([e,t])=>{t.forEach(t=>{d.set(t,e)})});let m=(e,a=0)=>{let l=n.get(e);if(!l)return null;let u=e===t,h=o.has(e),f=d.get(e),p=c.get(f),x=i.get(e)||[];return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("div",{className:"flex items-start",children:[a>0&&(0,r.jsx)("div",{className:"absolute left-6 top-0 w-px h-6 bg-border",style:{left:"24px"}}),(0,r.jsx)("div",{className:"mb-4",style:{marginLeft:`${40*a}px`},children:(0,r.jsx)(en,{commit:l,projectId:s,isCurrentCommit:u,isBranchHead:h,branchName:f,branchColor:p})})]}),x.length>0&&(0,r.jsxs)("div",{className:"relative",children:[x.length>1&&(0,r.jsx)("div",{className:"absolute top-0 h-px bg-border",style:{left:"24px",right:`${(x.length-1)*40+24}px`,top:"24px"}}),(0,r.jsx)("div",{className:"flex flex-col",children:x.map((e,t)=>(0,r.jsxs)("div",{className:"relative",children:[x.length>1&&(0,r.jsx)("div",{className:"absolute w-px bg-border",style:{left:"24px",top:"24px",height:"24px"}}),m(e,a+(x.length>1?t:0))]},e))})]})]},e)},u=e.filter(e=>!e.parent);return(0,r.jsxs)("div",{className:"p-4 overflow-auto max-h-[600px]",children:[(0,r.jsx)("div",{className:"space-y-2",children:u.map(e=>m(e.commitId))}),Object.keys(a).length>1&&(0,r.jsxs)("div",{className:"mt-6 pt-4 border-t",children:[(0,r.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Branches"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:Object.entries(a).map(([e,t])=>(0,r.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:c.get(e)}}),(0,r.jsx)("span",{children:e}),(0,r.jsxs)("span",{className:"text-muted-foreground",children:["(",t.length,")"]})]},e))})]})]})}var ec=e.i(90945);function el({isOpen:e,onClose:t,projectId:s,projectName:n}){let{commits:i,loading:o,error:c,currentCommitId:l,branches:d}=function(e){let{getProject:t}=M(),[r,s]=(0,a.useState)({commits:[],loading:!0,error:null,currentCommitId:null,branches:{}});return(0,a.useEffect)(()=>{(async()=>{try{s(e=>({...e,loading:!0,error:null}));let r=await t(e);if(!r)return void s(e=>({...e,loading:!1,error:"Project not found",commits:[],currentCommitId:null,branches:{}}));let a=(r.commits||[]).sort((e,t)=>(e.createdAt||e.date||0)-(t.createdAt||t.date||0)),n=a.length>0?a[0].commitId:null,i=N(a);s({commits:a,loading:!1,error:null,currentCommitId:n,branches:i})}catch(e){console.error("Error fetching commit history:",e),s(t=>({...t,loading:!1,error:e instanceof Error?e.message:"Unknown error",commits:[],currentCommitId:null,branches:{}}))}})()},[e,t]),r}(s);return(0,r.jsx)(G.Dialog,{open:e,onOpenChange:t,children:(0,r.jsxs)(G.DialogContent,{className:"max-w-4xl max-h-[80vh] flex flex-col",children:[(0,r.jsxs)(G.DialogHeader,{className:"flex flex-row items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(es,{className:"h-5 w-5"}),(0,r.jsx)(G.DialogTitle,{children:"Commit History"})]}),(0,r.jsx)(E.Button,{variant:"ghost",size:"sm",onClick:t,className:"h-8 w-8 p-0",children:(0,r.jsx)(ec.X,{className:"h-4 w-4"})})]}),(0,r.jsxs)("div",{className:"flex flex-col flex-1 min-h-0",children:[(0,r.jsxs)("div",{className:"mb-4 pb-4 border-b",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:n}),!o&&!c&&(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:[i.length," ",1===i.length?"commit":"commits"," in ",Object.keys(d).length," ",1===Object.keys(d).length?"branch":"branches"]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-hidden",children:o?(0,r.jsxs)("div",{className:"space-y-4 p-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(Q.Skeleton,{className:"h-5 w-5"}),(0,r.jsx)(Q.Skeleton,{className:"h-4 w-32"})]}),(0,r.jsx)("div",{className:"space-y-2",children:Array.from({length:3}).map((e,t)=>(0,r.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsx)(Q.Skeleton,{className:"h-4 w-40"}),(0,r.jsx)(Q.Skeleton,{className:"h-6 w-20"})]}),(0,r.jsx)(Q.Skeleton,{className:"h-3 w-32 mb-3"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(Q.Skeleton,{className:"h-8 w-16"}),(0,r.jsx)(Q.Skeleton,{className:"h-8 w-16"})]})]},t))})]}):c?(0,r.jsx)("div",{className:"p-4",children:(0,r.jsxs)(et,{variant:"destructive",children:[(0,r.jsx)(_,{className:"h-4 w-4"}),(0,r.jsxs)(er,{children:["Failed to load commit history: ",c]})]})}):0===i.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,r.jsx)(es,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No commits found"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"This project doesn't have any commit history yet."})]}):(0,r.jsx)(eo,{commits:i,currentCommitId:l,branches:d,projectId:s})}),(0,r.jsx)("div",{className:"flex justify-end pt-4 border-t mt-4",children:(0,r.jsx)(E.Button,{variant:"outline",onClick:t,children:"Close"})})]})]})})}function ed({project:e,syncState:t,onRefresh:s}){let n,{syncToCloud:i,pullFromRemote:c,deleteLocal:l,deleteRemote:d,togglePublic:m,refreshPublicClone:u}=Y({refreshCallback:s}),{toast:h}=(0,o.useToast)(),[f,p]=(0,a.useState)(!1),x=async()=>{await i(e.id,e.structureName)},y=async()=>{await c(e.id)},g=async()=>{await l(e.id)},j=async()=>{await d(e.id)},w=async()=>{await m(e.id)},v=async()=>{await u(e)},b=(()=>{switch(t.status){case"local":return{label:"Sync to Cloud",icon:F,onClick:x,variant:"default"};case"synced":case"public-synced":default:return null;case"out-of-sync":if("push"===t.direction)return{label:"Push Changes",icon:F,onClick:x,variant:"default"};if("pull"===t.direction)return{label:"Pull Updates",icon:$,onClick:y,variant:"default"};return null;case"conflict":return{label:"Resolve Conflict",icon:z,onClick:y,variant:"destructive"};case"public-out-of-sync":return{label:"Update from Public",icon:A.RefreshCw,onClick:v,variant:"default"}}})(),N=((n=[]).push({label:"Delete Local",icon:W.Trash2,onClick:g,destructive:!0}),"local"!==t.status&&e.syncedProjectId&&n.push({label:"Delete from Cloud",icon:W.Trash2,onClick:j,destructive:!0}),"local"!==t.status&&e.syncedProjectId&&n.push({label:e.isPublic?"Make Private":"Make Public",icon:H,onClick:w,destructive:!1}),n);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(E.Button,{size:"sm",variant:"secondary",onClick:()=>{let t=e.commits?.[e.commits.length-1];t?.commitId?window.location.href=`/?structureId=${e.id}&commit=${t.commitId}&load=true`:window.location.href=`/?structureId=${e.id}&load=true`},className:"flex items-center gap-1",children:[(0,r.jsx)(O.Eye,{className:"h-4 w-4"}),"Open Project"]}),e.commits&&e.commits.length>0&&(0,r.jsxs)(E.Button,{size:"sm",variant:"outline",onClick:()=>{p(!0)},className:"flex items-center gap-1",children:[(0,r.jsx)(X,{className:"h-4 w-4"}),"View History"]}),b&&(0,r.jsxs)(E.Button,{size:"sm",variant:b.variant,onClick:b.onClick,className:"flex items-center gap-1",children:[(0,r.jsx)(b.icon,{className:"h-4 w-4"}),b.label]}),N.length>0&&(0,r.jsxs)(J.DropdownMenu,{children:[(0,r.jsx)(J.DropdownMenuTrigger,{asChild:!0,children:(0,r.jsx)(E.Button,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",children:(0,r.jsx)(V,{className:"h-4 w-4"})})}),(0,r.jsx)(J.DropdownMenuContent,{align:"end",children:N.map((e,t)=>(0,r.jsxs)(J.DropdownMenuItem,{onClick:e.onClick,className:e.destructive?"text-destructive":"",children:[(0,r.jsx)(e.icon,{className:"mr-2 h-4 w-4"}),e.label]},t))})]})]}),(0,r.jsx)(el,{isOpen:f,onClose:()=>p(!1),projectId:e.id,projectName:e.structureName})]})}function em(e){let t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new e.constructor(+e):new Date("number"==typeof e||"[object Number]"===t||"string"==typeof e||"[object String]"===t?e:NaN)}function eu(e,t){let r=em(e),a=em(t),s=r.getTime()-a.getTime();return s<0?-1:s>0?1:s}let eh={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function ef(e){return (t={})=>{let r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}let ep={date:ef({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:ef({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:ef({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},ex={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function ey(e){return(t,r)=>{let a;if("formatting"===(r?.context?String(r.context):"standalone")&&e.formattingValues){let t=e.defaultFormattingWidth||e.defaultWidth,s=r?.width?String(r.width):t;a=e.formattingValues[s]||e.formattingValues[t]}else{let t=e.defaultWidth,s=r?.width?String(r.width):e.defaultWidth;a=e.values[s]||e.values[t]}return a[e.argumentCallback?e.argumentCallback(t):t]}}function eg(e){return(t,r={})=>{let a,s=r.width,n=s&&e.matchPatterns[s]||e.matchPatterns[e.defaultMatchWidth],i=t.match(n);if(!i)return null;let o=i[0],c=s&&e.parsePatterns[s]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(c)?function(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r}(c,e=>e.test(o)):function(e,t){for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return r}(c,e=>e.test(o));return a=e.valueCallback?e.valueCallback(l):l,{value:a=r.valueCallback?r.valueCallback(a):a,rest:t.slice(o.length)}}}let ej={code:"en-US",formatDistance:(e,t,r)=>{let a,s=eh[e];if(a="string"==typeof s?s:1===t?s.one:s.other.replace("{{count}}",t.toString()),r?.addSuffix)if(r.comparison&&r.comparison>0)return"in "+a;else return a+" ago";return a},formatLong:ep,formatRelative:(e,t,r,a)=>ex[e],localize:{ordinalNumber:(e,t)=>{let r=Number(e),a=r%100;if(a>20||a<10)switch(a%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},era:ey({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:ey({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:ey({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:ey({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:ey({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(t={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)},(e,r={})=>{let a=e.match(t.matchPattern);if(!a)return null;let s=a[0],n=e.match(t.parsePattern);if(!n)return null;let i=t.valueCallback?t.valueCallback(n[0]):n[0];return{value:i=r.valueCallback?r.valueCallback(i):i,rest:e.slice(s.length)}}),era:eg({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:eg({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:eg({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:eg({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:eg({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}},ew={};function ev(e){let t=em(e),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),e-r}function eb(e,t){var r;return function(e,t,r){var a,s,n;let i,o,c,l=r?.locale??ew.locale??ej,d=eu(e,t);if(isNaN(d))throw RangeError("Invalid time value");let m=Object.assign({},r,{addSuffix:r?.addSuffix,comparison:d});d>0?(i=em(t),o=em(e)):(i=em(e),o=em(t));let u=(a=o,s=i,(n=void 0,e=>{let t=(n?Math[n]:Math.trunc)(e);return 0===t?0:t})((em(a)-em(s))/1e3)),h=Math.round((u-(ev(o)-ev(i))/1e3)/60);if(h<2)if(r?.includeSeconds)if(u<5)return l.formatDistance("lessThanXSeconds",5,m);else if(u<10)return l.formatDistance("lessThanXSeconds",10,m);else if(u<20)return l.formatDistance("lessThanXSeconds",20,m);else if(u<40)return l.formatDistance("halfAMinute",0,m);else if(u<60)return l.formatDistance("lessThanXMinutes",1,m);else return l.formatDistance("xMinutes",1,m);else if(0===h)return l.formatDistance("lessThanXMinutes",1,m);else return l.formatDistance("xMinutes",h,m);if(h<45)return l.formatDistance("xMinutes",h,m);if(h<90)return l.formatDistance("aboutXHours",1,m);if(h<1440){let e=Math.round(h/60);return l.formatDistance("aboutXHours",e,m)}if(h<2520)return l.formatDistance("xDays",1,m);else if(h<43200){let e=Math.round(h/1440);return l.formatDistance("xDays",e,m)}else if(h<86400)return c=Math.round(h/43200),l.formatDistance("aboutXMonths",c,m);if((c=function(e,t){let r,a,s,n=em(e),i=em(t),o=eu(n,i),c=Math.abs((a=em(n),s=em(i),12*(a.getFullYear()-s.getFullYear())+(a.getMonth()-s.getMonth())));if(c<1)r=0;else{var l;let t,a,s,d;1===n.getMonth()&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-o*c);let m=eu(n,i)===-o;l=em(e),d=em(l),+((t=em(d)).setHours(23,59,59,999),t)==+(s=(a=em(d)).getMonth(),a.setFullYear(a.getFullYear(),s+1,0),a.setHours(23,59,59,999),a)&&1===c&&1===eu(e,i)&&(m=!1),r=o*(c-Number(m))}return 0===r?0:r}(o,i))<12){let e=Math.round(h/43200);return l.formatDistance("xMonths",e,m)}{let e=c%12,t=Math.trunc(c/12);return e<3?l.formatDistance("aboutXYears",t,m):e<9?l.formatDistance("overXYears",t,m):l.formatDistance("almostXYears",t+1,m)}}(e,(r=Date.now(),e instanceof Date?new e.constructor(r):new Date(r)),t)}let eN=(0,T.default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),eC=(0,T.default)("GitCommitHorizontal",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]]),ek=(0,T.default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),eP=(0,T.default)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),eD=(0,T.default)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);function eS({project:e,onRefresh:t}){let{syncState:s,loading:n}=function({project:e}){let[t,r]=(0,a.useState)({status:"local",localCommitCount:0}),[s,n]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{(async()=>{if(!e)return r({status:"local",localCommitCount:0});n(!0);try{let t=await C(e);r(t)}catch(t){console.error("Failed to get project sync status:",t),r({status:"local",localCommitCount:e.commits?.length||0})}finally{n(!1)}})()},[e]),{syncState:t,loading:s}}({project:e}),i=e.commits?.[e.commits.length-1],o=e.commits?.length||0;return n?(0,r.jsxs)(I.Card,{className:"animate-pulse",children:[(0,r.jsxs)(I.CardHeader,{children:[(0,r.jsx)("div",{className:"h-6 bg-gray-200 rounded w-3/4 mb-2"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]}),(0,r.jsx)(I.CardContent,{children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded"}),(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})})]}):(0,r.jsxs)(I.Card,{className:"transition-all duration-200 hover:shadow-lg",children:[(0,r.jsx)(I.CardHeader,{className:"pb-3",children:(0,r.jsx)("div",{className:"flex items-start justify-between",children:(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold truncate",title:e.structureName,children:e.structureName}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,r.jsx)(q,{syncState:s}),e.isPublic&&(0,r.jsxs)(B.Badge,{variant:"outline",className:"flex items-center gap-1",children:[(0,r.jsx)(eD,{className:"h-3 w-3"}),"Public"]})]})]})})}),(0,r.jsx)(I.CardContent,{className:"pb-3",children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,r.jsx)(eN,{className:"h-4 w-4 mr-2"}),(0,r.jsxs)("span",{children:["Modified ",(e=>{try{return eb(new Date(e),{addSuffix:!0})}catch{return"Unknown date"}})(e.date)]})]}),i&&(0,r.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,r.jsx)(eC,{className:"h-4 w-4 mr-2"}),(0,r.jsxs)("span",{children:[o," commit",1!==o?"s":""]}),i.commitName&&(0,r.jsxs)("span",{className:"ml-2 truncate",title:i.commitName,children:["- ",i.commitName]})]}),void 0!==s.localCommitCount&&void 0!==s.remoteCommitCount&&(0,r.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,r.jsx)(ek,{className:"h-4 w-4 mr-2"}),(0,r.jsxs)("span",{children:[s.localCommitCount," local, ",s.remoteCommitCount," remote"]})]}),e.publicSourceId&&(0,r.jsxs)("div",{className:"flex items-center text-sm text-blue-600",children:[(0,r.jsx)(eP,{className:"h-4 w-4 mr-2"}),(0,r.jsx)("span",{children:"Cloned from public project"})]})]})}),(0,r.jsx)(I.CardFooter,{className:"pt-0",children:(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)(ed,{project:e,syncState:s,onRefresh:t})})})]})}var eM=e.i(11237);function eI({project:e,onRefresh:t}){let[s,n]=(0,a.useState)(!1),{pullFromRemote:i}=Y({refreshCallback:t}),o=async()=>{await i(e,e.id)};return(0,r.jsxs)(I.Card,{className:`relative transition-all duration-200 hover:shadow-lg ${s?"ring-2 ring-primary":""}`,onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[s&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-10 flex items-center justify-center z-10",children:(0,r.jsxs)(E.Button,{variant:"outline",size:"lg",className:"gap-2",onClick:()=>{e.latestCommit?.id?window.open(`/?publicProject=${e.id}&commit=${e.latestCommit.id}&load=true`,"_blank"):window.open(`/?publicProject=${e.id}&load=true`,"_blank")},children:[(0,r.jsx)(O.Eye,{className:"h-5 w-5"}),"Preview Project"]})}),(0,r.jsx)(I.CardHeader,{className:"pb-3",children:(0,r.jsx)("div",{className:"flex items-start justify-between",children:(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold truncate",title:e.projectName,children:e.projectName}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,r.jsxs)(B.Badge,{variant:"outline",className:"flex items-center gap-1",children:[(0,r.jsx)(L,{className:"h-3 w-3"}),"Remote"]}),e.isPublic&&(0,r.jsxs)(B.Badge,{variant:"outline",className:"flex items-center gap-1",children:[(0,r.jsx)(O.Eye,{className:"h-3 w-3"}),"Public"]})]})]})})}),(0,r.jsx)(I.CardContent,{className:"pb-3",children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,r.jsx)(eN,{className:"h-4 w-4 mr-2"}),(0,r.jsxs)("span",{children:["Created ",(e=>{try{let t="string"==typeof e?parseInt(e):e;return eb(new Date(t),{addSuffix:!0})}catch{return"Unknown date"}})(e.createdAt)]})]}),(0,r.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,r.jsx)(eC,{className:"h-4 w-4 mr-2"}),(0,r.jsxs)("span",{children:[e.commitCount," commit",1!==e.commitCount?"s":""]})]}),e.latestCommit&&(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,r.jsx)("div",{className:"font-medium",children:"Latest commit:"}),(0,r.jsx)("div",{className:"truncate",title:e.latestCommit.commitName,children:e.latestCommit.commitName})]})]})}),(0,r.jsx)(I.CardFooter,{className:"pt-0",children:(0,r.jsxs)(E.Button,{onClick:o,className:"w-full flex items-center gap-2",variant:"default",children:[(0,r.jsx)(eM.Download,{className:"h-4 w-4"}),"Pull Project"]})})]})}var eE=e.i(44187);let eA=(0,T.default)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var eT=e.i(7050);let eU=(0,T.default)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);function eB({commit:e,onRefresh:t}){let[s,n]=(0,a.useState)(!1),{toast:i}=(0,o.useToast)(),c=async()=>{try{await navigator.clipboard.writeText(e.shareUrl),n(!0),i({title:"URL copied",description:"Share URL has been copied to clipboard",variant:"default"}),setTimeout(()=>n(!1),2e3)}catch(e){i({title:"Failed to copy",description:"Could not copy URL to clipboard",variant:"destructive"})}},l=async()=>{try{if(!(await fetch(`/api/v1/share/commit/${e.commitId}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok)throw Error("Failed to delete shared commit");i({title:"Share deleted",description:"The shared commit has been removed",variant:"default"}),t()}catch(e){i({title:"Delete failed",description:"Could not delete the shared commit",variant:"destructive"})}};return(0,r.jsxs)(I.Card,{className:"transition-all duration-200 hover:shadow-lg",children:[(0,r.jsx)(I.CardHeader,{className:"pb-3",children:(0,r.jsx)("div",{className:"flex items-start justify-between",children:(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold truncate",title:e.commitName,children:e.commitName}),(0,r.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,r.jsxs)(B.Badge,{variant:"outline",className:"flex items-center gap-1",children:[(0,r.jsx)(eU,{className:"h-3 w-3"}),"Shared"]})})]})})}),(0,r.jsx)(I.CardContent,{className:"pb-3",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,r.jsx)(eN,{className:"h-4 w-4 mr-2"}),(0,r.jsxs)("span",{children:["Shared ",(e=>{try{return eb(new Date(e),{addSuffix:!0})}catch{return"Unknown date"}})(e.createdAt)]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Share URL:"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(eE.Input,{value:e.shareUrl,readOnly:!0,className:"flex-1 text-sm"}),(0,r.jsx)(E.Button,{size:"sm",variant:"outline",onClick:c,className:"flex items-center gap-1",children:s?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eT.Check,{className:"h-4 w-4"}),"Copied"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eA,{className:"h-4 w-4"}),"Copy"]})})]})]})]})}),(0,r.jsx)(I.CardFooter,{className:"pt-0",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(E.Button,{onClick:()=>{window.open(e.shareUrl,"_blank")},className:"flex-1 flex items-center gap-2",variant:"default",children:[(0,r.jsx)(eP,{className:"h-4 w-4"}),"Load Commit"]}),(0,r.jsxs)(E.Button,{onClick:l,className:"flex items-center gap-2",variant:"destructive",size:"sm",children:[(0,r.jsx)(W.Trash2,{className:"h-4 w-4"}),"Delete Share"]})]})})]})}var eL=e.i(9882),eF=e.i(10498);function e$({items:e,renderItem:t,emptyMessage:s="No items to display",itemsPerPage:n=6}){let[i,o]=(0,a.useState)(1),c=Math.ceil(e.length/n),l=(i-1)*n,d=l+n,m=e.slice(l,d);return 0===e.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,r.jsx)("div",{className:"text-muted-foreground mb-2",children:(0,r.jsx)("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,r.jsx)("path",{vectorEffect:"non-scaling-stroke",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})})}),(0,r.jsx)("h3",{className:"text-lg font-semibold",children:s}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Get started by creating your first project."})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map((e,r)=>t(e,l+r))}),c>1&&(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsxs)(E.Button,{variant:"outline",size:"sm",onClick:()=>{i>1&&o(i-1)},disabled:1===i,className:"flex items-center gap-1",children:[(0,r.jsx)(eL.ChevronLeft,{className:"h-4 w-4"}),"Previous"]}),(0,r.jsx)("div",{className:"flex items-center gap-1",children:(()=>{let e=[];if(c<=5)for(let t=1;t<=c;t++)e.push(t);else{e.push(1),i>3&&e.push("...");let t=Math.max(2,i-1),r=Math.min(c-1,i+1);for(let a=t;a<=r;a++)e.push(a);i<c-2&&e.push("..."),e.push(c)}return e.map((e,t)=>"..."===e?(0,r.jsx)("span",{className:"px-2 text-muted-foreground",children:"..."},`ellipsis-${t}`):(0,r.jsx)(E.Button,{variant:i===e?"default":"outline",size:"sm",onClick:()=>{o(e)},className:"min-w-[2rem]",children:e},e))})()}),(0,r.jsxs)(E.Button,{variant:"outline",size:"sm",onClick:()=>{i<c&&o(i+1)},disabled:i===c,className:"flex items-center gap-1",children:["Next",(0,r.jsx)(eF.ChevronRight,{className:"h-4 w-4"})]})]}),(0,r.jsxs)("div",{className:"text-center text-sm text-muted-foreground",children:["Showing ",l+1," to ",Math.min(d,e.length)," of ",e.length," items"]})]})}e.i(88179),e.i(42923);var e_=e.i(60031),eR=e.i(62747);function eH({open:e,onOpenChange:t,onSuccess:s}){let[n,i]=(0,a.useState)(""),[c,l]=(0,a.useState)(!1),{createProject:d}=M(),{toast:m}=(0,o.useToast)(),u=async()=>{if(!n.trim())return void m({title:"Project name required",description:"Please enter a project name",variant:"destructive"});l(!0);try{await d({structureName:n.trim(),isSynced:!1,syncedProjectId:"",isRemote:!1,isPublic:!1,publicSourceId:"",branches:{main:[]},commits:[{commitId:`initial-${Date.now()}`,commitName:"Initial commit",data:new ArrayBuffer(0),parent:null,createdAt:Date.now()}]}),m({title:"Project created",description:`${n} has been created successfully`,variant:"default"}),i(""),t(!1),s()}catch(e){m({title:"Create failed",description:e instanceof Error?e.message:"Failed to create project",variant:"destructive"})}finally{l(!1)}};return(0,r.jsx)(G.Dialog,{open:e,onOpenChange:t,children:(0,r.jsxs)(G.DialogContent,{className:"sm:max-w-md",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsxs)(G.DialogTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(eR.Folder,{className:"h-5 w-5"}),"Create New Project"]}),(0,r.jsx)(G.DialogDescription,{children:"Enter a name for your new project. It will be created locally with an initial empty commit."})]}),(0,r.jsx)("div",{className:"grid gap-4 py-4",children:(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(e_.Label,{htmlFor:"projectName",children:"Project Name"}),(0,r.jsx)(eE.Input,{id:"projectName",value:n,onChange:e=>i(e.target.value),onKeyPress:e=>{"Enter"===e.key&&!c&&n.trim()&&u()},placeholder:"Enter project name...",disabled:c,autoFocus:!0})]})}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(E.Button,{variant:"outline",onClick:()=>t(!1),disabled:c,children:"Cancel"}),(0,r.jsx)(E.Button,{onClick:u,disabled:c||!n.trim(),className:"flex items-center gap-2",children:c?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),"Creating..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(U,{className:"h-4 w-4"}),"Create Project"]})})]})]})})}function eq(){let{user:e}=(0,s.useAuth)(),{localProjects:t,remoteProjects:n,sharedCommits:i,loading:c,refresh:l}=function(){let{user:e,isAuthenticated:t}=(0,s.useAuth)(),{getAllProjects:r}=M(),{toast:n}=(0,o.useToast)(),[i,c]=(0,a.useState)([]),[l,d]=(0,a.useState)([]),[m,h]=(0,a.useState)([]),[f,p]=(0,a.useState)(!0),y=e=>{let t=e.commits[e.commits.length-1];return{...e,latestCommit:t,commitCount:e.commits.length}},g=(0,a.useCallback)(async()=>{p(!0);try{let e=(await r()).map(y);if(c(e),t)try{let[e,t]=await Promise.all([u(),x()]);d(e),h(t)}catch(e){console.error("Failed to fetch remote data:",e),n({title:"Sync Error",description:"Failed to fetch remote projects. Using cached data.",variant:"destructive"})}else d([]),h([])}catch(e){console.error("Failed to refresh library data:",e),n({title:"Library Error",description:"Failed to load library data. Please try again.",variant:"destructive"})}finally{p(!1)}},[r,t]);return(0,a.useEffect)(()=>{g()},[g]),(0,a.useEffect)(()=>{g()},[e,g]),{localProjects:i,remoteProjects:l,sharedCommits:m,loading:f,refresh:g}}(),[d,m]=(0,a.useState)(!1),h=new Set(t.filter(e=>e.syncedProjectId).map(e=>e.syncedProjectId)),f=[...t,...n.filter(e=>!h.has(e.id))];return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold tracking-tight font-headline",children:"Library"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Manage your oxDNA projects, sync with cloud, and share with others"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(E.Button,{variant:"outline",size:"icon",onClick:l,disabled:c,children:(0,r.jsx)(A.RefreshCw,{className:c?"animate-spin":""})}),(0,r.jsxs)(E.Button,{onClick:()=>m(!0),children:[(0,r.jsx)(U,{className:"mr-2 h-4 w-4"}),"Create New"]})]})]}),(0,r.jsxs)(I.Card,{children:[(0,r.jsxs)(I.CardHeader,{children:[(0,r.jsx)(I.CardTitle,{children:"Projects"}),(0,r.jsx)(I.CardDescription,{children:"Your local projects and synced projects from the cloud"})]}),(0,r.jsx)(I.CardContent,{children:(0,r.jsx)(e$,{items:f,renderItem:e=>"commits"in e?(0,r.jsx)(eS,{project:e,onRefresh:l},e.id):(0,r.jsx)(eI,{project:e,onRefresh:l},e.id),emptyMessage:"No projects found. Create a new project or log in to see synced projects."})})]}),e&&(0,r.jsxs)(I.Card,{children:[(0,r.jsxs)(I.CardHeader,{children:[(0,r.jsx)(I.CardTitle,{children:"Shared by Me"}),(0,r.jsx)(I.CardDescription,{children:"Individual commits you've shared via unique links"})]}),(0,r.jsx)(I.CardContent,{children:(0,r.jsx)(e$,{items:i,renderItem:e=>(0,r.jsx)(eB,{commit:e,onRefresh:l},e.commitId),emptyMessage:"No shared commits found"})})]}),(0,r.jsx)(eH,{open:d,onOpenChange:m,onSuccess:l})]})}e.s(["default",()=>eq],51462)}]);