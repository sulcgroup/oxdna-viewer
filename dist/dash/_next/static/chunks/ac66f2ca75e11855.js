(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,69496,t=>{"use strict";var e=t.i(37081),r=t.i(33506),a=t.i(76832);let o=r.forwardRef(({className:t,...r},o)=>(0,e.jsx)("div",{ref:o,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...r}));o.displayName="Card";let i=r.forwardRef(({className:t,...r},o)=>(0,e.jsx)("div",{ref:o,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",t),...r}));i.displayName="CardHeader";let n=r.forwardRef(({className:t,...r},o)=>(0,e.jsx)("div",{ref:o,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",t),...r}));n.displayName="CardTitle";let c=r.forwardRef(({className:t,...r},o)=>(0,e.jsx)("div",{ref:o,className:(0,a.cn)("text-sm text-muted-foreground",t),...r}));c.displayName="CardDescription";let s=r.forwardRef(({className:t,...r},o)=>(0,e.jsx)("div",{ref:o,className:(0,a.cn)("p-6 pt-0",t),...r}));s.displayName="CardContent";let l=r.forwardRef(({className:t,...r},o)=>(0,e.jsx)("div",{ref:o,className:(0,a.cn)("flex items-center p-6 pt-0",t),...r}));l.displayName="CardFooter",t.s(["Card",()=>o,"CardContent",()=>s,"CardDescription",()=>c,"CardFooter",()=>l,"CardHeader",()=>i,"CardTitle",()=>n])},60031,t=>{"use strict";var e=t.i(37081),r=t.i(33506),a=t.i(54234),o=r.forwardRef((t,r)=>(0,e.jsx)(a.Primitive.label,{...t,ref:r,onMouseDown:e=>{e.target.closest("button, input, select, textarea")||(t.onMouseDown?.(e),!e.defaultPrevented&&e.detail>1&&e.preventDefault())}}));o.displayName="Label";var i=t.i(88177),n=t.i(76832);let c=(0,i.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),s=r.forwardRef(({className:t,...r},a)=>(0,e.jsx)(o,{ref:a,className:(0,n.cn)(c(),t),...r}));s.displayName=o.displayName,t.s(["Label",()=>s],60031)},70185,t=>{"use strict";let e=(0,t.i(34270).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);t.s(["Upload",()=>e],70185)},74502,t=>{"use strict";var e=t.i(37081),r=t.i(88177),a=t.i(76832);let o=(0,r.cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-primary-foreground hover:bg-green-500/80"}},defaultVariants:{variant:"default"}});function i({className:t,variant:r,...i}){return(0,e.jsx)("div",{className:(0,a.cn)(o({variant:r}),t),...i})}t.s(["Badge",()=>i])},29984,t=>{"use strict";let e=(0,t.i(34270).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);t.s(["Trash2",()=>e],29984)},75977,t=>{"use strict";let e=(0,t.i(34270).default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);t.s(["Download",()=>e],75977)},59450,t=>{"use strict";let e=(0,t.i(34270).default)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);t.s(["Eye",()=>e],59450)},57021,t=>{"use strict";var e=t.i(37081),r=t.i(33506),a=t.i(22099),o=t.i(10636),i=t.i(76832);let n=a.Root;a.Trigger;let c=a.Portal;a.Close;let s=r.forwardRef(({className:t,...r},o)=>(0,e.jsx)(a.Overlay,{ref:o,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r}));s.displayName=a.Overlay.displayName;let l=r.forwardRef(({className:t,children:r,...n},l)=>(0,e.jsxs)(c,{children:[(0,e.jsx)(s,{}),(0,e.jsxs)(a.Content,{ref:l,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n,children:[r,(0,e.jsxs)(a.Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,e.jsx)(o.X,{className:"h-4 w-4"}),(0,e.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));l.displayName=a.Content.displayName;let d=({className:t,...r})=>(0,e.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...r});d.displayName="DialogHeader";let m=({className:t,...r})=>(0,e.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r});m.displayName="DialogFooter";let u=r.forwardRef(({className:t,...r},o)=>(0,e.jsx)(a.Title,{ref:o,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",t),...r}));u.displayName=a.Title.displayName;let p=r.forwardRef(({className:t,...r},o)=>(0,e.jsx)(a.Description,{ref:o,className:(0,i.cn)("text-sm text-muted-foreground",t),...r}));p.displayName=a.Description.displayName,t.s(["Dialog",()=>n,"DialogContent",()=>l,"DialogDescription",()=>p,"DialogFooter",()=>m,"DialogHeader",()=>d,"DialogTitle",()=>u])},2380,t=>{"use strict";let e=(0,t.i(34270).default)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);t.s(["ChevronLeft",()=>e],2380)},69663,t=>{"use strict";let e=(0,t.i(34270).default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);t.s(["RefreshCw",()=>e],69663)},89966,t=>{"use strict";let e=(0,t.i(34270).default)("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);t.s(["Folder",()=>e],89966)},29233,42163,20819,t=>{"use strict";var e=t.i(33506),r=t.i(15556),a=t.i(42792),o=t.i(88442);function i(){let t=localStorage.getItem("token");return t?{Authorization:`Bearer ${t}`}:{}}function n(){return!!localStorage.getItem("token")}function c(){localStorage.removeItem("token")}function s(t){let e=atob(t),r=new Uint8Array(e.length);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return r.buffer}async function l(){if(!n())return console.log("User not logged in, returning empty array"),[];try{let t=await fetch(`${a.API_BASE_URL_PUBLIC_AUTH}/sync/projects`,{headers:i()});if(!t.ok){if(401===t.status)return c(),(0,o.toast)({title:"Session expired",description:"Please login again.",variant:"destructive"}),[];throw Error(`HTTP error! status: ${t.status}`)}return(await t.json()).projects||[]}catch(t){return console.error("getRemoteStructures error:",t),(0,o.toast)({title:"Failed to fetch remote projects",description:t instanceof Error?t.message:"Unknown error",variant:"destructive"}),[]}}async function d(t,e){if(!n())return console.log("User not logged in, returning null"),(0,o.toast)({title:"Login required",description:"Please login to create synced projects",variant:"destructive"}),null;try{let r={projectName:t};e&&(r.projectId=e);let n=await fetch(`${a.API_BASE_URL_PUBLIC_AUTH}/sync/project`,{method:"POST",headers:{"Content-Type":"application/json",...i()},body:JSON.stringify(r)});if(!n.ok){if(401===n.status)return c(),(0,o.toast)({title:"Login required",description:"Please login to create synced projects",variant:"destructive"}),null;throw Error(`HTTP error! status: ${n.status}`)}return(await n.json()).project||null}catch(t){return console.error("createRemoteStructure error:",t),null}}async function m(t,e,r,s){if(!n())return console.log("User not logged in, returning null"),(0,o.toast)({title:"Login required",description:"Please login to add commits to synced projects",variant:"destructive"}),null;try{let r={commitName:e.commitName,commitData:function(t){let e=new Uint8Array(t),r="";for(let t=0;t<e.byteLength;t++)r+=String.fromCharCode(e[t]);return btoa(r)}(e.data),parentCommitId:s};e.commitId&&(r.commitId=e.commitId),e.createdAt&&(r.createdAt="number"==typeof e.createdAt?new Date(e.createdAt).toISOString():e.createdAt);let n=await fetch(`${a.API_BASE_URL_PUBLIC_AUTH}/sync/project/${t}/commit`,{method:"POST",headers:{"Content-Type":"application/json",...i()},body:JSON.stringify(r)});if(!n.ok){if(401===n.status)return c(),(0,o.toast)({title:"Login required",description:"Please login to add commits to synced projects",variant:"destructive"}),null;throw Error(`HTTP error! status: ${n.status}`)}return(await n.json()).commit||null}catch(t){return console.error("addRemoteCommit error:",t),null}}async function u(t){if(!n())return(0,o.toast)({title:"Login required",description:"Please login to share commits",variant:"destructive"}),null;try{let e=await fetch(`${a.API_BASE_URL_PUBLIC_AUTH}/share/commit`,{method:"POST",headers:{"Content-Type":"application/json",...i()},body:JSON.stringify({structureData:t})});if(!e.ok){if(401===e.status)return c(),(0,o.toast)({title:"Login required",description:"Please login to share commits",variant:"destructive"}),null;throw Error("Failed to share commit")}return await e.json()}catch(t){return console.error("shareCommit error:",t),null}}async function p(){if(!n())return console.log("User not logged in, returning empty array"),[];try{let t=await fetch(`${a.API_BASE_URL_PUBLIC_AUTH}/share/my-commits`,{headers:i()});if(!t.ok){if(401===t.status)return c(),(0,o.toast)({title:"Login required",description:"Please login to view your shared commits",variant:"destructive"}),[];throw Error("Failed to fetch shared commits")}return(await t.json()).commits||[]}catch(t){return console.error("getMySharedCommits error:",t),[]}}async function y(t){if(!n())return(0,o.toast)({title:"Login required",description:"Please login to toggle project visibility",variant:"destructive"}),{success:!1};try{let e=await fetch(`${a.API_BASE_URL_PUBLIC_AUTH}/sync/project/${t}/public`,{method:"PATCH",headers:i()});if(!e.ok){if(401===e.status)return c(),(0,o.toast)({title:"Login required",description:"Please login to toggle project visibility",variant:"destructive"}),{success:!1};throw Error("Failed to toggle project visibility")}let r=await e.json();return{success:!0,isPublic:r.isPublic}}catch(t){return console.error("toggleProjectPublic error:",t),{success:!1}}}async function f(t){if(!n())return console.log("User not logged in, returning empty array"),[];try{let e=await fetch(`${a.API_BASE_URL_PUBLIC_AUTH}/sync/project/${t}/commits`,{headers:i()});if(!e.ok){if(401===e.status)return c(),(0,o.toast)({title:"Session expired",description:"Please login again.",variant:"destructive"}),[];throw Error(`HTTP error! status: ${e.status}`)}return((await e.json()).commits||[]).map(t=>({id:t.id,commitName:t.commitName,createdAt:t.createdAt,parentCommitId:t.parentCommitId||null}))}catch(t){return console.error("getProjectCommits error:",t),(0,o.toast)({title:"Failed to fetch project commits",description:t instanceof Error?t.message:"Unknown error",variant:"destructive"}),[]}}async function g(t){if(!n())return(0,o.toast)({title:"Login required",description:"Please login to delete synced projects",variant:"destructive"}),!1;try{let e=await fetch(`${a.API_BASE_URL_PUBLIC_AUTH}/sync/project/${t}`,{method:"DELETE",headers:i()});if(!e.ok){if(401===e.status)return c(),(0,o.toast)({title:"Login required",description:"Please login to delete synced projects",variant:"destructive"}),!1;throw Error(`HTTP error! status: ${e.status}`)}return!0}catch(t){return console.error("deleteSyncedProject error:",t),!1}}async function w(t,e){if(!n())return console.log("User not logged in, returning null"),(0,o.toast)({title:"Login required",description:"Please login to read commit data",variant:"destructive"}),null;try{let r=await fetch(`${a.API_BASE_URL_PUBLIC_AUTH}/sync/project/${t}/commit/${e}/data`,{headers:i()});if(!r.ok){if(401===r.status)return c(),(0,o.toast)({title:"Session expired",description:"Please login again.",variant:"destructive"}),null;throw Error(`HTTP error! status: ${r.status}`)}let n=await r.json();return s(n.content)}catch(t){return console.error("readCommitData error:",t),(0,o.toast)({title:"Failed to read commit data",description:t instanceof Error?t.message:"Unknown error",variant:"destructive"}),null}}async function h(t){try{let e=await fetch(`${a.API_BASE_URL_PUBLIC_AUTH}/public/project/${t}/commits`);if(!e.ok)return[];return((await e.json()).commits||[]).map(t=>({id:t.id,commitName:t.commitName,createdAt:t.createdAt,parentCommitId:t.parentCommitId||null}))}catch(t){return console.error("getPublicProjectCommits error:",t),[]}}async function v(t,e){try{let r=await fetch(`${a.API_BASE_URL_PUBLIC_AUTH}/public/project/${t}/commit/${e}/data`);if(!r.ok)return null;let o=await r.json();return s(o.content)}catch(t){return console.error("readPublicCommitData error:",t),null}}t.s(["addRemoteCommit",()=>m,"createRemoteStructure",()=>d,"deleteSyncedProject",()=>g,"getMySharedCommits",()=>p,"getProjectCommits",()=>f,"getPublicProjectCommits",()=>h,"getRemoteStructures",()=>l,"readCommitData",()=>w,"readPublicCommitData",()=>v,"shareCommit",()=>u,"toggleProjectPublic",()=>y],42163);var C=t.i(59822);function D(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}function j(t){return t.sort((t,e)=>(t.createdAt||t.date||0)-(e.createdAt||e.date||0))}function b(t){if(!t||0===t.length)return{main:[]};let e=new Map,r=new Map;for(let a of t){let t=a.commitId||a.id,o=a.parent||a.parentCommitId||null;r.set(t,o),o&&(e.has(o)||e.set(o,[]),e.get(o).push(t))}let a=t.filter(t=>{let r=t.commitId||t.id;return!e.has(r)}),o={};return a.forEach((t,e)=>{let a=t.commitId||t.id,i=0===e?"main":`branch ${e+1}`,n=[],c=a,s=new Set;for(;c&&!s.has(c);)s.add(c),n.unshift(c),c=r.get(c)||null;o[i]=n}),o}async function P(t){try{if(t.publicSourceId&&(!t.isSynced||!t.syncedProjectId))try{let e=await h(t.publicSourceId),r=e?e.length:0,a=t.commits?t.commits.length:0;if(!e)return{status:"public-out-of-sync",direction:"pull",localCommitCount:a,remoteCommitCount:0};let o=new Set(t.commits.map(t=>t.commitId));if(e.some(t=>!o.has(t.id)))return{status:"public-out-of-sync",direction:"pull",localCommitCount:a,remoteCommitCount:r};return{status:"public-synced",localCommitCount:a,remoteCommitCount:r}}catch(e){return console.warn("Public sync status check failed",e),{status:"public-out-of-sync",direction:"pull",localCommitCount:t.commits?t.commits.length:0,remoteCommitCount:0}}if(!t.isSynced||!t.syncedProjectId)return{status:"local",localCommitCount:t.commits?t.commits.length:0};let e=await f(t.syncedProjectId);if(!e)return{status:"out-of-sync",direction:"pull",localCommitCount:t.commits?t.commits.length:0,remoteCommitCount:0};let r=t.commits?t.commits.length:0,a=e.length;if(r===a)return{status:"synced",localCommitCount:r,remoteCommitCount:a};if(r>a)return{status:"out-of-sync",direction:"push",localCommitCount:r,remoteCommitCount:a};return{status:"out-of-sync",direction:"pull",localCommitCount:r,remoteCommitCount:a}}catch(e){return console.error("Error determining project sync status:",e),{status:"local",localCommitCount:t.commits?t.commits.length:0}}}async function x(t,e){try{let a,o,i=e;if(o="object"==typeof t&&null!==t?i=(a=t).id:t,!i)throw console.warn("pullRemoteProject: missing remote project id"),Error("No remote project id provided");let n=await f(i);if(!n||0===n.length)throw Error("No commits found in remote project");let c=[];for(let t of n){let e=await w(i,t.id);if(!e)throw Error(`Failed to download commit ${t.commitName}`);let r=new Date(t.createdAt).getTime();c.push({commitId:t.id,commitName:t.commitName,data:e,parent:t.parentCommitId||null,createdAt:r})}let s=localStorage.getItem("token"),l=s&&(0,C.isTokenValidForEncryption)(s);if(o){if(!await r.DexieDB.structureData.get(o)){let t=c;l&&(t=await Promise.all(c.map(async t=>{let e=await (0,C.encryptCommit)({data:t.data,commitId:t.commitId,commitName:t.commitName,parent:t.parent,createdAt:t.createdAt},s),r=new ArrayBuffer(0);return{...t,data:r,isEncrypted:!0,encryptedData:e.encryptedData,iv:e.iv}})));let e={id:i,commits:t,structureName:a&&(a.projectName||a.name)||"Remote Project",date:Date.now(),branches:{main:t.map(t=>t.commitId)},isSynced:!0,syncedProjectId:i,isRemote:!0,isEncrypted:l,encryptedAt:l?Date.now():void 0,encryptionVersion:l?"1.0":void 0};await r.DexieDB.structureData.put(e);return}let t=c;l&&(t=await Promise.all(c.map(async t=>{let e=await (0,C.encryptCommit)({data:t.data,commitId:t.commitId,commitName:t.commitName,parent:t.parent,createdAt:t.createdAt},s),r=new ArrayBuffer(0);return{...t,data:r,isEncrypted:!0,encryptedData:e.encryptedData,iv:e.iv}}))),await r.DexieDB.structureData.update(o,{commits:t,date:Date.now(),isSynced:!0,syncedProjectId:i,isEncrypted:l,encryptedAt:l?Date.now():void 0,encryptionVersion:l?"1.0":void 0})}else{let t=c;l&&(t=await Promise.all(c.map(async t=>{let e=await (0,C.encryptCommit)({data:t.data,commitId:t.commitId,commitName:t.commitName,parent:t.parent,createdAt:t.createdAt},s),r=new ArrayBuffer(0);return{...t,data:r,isEncrypted:!0,encryptedData:e.encryptedData,iv:e.iv}})));let e={id:i,commits:t,structureName:a&&(a.projectName||a.name)||"Remote Project",date:Date.now(),branches:{main:t.map(t=>t.commitId)},isSynced:!0,syncedProjectId:i,isRemote:!0,isEncrypted:l,encryptedAt:l?Date.now():void 0,encryptionVersion:l?"1.0":void 0};await r.DexieDB.structureData.put(e)}}catch(t){throw console.error("Error pulling remote project:",t),t}}async function A(t){try{let e=t.publicSourceId;if(!e)return;let a=await h(e);if(!a||0===a.length)return;let o=new Set((t.commits||[]).map(t=>t.commitId)),i=a.filter(t=>!o.has(t.id));if(0===i.length)return;for(let r of i){let a=await v(e,r.id);if(!a){console.warn(`refreshPublicClonedProject: Failed to read commit data for ${r.id}`);continue}let o=r.createdAt?new Date(r.createdAt).getTime():Date.now();t.commits.push({commitId:r.id,commitName:r.commitName||"Commit",data:a,parent:r.parentCommitId||null,createdAt:o}),t.branches||(t.branches={main:[]}),t.branches.main||(t.branches.main=[]),t.branches.main.push(r.id)}if(t.commits||(t.commits=[]),t.commits.sort((t,e)=>(t.createdAt||0)-(e.createdAt||0)),t.commits.length<=1||t.commits.some((t,e)=>e>0&&t.parent)){let e=b(t.commits);t.branches=e}else t.branches={main:t.commits.map(t=>t.commitId)};await r.DexieDB.structureData.put({...t,date:Date.now()})}catch(t){throw console.error("refreshPublicClonedProject error",t),t}}async function I(t,e){try{let a=await r.DexieDB.structureData.get(t);if(!a)throw Error("Local project not found");if(a.publicSourceId)throw Error("This project was cloned from a public source and cannot be synced upstream.");let o=localStorage.getItem("token"),i=o&&(0,C.isTokenValidForEncryption)(o);if(a.isSynced&&a.syncedProjectId){let e=a.syncedProjectId,r=await f(e),n=new Set(r.map(t=>t.id)),c=a.commits.filter(t=>!n.has(t.commitId));if(0===c.length)throw Error("No new commits to push.");for(let t of c){let r=t;if(t.isEncrypted&&t.encryptedData&&t.iv&&i){let e=await (0,C.decryptCommit)({encryptedData:t.encryptedData,iv:t.iv,originalCommitId:t.commitId,originalCommitName:t.commitName,originalParent:t.parent,originalCreatedAt:t.createdAt},o);r={...t,data:e.data,isEncrypted:!1,encryptedData:void 0,iv:void 0}}await m(e,r,"main",r.parent),r.data&&(r.data=new ArrayBuffer(0))}await N(t);return}let n=await d(e);if(!n)throw Error("Failed to create remote project");for(let t of a.commits){let e=t;if(t.isEncrypted&&t.encryptedData&&t.iv&&i){let r=await (0,C.decryptCommit)({encryptedData:t.encryptedData,iv:t.iv,originalCommitId:t.commitId,originalCommitName:t.commitName,originalParent:t.parent,originalCreatedAt:t.createdAt},o);e={...t,data:r.data,isEncrypted:!1,encryptedData:void 0,iv:void 0}}await m(n.id,e,"main",e.parent),e.data&&(e.data=new ArrayBuffer(0))}await E(t,n.id),await N(t)}catch(t){throw console.error("Error syncing project to cloud:",t),t}}async function E(t,e){await r.DexieDB.structureData.update(t,{isSynced:!0,syncedProjectId:e})}async function N(t){try{let e=localStorage.getItem("token");if(!e||!(0,C.isTokenValidForEncryption)(e))return void console.warn("Cannot encrypt project: no valid token available");let a=await r.DexieDB.structureData.get(t);if(!a)throw Error("Project not found");let o=await Promise.all(a.commits.map(async t=>{if(!t.isEncrypted){let r=await (0,C.encryptCommit)({data:t.data,commitId:t.commitId,commitName:t.commitName,parent:t.parent,createdAt:t.createdAt},e);return{...t,data:new ArrayBuffer(0),isEncrypted:!0,encryptedData:r.encryptedData,iv:r.iv}}return t}));await r.DexieDB.structureData.update(t,{commits:o,isEncrypted:!0,encryptedAt:Date.now(),encryptionVersion:"1.0"}),setTimeout(()=>{window.gc&&window.gc()},100),console.log(`Project ${t} encrypted successfully`)}catch(t){throw console.error("Failed to encrypt local project:",t),Error("Failed to encrypt project data")}}function k(){let[t,a]=(0,e.useState)(!1),o=(0,e.useCallback)(()=>localStorage.getItem("token"),[]),i=(0,e.useCallback)(async t=>{let e=o();if(!t.isEncrypted||!e||!(0,C.isTokenValidForEncryption)(e))return t;if(!crypto.subtle)return console.warn("Encryption not available in non-secure context, returning encrypted project as-is"),t;try{let r=await Promise.all(t.commits.map(async t=>{if(t.isEncrypted&&t.encryptedData&&t.iv){let r=await (0,C.decryptCommit)({encryptedData:t.encryptedData,iv:t.iv,originalCommitId:t.commitId,originalCommitName:t.commitName,originalParent:t.parent,originalCreatedAt:t.createdAt},e);return{...t,data:r.data,isEncrypted:!1,encryptedData:void 0,iv:void 0}}return t}));return{...t,commits:r,isEncrypted:!1,encryptedAt:void 0,encryptionVersion:void 0}}catch(t){throw console.error("Failed to decrypt project commits:",t),Error("Failed to decrypt project data. Please ensure you are logged in with the correct account.")}},[o]),n=(0,e.useCallback)(async e=>{if(!t)return void console.warn("Database not ready, returning undefined");try{let t=await r.DexieDB.structureData.get(e);if(t){let e=await i(t);return setTimeout(()=>{window.gc&&window.gc()},100),e}return}catch(t){console.error(`Failed to get decrypted project ${e}:`,t);return}},[t,i]),c=(0,e.useCallback)(async e=>{if(!t)return console.warn("Database not ready, returning empty array"),[];try{let t=await r.DexieDB.structureData.bulkGet(e),a=await Promise.all(t.filter(Boolean).map(t=>i(t)));return setTimeout(()=>{window.gc&&window.gc()},100),a}catch(t){return console.error("Failed to get decrypted projects:",t),[]}},[t,i]),s=(0,e.useCallback)(async(e,a)=>{if(!t)return void console.warn("Database not ready, returning undefined");try{let t=await r.DexieDB.structureData.get(e);if(!t)return;let i=t.commits.find(t=>t.commitId===a);if(!i)return;if(i.isEncrypted&&i.encryptedData&&i.iv){let t=o();if(!t||!(0,C.isTokenValidForEncryption)(t))return i;let e=await (0,C.decryptCommit)({encryptedData:i.encryptedData,iv:i.iv,originalCommitId:i.commitId,originalCommitName:i.commitName,originalParent:i.parent,originalCreatedAt:i.createdAt},t),r={...i,data:e.data,isEncrypted:!1,encryptedData:void 0,iv:void 0};return setTimeout(()=>{window.gc&&window.gc()},100),r}return i}catch(t){console.error(`Failed to get decrypted commit ${a} from project ${e}:`,t);return}},[t,o]),l=(0,e.useCallback)(async t=>{let e=o();if(!t.isSynced||!e||!(0,C.isTokenValidForEncryption)(e))return t;if(!crypto.subtle)return console.warn("Encryption not available in non-secure context, returning project unencrypted"),t;try{let r=await Promise.all(t.commits.map(async t=>{if(!t.isEncrypted){let r=await (0,C.encryptCommit)({data:t.data,commitId:t.commitId,commitName:t.commitName,parent:t.parent,createdAt:t.createdAt},e);return{...t,data:new ArrayBuffer(0),isEncrypted:!0,encryptedData:r.encryptedData,iv:r.iv}}return t}));return{...t,commits:r,isEncrypted:!0,encryptedAt:Date.now(),encryptionVersion:"1.0"}}catch(t){throw console.error("Failed to encrypt project commits:",t),Error("Failed to encrypt project data for sync.")}},[o]);(0,e.useEffect)(()=>{let t=async()=>{try{if(!window.indexedDB){console.error("IndexedDB is not available in this browser"),a(!1);return}await r.DexieDB.open(),a(!0),console.log("Database initialized successfully")}catch(e){console.error("Failed to initialize Dexie database:",e),a(!1),setTimeout(()=>{console.log("Retrying database initialization..."),t()},2e3)}};t()},[]);let d=(0,e.useCallback)(async()=>{if(!t)return console.warn("Database not ready, returning empty array"),[];try{let t=await r.DexieDB.structureData.toArray();return await Promise.all(t.map(t=>i(t)))}catch(t){return console.error("Failed to get all projects:",t),[]}},[t,i]),m=(0,e.useCallback)(async e=>{if(!t)return void console.warn("Database not ready, returning undefined");try{let t=await r.DexieDB.structureData.get(e);if(t)return await i(t);return}catch(t){console.error(`Failed to get project ${e}:`,t);return}},[t,i]),u=(0,e.useCallback)(async e=>{if(!t)throw Error("Database not ready");try{let t=D(),a={...e,id:t,date:Date.now()},o=await l(a);return await r.DexieDB.structureData.add(o),t}catch(t){throw console.error("Failed to create project:",t),t}},[t,l]),p=(0,e.useCallback)(async(e,a)=>{if(!t)throw Error("Database not ready");try{if(a.commits){let t=await r.DexieDB.structureData.get(e);if(t){let e={...t,...a},o=await l(e);await r.DexieDB.structureData.put(o);return}}await r.DexieDB.structureData.update(e,a)}catch(t){throw console.error(`Failed to update project ${e}:`,t),t}},[t,l]),y=(0,e.useCallback)(async e=>{if(!t)throw Error("Database not ready");try{await r.DexieDB.structureData.delete(e)}catch(t){throw console.error(`Failed to delete project ${e}:`,t),t}},[t]),f=(0,e.useCallback)(async(e,a)=>{if(!t)throw Error("Database not ready");try{await r.DexieDB.structureData.update(e,{isSynced:!0,syncedProjectId:a})}catch(t){throw console.error(`Failed to mark project ${e} as synced:`,t),t}},[t]);return{isReady:t,getAllProjects:d,getProject:m,createProject:u,updateProject:p,deleteProject:y,markProjectAsSynced:f,getDecryptedProject:n,getDecryptedProjects:c,getDecryptedCommit:s}}t.s(["createId",()=>D,"getProjectSyncStatus",()=>P,"pullRemoteProject",()=>x,"reconstructBranchesFromParents",()=>b,"refreshPublicClonedProject",()=>A,"sortCommitsChronologically",()=>j,"syncProjectToCloud",()=>I],20819),t.s(["useDexie",()=>k],29233)},97551,t=>{t.v(t=>Promise.resolve().then(()=>t(15556)))},71710,t=>{t.v(t=>Promise.resolve().then(()=>t(29233)))}]);