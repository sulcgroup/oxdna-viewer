(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,51462,e=>{"use strict";var t,a=e.i(90425),r=e.i(38898),s=e.i(3614),n=e.i(29233),i=e.i(22348),l=e.i(42163),c=e.i(69496),o=e.i(80559),d=e.i(66145),m=e.i(93783);let u=(0,m.default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var h=e.i(74502);let f=(0,m.default)("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),x=(0,m.default)("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]),p=(0,m.default)("CloudDownload",[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]]),y=(0,m.default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),g=(0,m.default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),j=(0,m.default)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);function v({syncState:e}){let{status:t,direction:r}=e,s=(()=>{if("out-of-sync"===t&&r)switch(r){case"push":return"↑";case"pull":return"↓";case"both":return"↕"}return null})();return(0,a.jsxs)(h.Badge,{variant:(()=>{switch(t){case"local":return"secondary";case"synced":return"success";case"out-of-sync":case"public-out-of-sync":return"warning";case"conflict":return"destructive";default:return"default"}})(),className:"flex items-center gap-1",children:[(()=>{switch(t){case"local":default:return(0,a.jsx)(f,{className:"h-3 w-3"});case"synced":return(0,a.jsx)(g,{className:"h-3 w-3"});case"out-of-sync":if("push"===r)return(0,a.jsx)(x,{className:"h-3 w-3"});if("pull"===r)return(0,a.jsx)(p,{className:"h-3 w-3"});return(0,a.jsx)(f,{className:"h-3 w-3"});case"conflict":return(0,a.jsx)(y,{className:"h-3 w-3"});case"public-synced":case"public-out-of-sync":return(0,a.jsx)(j,{className:"h-3 w-3"})}})(),(0,a.jsx)("span",{children:(()=>{switch(t){case"local":return"Local";case"synced":return"Synced";case"out-of-sync":if("push"===r)return"Push";if("pull"===r)return"Pull";return"Out of Sync";case"conflict":return"Conflict";case"public-synced":return"Public";case"public-out-of-sync":return"Update Available";default:return"Unknown"}})()}),s&&(0,a.jsx)("span",{className:"ml-1",children:s})]})}var w=e.i(19527);let b=(0,m.default)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var N=e.i(807);let C=(0,m.default)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);var k=e.i(20819);function P({refreshCallback:e}={}){let{getProject:t,deleteProject:a,markProjectAsSynced:s}=(0,n.useDexie)(),{toast:c}=(0,i.useToast)(),o=(0,r.useCallback)(async(a,r)=>{try{if(!await t(a))throw Error("Local project not found");return await (0,k.syncProjectToCloud)(a,r),c({title:"Project synced successfully",description:`${r} has been synced to the cloud`,variant:"default"}),e&&e(),{success:!0,message:"Project synced successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return c({title:"Sync failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[t,c,e]),d=(0,r.useCallback)(async(t,a)=>{try{return await (0,k.pullRemoteProject)(t,a),c({title:"Project pulled successfully",description:"Remote project has been pulled to local",variant:"default"}),e&&e(),{success:!0,message:"Project pulled successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return c({title:"Pull failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[c,e]),m=(0,r.useCallback)(async t=>{try{return await a(t),c({title:"Project deleted",description:"Local project has been deleted",variant:"default"}),e&&e(),{success:!0,message:"Project deleted successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return c({title:"Delete failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[a,c,e]),u=(0,r.useCallback)(async a=>{try{let r=await t(a);if(!r?.syncedProjectId)throw Error("Project is not synced to cloud");if(!await (0,l.deleteSyncedProject)(r.syncedProjectId))throw Error("Failed to delete remote project");return await s(a,""),c({title:"Remote project deleted",description:"Remote project has been deleted",variant:"default"}),e&&e(),{success:!0,message:"Remote project deleted successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return c({title:"Delete failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[t,s,c,e]),h=(0,r.useCallback)(async a=>{try{let r=await t(a);if(!r?.syncedProjectId)throw Error("Project must be synced to toggle public status");let s=await (0,l.toggleProjectPublic)(r.syncedProjectId);if(!s.success)throw Error("Failed to toggle public status");return c({title:"Public status updated",description:`Project is now ${s.isPublic?"public":"private"}`,variant:"default"}),e&&e(),{success:!0,message:"Public status updated successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return c({title:"Toggle failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[t,c,e]);return{syncToCloud:o,pullFromRemote:d,deleteLocal:m,deleteRemote:u,togglePublic:h,refreshPublicClone:(0,r.useCallback)(async t=>{try{if(!t.publicSourceId)throw Error("Project is not a public clone");return await (0,k.refreshPublicClonedProject)(t),c({title:"Public clone refreshed",description:"Project has been updated with latest public commits",variant:"default"}),e&&e(),{success:!0,message:"Public clone refreshed successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return c({title:"Refresh failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[c,e]),resolveConflict:(0,r.useCallback)(async(t,a)=>{try{return await (0,k.pullRemoteProject)(t.id,a.id),await (0,k.syncProjectToCloud)(t.id,t.structureName),c({title:"Conflict resolved",description:"Local changes have been preserved and synced to cloud",variant:"default"}),e&&e(),{success:!0,message:"Conflict resolved successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return c({title:"Conflict resolution failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[c,e])}}var M=e.i(10837);let D=(0,m.default)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);var S=e.i(57021),E=e.i(73672),F=e.i(88177),I=e.i(76832);let T=(0,F.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),A=r.forwardRef(({className:e,variant:t,...r},s)=>(0,a.jsx)("div",{ref:s,role:"alert",className:(0,I.cn)(T({variant:t}),e),...r}));A.displayName="Alert",r.forwardRef(({className:e,...t},r)=>(0,a.jsx)("h5",{ref:r,className:(0,I.cn)("mb-1 font-medium leading-none tracking-tight",e),...t})).displayName="AlertTitle";let B=r.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,I.cn)("text-sm [&_p]:leading-relaxed",e),...t}));B.displayName="AlertDescription";let U=(0,m.default)("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),W=(0,m.default)("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);var z=e.i(59822);async function R(e){let t=localStorage.getItem("token");if(!e.isEncrypted||!t||!(0,z.isTokenValidForEncryption)(t))return e;try{let a=await Promise.all(e.commits.map(async e=>{if(e.isEncrypted&&e.encryptedData&&e.iv){let a=await (0,z.decryptCommit)({encryptedData:e.encryptedData,iv:e.iv,originalCommitId:e.commitId,originalCommitName:e.commitName,originalParent:e.parent,originalCreatedAt:e.createdAt},t);return{...e,data:a.data,isEncrypted:!1,encryptedData:void 0,iv:void 0}}return e}));return{...e,commits:a,isEncrypted:!1,encryptedAt:void 0,encryptionVersion:void 0}}catch(e){throw console.error("Failed to decrypt project on-demand:",e),Error("Failed to decrypt project data. Please ensure you are logged in with the correct account.")}}async function L(e){let t=localStorage.getItem("token");if(!e.isEncrypted||!t||!(0,z.isTokenValidForEncryption)(t))return e;try{if(e.encryptedData&&e.iv){let a=await (0,z.decryptCommit)({encryptedData:e.encryptedData,iv:e.iv,originalCommitId:e.commitId,originalCommitName:e.commitName,originalParent:e.parent,originalCreatedAt:e.createdAt},t);return{...e,data:a.data,isEncrypted:!1,encryptedData:void 0,iv:void 0}}return e}catch(e){throw console.error("Failed to decrypt commit on-demand:",e),Error("Failed to decrypt commit data. Please ensure you are logged in with the correct account.")}}async function q(e){let t=localStorage.getItem("token");if(!t||!(0,z.isTokenValidForEncryption)(t))return e;try{let t=await Promise.all(e.map(e=>R(e)));return setTimeout(()=>{window.gc&&window.gc()},100),t}catch(e){throw console.error("Failed to decrypt projects on-demand:",e),e}}function H(){window.gc&&window.gc()}function O(e){return!!e.isEncrypted}function X(e){return!!e.isEncrypted}function $({commit:t,projectId:s,isCurrentCommit:n=!1,isBranchHead:d=!1,branchName:m,branchColor:u,isCurrentBranch:f=!1,shareInfo:x}){let{toast:p}=(0,i.useToast)(),{decryptCommit:y,isDecrypting:g}=function(){let{toast:e}=(0,i.useToast)(),[t,a]=(0,r.useState)(!1),s=(0,r.useRef)(null),n=(0,r.useCallback)(()=>{s.current&&(clearTimeout(s.current),s.current=null)},[]),l=(0,r.useCallback)(async(t,r=5e3)=>{if(!O(t))return t;a(!0),n();try{let e=await R(t);return s.current=setTimeout(()=>{H(),s.current=null},r),e}catch(t){return console.error("Failed to decrypt project:",t),e({title:"Decryption Failed",description:"Failed to decrypt project data. Please ensure you are logged in with the correct account.",variant:"destructive"}),null}finally{a(!1)}},[e,n]),c=(0,r.useCallback)(async(t,r=5e3)=>{if(!X(t))return t;a(!0),n();try{let e=await L(t);return s.current=setTimeout(()=>{H(),s.current=null},r),e}catch(t){return console.error("Failed to decrypt commit:",t),e({title:"Decryption Failed",description:"Failed to decrypt commit data. Please ensure you are logged in with the correct account.",variant:"destructive"}),null}finally{a(!1)}},[e,n]),o=(0,r.useCallback)(async(t,r=5e3)=>{a(!0),n();try{let e=await q(t);return s.current=setTimeout(()=>{H(),s.current=null},r),e}catch(t){return console.error("Failed to decrypt projects:",t),e({title:"Decryption Failed",description:"Failed to decrypt project data. Please ensure you are logged in with the correct account.",variant:"destructive"}),[]}finally{a(!1)}},[e,n]);return{isDecrypting:t,decryptProject:l,decryptCommit:c,decryptProjects:o,clearDecryptedData:(0,r.useCallback)(()=>{n(),H(),e({title:"Data Cleared",description:"Decrypted data has been cleared from memory.",variant:"default"})},[e,n]),needsDecryption:(0,r.useCallback)(e=>"commits"in e?O(e):X(e),[])}}(),[j,v]=(0,r.useState)(!1),[w,b]=(0,r.useState)(!1),C=async()=>{if(x)return void b(!0);v(!0);try{let{useDexie:a}=await e.A(71710),{getProject:r}=a(),n=await r(s);if(!n)throw Error("Project not found");let i=n.commits?.find(e=>e.commitId===t.commitId);if(!i)throw Error("Commit not found");let c=i;if(i.isEncrypted){let e=await y(i);if(!e)throw Error("Failed to decrypt commit for sharing");c=e}if(!c.data||0===c.data.byteLength)throw Error("Commit data not available");let o=new Uint8Array(c.data),d=Array.from(o,e=>String.fromCharCode(e)).join(""),m=btoa(d),u={structureName:n.structureName,commit:{commitId:t.commitId,commitName:t.commitName,data:m,parent:c.parent}},h=await (0,l.shareCommit)(u);if(h&&h.shareUrl){let a={shareUrl:h.shareUrl,shareId:h.shareId,createdAt:new Date(Date.now()),expiresAt:new Date(Date.now()+2592e6)},r=n.commits?.map(e=>e.commitId===t.commitId?{...e,shareInfo:a}:e);await e.A(97551).then(({DexieDB:e})=>e.structureData.update(s,{commits:r})),b(!0),p({title:"Commit shared successfully",description:"Share link created and copied"})}else throw Error("Failed to create share link")}catch(e){console.error("Error sharing commit:",e),p({title:"Failed to share commit",description:e instanceof Error?e.message:"Unknown error",variant:"destructive"})}finally{v(!1)}},k=t.createdAt||t.date;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(c.Card,{className:`relative ${n?"ring-2 ring-blue-500":""}`,children:[(0,a.jsx)(c.CardHeader,{className:"pb-2",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("h3",{className:"font-semibold text-sm",children:t.commitName}),n&&(0,a.jsx)(h.Badge,{variant:"default",className:"text-xs",children:"Current"}),d&&m&&(0,a.jsxs)(h.Badge,{variant:"secondary",className:`text-xs ${f?"bg-orange-500 text-white":""}`,title:f?"Current branch":void 0,children:[(0,a.jsx)(W,{className:"h-3 w-3 mr-1"}),m]}),x&&(0,a.jsx)(h.Badge,{variant:"outline",className:"text-xs",children:"Shared"})]}),u&&(0,a.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:u}})]})}),(0,a.jsxs)(c.CardContent,{className:"pt-0",children:[(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mb-3",children:[(e=>{if(!e)return"Unknown date";let t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})(k),x&&(0,a.jsxs)("span",{className:"ml-2 text-green-600",children:["• Shared on ",new Date(x.createdAt).toLocaleDateString()]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(o.Button,{size:"sm",variant:"outline",onClick:()=>{window.location.href=`/?structureId=${s}&commit=${t.commitId}&load=true`},className:"flex items-center gap-1 text-xs h-8",children:[(0,a.jsx)(N.Eye,{className:"h-3 w-3"}),"View"]}),(0,a.jsxs)(o.Button,{size:"sm",variant:"outline",onClick:C,disabled:j||g,className:"flex items-center gap-1 text-xs h-8",title:x?`Shared on ${new Date(x.createdAt).toLocaleDateString()}`:"Generate shareable link",children:[(0,a.jsx)(U,{className:"h-3 w-3"}),j?"Sharing...":g?"Decrypting...":"Share"]})]})]})]}),w&&x&&(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:()=>b(!1)}),(0,a.jsxs)("div",{className:"relative bg-white rounded-lg shadow-lg p-6 max-w-md w-full mx-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Share Link"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Your share link:"}),(0,a.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,a.jsx)("input",{type:"text",value:x.shareUrl,readOnly:!0,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-sm"}),(0,a.jsx)(o.Button,{size:"sm",onClick:()=>{navigator.clipboard.writeText(x.shareUrl),p({title:"Copied!",description:"Share link copied to clipboard"})},children:"Copy"})]}),(0,a.jsx)("div",{className:"flex justify-end gap-2",children:(0,a.jsx)(o.Button,{variant:"outline",size:"sm",onClick:()=>b(!1),children:"Close"})})]})]})]})}let Y=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#14b8a6","#f97316"];function V({commits:e,currentCommitId:t,branches:r,projectId:s,currentBranchName:n="main"}){if(!e||0===e.length)return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,a.jsx)(W,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No commits found"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"This project doesn't have any commit history yet."})]});let i=new Map;e.forEach(e=>{i.set(e.commitId,e)});let l=new Map;e.forEach(e=>{let t=e.parent;t&&(l.has(t)||l.set(t,[]),l.get(t).push(e.commitId))});let c=new Map;Object.entries(r).forEach(([e,t])=>{if(t.length>0){let a=t[t.length-1];c.set(a,e)}});let o=new Map,d=0;Object.keys(r).forEach(e=>{o.set(e,Y[d%Y.length]),d++});let m=new Map;Object.entries(r).forEach(([e,t])=>{t.forEach(t=>{m.has(t)||m.set(t,e)})});let u=(e,r=0)=>{let d=i.get(e);if(!d)return null;let h=e===t,f=c.has(e),x=m.get(e),p=o.get(x),y=x===n,g=l.get(e)||[];return(0,a.jsxs)("div",{className:"commit-node relative ml-5 border-l-2 border-gray-300 pl-4",children:[(0,a.jsx)("div",{className:"absolute -left-[9px] top-1.5 w-[15px] h-[15px] rounded-full bg-blue-500 border-2 border-white z-10"}),(0,a.jsx)("div",{className:"commit-details mb-2",children:(0,a.jsx)($,{commit:d,projectId:s,isCurrentCommit:h,isBranchHead:f,branchName:x,branchColor:p,isCurrentBranch:y})}),g.length>0&&(0,a.jsx)("div",{className:"children ml-4",children:g.map(e=>u(e,r+1))})]},e)},h=e.filter(e=>!e.parent);return(0,a.jsxs)("div",{className:"p-4 overflow-auto max-h-[600px]",children:[(0,a.jsx)("div",{className:"space-y-2",children:h.map(e=>u(e.commitId))}),Object.keys(r).length>1&&(0,a.jsxs)("div",{className:"mt-6 pt-4 border-t",children:[(0,a.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Branches"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:Object.entries(r).map(([e,t])=>{let r=e===n;return(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:o.get(e)}}),(0,a.jsx)("span",{className:r?"font-bold":"",children:e}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:["(",t.length,")"]}),r&&(0,a.jsx)("span",{className:"ml-1 px-1 py-0.5 text-xs bg-orange-100 text-orange-800 rounded",children:"current"})]},e)})})]})]})}var J=e.i(62684),G=e.i(67147);function Q({isOpen:e,onClose:t,projectId:s,projectName:i}){let l=(0,G.useSearchParams)().get("branch")||"main",{commits:c,loading:d,error:m,currentCommitId:u,branches:h}=function(e){let{getProject:t}=(0,n.useDexie)(),[a,s]=(0,r.useState)({commits:[],loading:!0,error:null,currentCommitId:null,branches:{}});return(0,r.useEffect)(()=>{(async()=>{try{s(e=>({...e,loading:!0,error:null}));let a=await t(e);if(!a)return void s(e=>({...e,loading:!1,error:"Project not found",commits:[],currentCommitId:null,branches:{}}));let r=a.commits||[],n=(0,k.sortCommitsChronologically)(r),i=n.length>0?n[0].commitId:null,l=(0,k.reconstructBranchesFromParents)(n);s({commits:n,loading:!1,error:null,currentCommitId:i,branches:l})}catch(e){console.error("Error fetching commit history:",e),s(t=>({...t,loading:!1,error:e instanceof Error?e.message:"Unknown error",commits:[],currentCommitId:null,branches:{}}))}})()},[e,t]),a}(s);return(0,a.jsx)(S.Dialog,{open:e,onOpenChange:t,children:(0,a.jsxs)(S.DialogContent,{className:"max-w-4xl max-h-[80vh] flex flex-col","aria-describedby":"commit-history-description",children:[(0,a.jsxs)(S.DialogHeader,{className:"flex flex-row items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(W,{className:"h-5 w-5"}),(0,a.jsx)(S.DialogTitle,{children:"Commit History"})]}),(0,a.jsx)(o.Button,{variant:"ghost",size:"sm",onClick:t,className:"h-8 w-8 p-0",children:(0,a.jsx)(J.X,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"flex flex-col flex-1 min-h-0",children:[(0,a.jsxs)("div",{className:"mb-4 pb-4 border-b",id:"commit-history-description",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:i}),!d&&!m&&(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[c.length," ",1===c.length?"commit":"commits"," in ",Object.keys(h).length," ",1===Object.keys(h).length?"branch":"branches"]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:d?(0,a.jsxs)("div",{className:"space-y-4 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(E.Skeleton,{className:"h-5 w-5"}),(0,a.jsx)(E.Skeleton,{className:"h-4 w-32"})]}),(0,a.jsx)("div",{className:"space-y-2",children:Array.from({length:3}).map((e,t)=>(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsx)(E.Skeleton,{className:"h-4 w-40"}),(0,a.jsx)(E.Skeleton,{className:"h-6 w-20"})]}),(0,a.jsx)(E.Skeleton,{className:"h-3 w-32 mb-3"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(E.Skeleton,{className:"h-8 w-16"}),(0,a.jsx)(E.Skeleton,{className:"h-8 w-16"})]})]},t))})]}):m?(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)(A,{variant:"destructive",children:[(0,a.jsx)(y,{className:"h-4 w-4"}),(0,a.jsxs)(B,{children:["Failed to load commit history: ",m]})]})}):0===c.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,a.jsx)(W,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No commits found"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"This project doesn't have any commit history yet."})]}):(0,a.jsx)(V,{commits:c,currentCommitId:u,branches:h,projectId:s,currentBranchName:l})}),(0,a.jsx)("div",{className:"flex justify-end pt-4 border-t mt-4",children:(0,a.jsx)(o.Button,{variant:"outline",onClick:t,children:"Close"})})]})]})})}function _({project:e,syncState:t,onRefresh:s}){let n,{syncToCloud:l,pullFromRemote:c,deleteLocal:m,deleteRemote:u,togglePublic:h,refreshPublicClone:f}=P({refreshCallback:s}),{toast:y}=(0,i.useToast)(),[g,v]=(0,r.useState)(!1),k=async()=>{await l(e.id,e.structureName)},S=async()=>{await c(e.id)},E=async()=>{await m(e.id)},F=async()=>{await u(e.id)},I=async()=>{await h(e.id)},T=async()=>{await f(e)},A=(()=>{switch(t.status){case"local":return{label:"Sync to Cloud",icon:x,onClick:k,variant:"default"};case"synced":case"public-synced":default:return null;case"out-of-sync":if("push"===t.direction)return{label:"Push Changes",icon:x,onClick:k,variant:"default"};if("pull"===t.direction)return{label:"Pull Updates",icon:p,onClick:S,variant:"default"};return null;case"conflict":return{label:"Resolve Conflict",icon:b,onClick:S,variant:"destructive"};case"public-out-of-sync":return{label:"Update from Public",icon:d.RefreshCw,onClick:T,variant:"default"}}})(),B=((n=[]).push({label:"Delete Local",icon:w.Trash2,onClick:E,destructive:!0}),"local"!==t.status&&e.syncedProjectId&&n.push({label:"Delete from Cloud",icon:w.Trash2,onClick:F,destructive:!0}),"local"!==t.status&&e.syncedProjectId&&n.push({label:e.isPublic?"Make Private":"Make Public",icon:j,onClick:I,destructive:!1}),n);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(o.Button,{size:"sm",variant:"secondary",onClick:()=>{let t=e.commits?.[e.commits.length-1];t?.commitId?window.location.href=`/?structureId=${e.id}&commit=${t.commitId}&load=true`:window.location.href=`/?structureId=${e.id}&load=true`},className:"flex items-center gap-1",children:[(0,a.jsx)(N.Eye,{className:"h-4 w-4"}),"Open Project"]}),e.commits&&e.commits.length>0&&(0,a.jsxs)(o.Button,{size:"sm",variant:"outline",onClick:()=>{v(!0)},className:"flex items-center gap-1",children:[(0,a.jsx)(C,{className:"h-4 w-4"}),"View History"]}),A&&(0,a.jsxs)(o.Button,{size:"sm",variant:A.variant,onClick:A.onClick,className:"flex items-center gap-1",children:[(0,a.jsx)(A.icon,{className:"h-4 w-4"}),A.label]}),B.length>0&&(0,a.jsxs)(M.DropdownMenu,{children:[(0,a.jsx)(M.DropdownMenuTrigger,{asChild:!0,children:(0,a.jsx)(o.Button,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",children:(0,a.jsx)(D,{className:"h-4 w-4"})})}),(0,a.jsx)(M.DropdownMenuContent,{align:"end",children:B.map((e,t)=>(0,a.jsxs)(M.DropdownMenuItem,{onClick:e.onClick,className:e.destructive?"text-destructive":"",children:[(0,a.jsx)(e.icon,{className:"mr-2 h-4 w-4"}),e.label]},t))})]})]}),(0,a.jsx)(Q,{isOpen:g,onClose:()=>v(!1),projectId:e.id,projectName:e.structureName})]})}function K(e){let t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new e.constructor(+e):new Date("number"==typeof e||"[object Number]"===t||"string"==typeof e||"[object String]"===t?e:NaN)}function Z(e,t){let a=K(e),r=K(t),s=a.getTime()-r.getTime();return s<0?-1:s>0?1:s}let ee={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function et(e){return (t={})=>{let a=t.width?String(t.width):e.defaultWidth;return e.formats[a]||e.formats[e.defaultWidth]}}let ea={date:et({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:et({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:et({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},er={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function es(e){return(t,a)=>{let r;if("formatting"===(a?.context?String(a.context):"standalone")&&e.formattingValues){let t=e.defaultFormattingWidth||e.defaultWidth,s=a?.width?String(a.width):t;r=e.formattingValues[s]||e.formattingValues[t]}else{let t=e.defaultWidth,s=a?.width?String(a.width):e.defaultWidth;r=e.values[s]||e.values[t]}return r[e.argumentCallback?e.argumentCallback(t):t]}}function en(e){return(t,a={})=>{let r,s=a.width,n=s&&e.matchPatterns[s]||e.matchPatterns[e.defaultMatchWidth],i=t.match(n);if(!i)return null;let l=i[0],c=s&&e.parsePatterns[s]||e.parsePatterns[e.defaultParseWidth],o=Array.isArray(c)?function(e,t){for(let a=0;a<e.length;a++)if(t(e[a]))return a}(c,e=>e.test(l)):function(e,t){for(let a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&t(e[a]))return a}(c,e=>e.test(l));return r=e.valueCallback?e.valueCallback(o):o,{value:r=a.valueCallback?a.valueCallback(r):r,rest:t.slice(l.length)}}}let ei={code:"en-US",formatDistance:(e,t,a)=>{let r,s=ee[e];if(r="string"==typeof s?s:1===t?s.one:s.other.replace("{{count}}",t.toString()),a?.addSuffix)if(a.comparison&&a.comparison>0)return"in "+r;else return r+" ago";return r},formatLong:ea,formatRelative:(e,t,a,r)=>er[e],localize:{ordinalNumber:(e,t)=>{let a=Number(e),r=a%100;if(r>20||r<10)switch(r%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},era:es({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:es({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:es({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:es({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:es({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(t={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)},(e,a={})=>{let r=e.match(t.matchPattern);if(!r)return null;let s=r[0],n=e.match(t.parsePattern);if(!n)return null;let i=t.valueCallback?t.valueCallback(n[0]):n[0];return{value:i=a.valueCallback?a.valueCallback(i):i,rest:e.slice(s.length)}}),era:en({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:en({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:en({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:en({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:en({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}},el={};function ec(e){let t=K(e),a=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return a.setUTCFullYear(t.getFullYear()),e-a}function eo(e,t){var a;return function(e,t,a){var r,s,n;let i,l,c,o=a?.locale??el.locale??ei,d=Z(e,t);if(isNaN(d))throw RangeError("Invalid time value");let m=Object.assign({},a,{addSuffix:a?.addSuffix,comparison:d});d>0?(i=K(t),l=K(e)):(i=K(e),l=K(t));let u=(r=l,s=i,(n=void 0,e=>{let t=(n?Math[n]:Math.trunc)(e);return 0===t?0:t})((K(r)-K(s))/1e3)),h=Math.round((u-(ec(l)-ec(i))/1e3)/60);if(h<2)if(a?.includeSeconds)if(u<5)return o.formatDistance("lessThanXSeconds",5,m);else if(u<10)return o.formatDistance("lessThanXSeconds",10,m);else if(u<20)return o.formatDistance("lessThanXSeconds",20,m);else if(u<40)return o.formatDistance("halfAMinute",0,m);else if(u<60)return o.formatDistance("lessThanXMinutes",1,m);else return o.formatDistance("xMinutes",1,m);else if(0===h)return o.formatDistance("lessThanXMinutes",1,m);else return o.formatDistance("xMinutes",h,m);if(h<45)return o.formatDistance("xMinutes",h,m);if(h<90)return o.formatDistance("aboutXHours",1,m);if(h<1440){let e=Math.round(h/60);return o.formatDistance("aboutXHours",e,m)}if(h<2520)return o.formatDistance("xDays",1,m);else if(h<43200){let e=Math.round(h/1440);return o.formatDistance("xDays",e,m)}else if(h<86400)return c=Math.round(h/43200),o.formatDistance("aboutXMonths",c,m);if((c=function(e,t){let a,r,s,n=K(e),i=K(t),l=Z(n,i),c=Math.abs((r=K(n),s=K(i),12*(r.getFullYear()-s.getFullYear())+(r.getMonth()-s.getMonth())));if(c<1)a=0;else{var o;let t,r,s,d;1===n.getMonth()&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-l*c);let m=Z(n,i)===-l;o=K(e),d=K(o),+((t=K(d)).setHours(23,59,59,999),t)==+(s=(r=K(d)).getMonth(),r.setFullYear(r.getFullYear(),s+1,0),r.setHours(23,59,59,999),r)&&1===c&&1===Z(e,i)&&(m=!1),a=l*(c-Number(m))}return 0===a?0:a}(l,i))<12){let e=Math.round(h/43200);return o.formatDistance("xMonths",e,m)}{let e=c%12,t=Math.trunc(c/12);return e<3?o.formatDistance("aboutXYears",t,m):e<9?o.formatDistance("overXYears",t,m):o.formatDistance("almostXYears",t+1,m)}}(e,(a=Date.now(),e instanceof Date?new e.constructor(a):new Date(a)),t)}let ed=(0,m.default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),em=(0,m.default)("GitCommitHorizontal",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]]),eu=(0,m.default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),eh=(0,m.default)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),ef=(0,m.default)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);function ex({project:e,onRefresh:t}){let{syncState:s,loading:n}=function({project:e}){let[t,a]=(0,r.useState)({status:"local",localCommitCount:0}),[s,n]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{(async()=>{if(!e)return a({status:"local",localCommitCount:0});n(!0);try{let t=await (0,k.getProjectSyncStatus)(e);a(t)}catch(t){console.error("Failed to get project sync status:",t),a({status:"local",localCommitCount:e.commits?.length||0})}finally{n(!1)}})()},[e]),{syncState:t,loading:s}}({project:e}),i=e.commits?.[e.commits.length-1],l=e.commits?.length||0;return n?(0,a.jsxs)(c.Card,{className:"animate-pulse",children:[(0,a.jsxs)(c.CardHeader,{children:[(0,a.jsx)("div",{className:"h-6 bg-gray-200 rounded w-3/4 mb-2"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]}),(0,a.jsx)(c.CardContent,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})})]}):(0,a.jsxs)(c.Card,{className:"transition-all duration-200 hover:shadow-lg",children:[(0,a.jsx)(c.CardHeader,{className:"pb-3",children:(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold truncate",title:e.structureName,children:e.structureName}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)(v,{syncState:s}),e.isPublic&&(0,a.jsxs)(h.Badge,{variant:"outline",className:"flex items-center gap-1",children:[(0,a.jsx)(ef,{className:"h-3 w-3"}),"Public"]})]})]})})}),(0,a.jsx)(c.CardContent,{className:"pb-3",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,a.jsx)(ed,{className:"h-4 w-4 mr-2"}),(0,a.jsxs)("span",{children:["Modified ",(e=>{try{return eo(new Date(e),{addSuffix:!0})}catch{return"Unknown date"}})(e.date)]})]}),i&&(0,a.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,a.jsx)(em,{className:"h-4 w-4 mr-2"}),(0,a.jsxs)("span",{children:[l," commit",1!==l?"s":""]}),i.commitName&&(0,a.jsxs)("span",{className:"ml-2 truncate",title:i.commitName,children:["- ",i.commitName]})]}),void 0!==s.localCommitCount&&void 0!==s.remoteCommitCount&&(0,a.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,a.jsx)(eu,{className:"h-4 w-4 mr-2"}),(0,a.jsxs)("span",{children:[s.localCommitCount," local, ",s.remoteCommitCount," remote"]})]}),e.publicSourceId&&(0,a.jsxs)("div",{className:"flex items-center text-sm text-blue-600",children:[(0,a.jsx)(eh,{className:"h-4 w-4 mr-2"}),(0,a.jsx)("span",{children:"Cloned from public project"})]})]})}),(0,a.jsx)(c.CardFooter,{className:"pt-0",children:(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(_,{project:e,syncState:s,onRefresh:t})})})]})}var ep=e.i(84350);function ey({project:e,onRefresh:t}){let{pullFromRemote:r}=P({refreshCallback:t}),s=async()=>{await r(e,e.id)};return(0,a.jsxs)(c.Card,{className:"transition-all duration-200 hover:shadow-lg",children:[(0,a.jsx)(c.CardHeader,{className:"pb-3",children:(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold truncate",title:e.projectName,children:e.projectName}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsxs)(h.Badge,{variant:"outline",className:"flex items-center gap-1",children:[(0,a.jsx)(f,{className:"h-3 w-3"}),"Remote"]}),e.isPublic&&(0,a.jsxs)(h.Badge,{variant:"outline",className:"flex items-center gap-1",children:[(0,a.jsx)(N.Eye,{className:"h-3 w-3"}),"Public"]})]})]})})}),(0,a.jsx)(c.CardContent,{className:"pb-3",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,a.jsx)(ed,{className:"h-4 w-4 mr-2"}),(0,a.jsxs)("span",{children:["Created ",(e=>{try{let t="string"==typeof e?parseInt(e):e;return eo(new Date(t),{addSuffix:!0})}catch{return"Unknown date"}})(e.createdAt)]})]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,a.jsx)(em,{className:"h-4 w-4 mr-2"}),(0,a.jsxs)("span",{children:[e.commitCount," commit",1!==e.commitCount?"s":""]})]}),e.latestCommit&&(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,a.jsx)("div",{className:"font-medium",children:"Latest commit:"}),(0,a.jsx)("div",{className:"truncate",title:e.latestCommit.commitName,children:e.latestCommit.commitName})]})]})}),(0,a.jsx)(c.CardFooter,{className:"pt-0",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,a.jsxs)(o.Button,{onClick:()=>{e.latestCommit?.id?window.open(`/?publicProject=${e.id}&commit=${e.latestCommit.id}&load=true`,"_blank"):window.open(`/?publicProject=${e.id}&load=true`,"_blank")},className:"w-full flex items-center gap-2",variant:"outline",children:[(0,a.jsx)(N.Eye,{className:"h-4 w-4"}),"Preview Project"]}),(0,a.jsxs)(o.Button,{onClick:s,className:"w-full flex items-center gap-2",variant:"default",children:[(0,a.jsx)(ep.Download,{className:"h-4 w-4"}),"Pull Project"]})]})})]})}var eg=e.i(44187);let ej=(0,m.default)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var ev=e.i(44089);let ew=(0,m.default)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);function eb({commit:e,onRefresh:t}){let[s,n]=(0,r.useState)(!1),{toast:l}=(0,i.useToast)(),d=async()=>{try{await navigator.clipboard.writeText(e.shareUrl),n(!0),l({title:"URL copied",description:"Share URL has been copied to clipboard",variant:"default"}),setTimeout(()=>n(!1),2e3)}catch(e){l({title:"Failed to copy",description:"Could not copy URL to clipboard",variant:"destructive"})}},m=async()=>{try{if(!(await fetch(`/api/v1/share/commit/${e.commitId}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok)throw Error("Failed to delete shared commit");l({title:"Share deleted",description:"The shared commit has been removed",variant:"default"}),t()}catch(e){l({title:"Delete failed",description:"Could not delete the shared commit",variant:"destructive"})}};return(0,a.jsxs)(c.Card,{className:"transition-all duration-200 hover:shadow-lg",children:[(0,a.jsx)(c.CardHeader,{className:"pb-3",children:(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold truncate",title:e.commitName,children:e.commitName}),(0,a.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,a.jsxs)(h.Badge,{variant:"outline",className:"flex items-center gap-1",children:[(0,a.jsx)(ew,{className:"h-3 w-3"}),"Shared"]})})]})})}),(0,a.jsx)(c.CardContent,{className:"pb-3",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,a.jsx)(ed,{className:"h-4 w-4 mr-2"}),(0,a.jsxs)("span",{children:["Shared ",(e=>{try{return eo(new Date(e),{addSuffix:!0})}catch{return"Unknown date"}})(e.createdAt)]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Share URL:"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(eg.Input,{value:e.shareUrl,readOnly:!0,className:"flex-1 text-sm"}),(0,a.jsx)(o.Button,{size:"sm",variant:"outline",onClick:d,className:"flex items-center gap-1",children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ev.Check,{className:"h-4 w-4"}),"Copied"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ej,{className:"h-4 w-4"}),"Copy"]})})]})]})]})}),(0,a.jsx)(c.CardFooter,{className:"pt-0",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(o.Button,{onClick:()=>{window.open(e.shareUrl,"_blank")},className:"flex-1 flex items-center gap-2",variant:"default",children:[(0,a.jsx)(eh,{className:"h-4 w-4"}),"Load Commit"]}),(0,a.jsxs)(o.Button,{onClick:m,className:"flex items-center gap-2",variant:"destructive",size:"sm",children:[(0,a.jsx)(w.Trash2,{className:"h-4 w-4"}),"Delete Share"]})]})})]})}var eN=e.i(45537),eC=e.i(69106);function ek({items:e,renderItem:t,emptyMessage:s="No items to display",itemsPerPage:n=6}){let[i,l]=(0,r.useState)(1),c=Math.ceil(e.length/n),d=(i-1)*n,m=d+n,u=e.slice(d,m);return 0===e.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,a.jsx)("div",{className:"text-muted-foreground mb-2",children:(0,a.jsx)("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,a.jsx)("path",{vectorEffect:"non-scaling-stroke",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})})}),(0,a.jsx)("h3",{className:"text-lg font-semibold",children:s}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Get started by creating your first project."})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map((e,a)=>t(e,d+a))}),c>1&&(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsxs)(o.Button,{variant:"outline",size:"sm",onClick:()=>{i>1&&l(i-1)},disabled:1===i,className:"flex items-center gap-1",children:[(0,a.jsx)(eN.ChevronLeft,{className:"h-4 w-4"}),"Previous"]}),(0,a.jsx)("div",{className:"flex items-center gap-1",children:(()=>{let e=[];if(c<=5)for(let t=1;t<=c;t++)e.push(t);else{e.push(1),i>3&&e.push("...");let t=Math.max(2,i-1),a=Math.min(c-1,i+1);for(let r=t;r<=a;r++)e.push(r);i<c-2&&e.push("..."),e.push(c)}return e.map((e,t)=>"..."===e?(0,a.jsx)("span",{className:"px-2 text-muted-foreground",children:"..."},`ellipsis-${t}`):(0,a.jsx)(o.Button,{variant:i===e?"default":"outline",size:"sm",onClick:()=>{l(e)},className:"min-w-[2rem]",children:e},e))})()}),(0,a.jsxs)(o.Button,{variant:"outline",size:"sm",onClick:()=>{i<c&&l(i+1)},disabled:i===c,className:"flex items-center gap-1",children:["Next",(0,a.jsx)(eC.ChevronRight,{className:"h-4 w-4"})]})]}),(0,a.jsxs)("div",{className:"text-center text-sm text-muted-foreground",children:["Showing ",d+1," to ",Math.min(m,e.length)," of ",e.length," items"]})]})}e.i(14583),e.i(82063);var eP=e.i(60031),eM=e.i(61761);function eD({open:e,onOpenChange:t,onSuccess:s}){let[l,c]=(0,r.useState)(""),[d,m]=(0,r.useState)(!1),{createProject:h}=(0,n.useDexie)(),{toast:f}=(0,i.useToast)(),x=async()=>{if(!l.trim())return void f({title:"Project name required",description:"Please enter a project name",variant:"destructive"});m(!0);try{await h({structureName:l.trim(),isSynced:!1,syncedProjectId:"",isRemote:!1,isPublic:!1,publicSourceId:"",branches:{main:[]},commits:[{commitId:`initial-${Date.now()}`,commitName:"Initial commit",data:new ArrayBuffer(0),parent:null,createdAt:Date.now()}]}),f({title:"Project created",description:`${l} has been created successfully`,variant:"default"}),c(""),t(!1),s()}catch(e){f({title:"Create failed",description:e instanceof Error?e.message:"Failed to create project",variant:"destructive"})}finally{m(!1)}};return(0,a.jsx)(S.Dialog,{open:e,onOpenChange:t,children:(0,a.jsxs)(S.DialogContent,{className:"sm:max-w-md",children:[(0,a.jsxs)(S.DialogHeader,{children:[(0,a.jsxs)(S.DialogTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(eM.Folder,{className:"h-5 w-5"}),"Create New Project"]}),(0,a.jsx)(S.DialogDescription,{children:"Enter a name for your new project. It will be created locally with an initial empty commit."})]}),(0,a.jsx)("div",{className:"grid gap-4 py-4",children:(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(eP.Label,{htmlFor:"projectName",children:"Project Name"}),(0,a.jsx)(eg.Input,{id:"projectName",value:l,onChange:e=>c(e.target.value),onKeyPress:e=>{"Enter"===e.key&&!d&&l.trim()&&x()},placeholder:"Enter project name...",disabled:d,autoFocus:!0})]})}),(0,a.jsxs)(S.DialogFooter,{children:[(0,a.jsx)(o.Button,{variant:"outline",onClick:()=>t(!1),disabled:d,children:"Cancel"}),(0,a.jsx)(o.Button,{onClick:x,disabled:d||!l.trim(),className:"flex items-center gap-2",children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),"Creating..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u,{className:"h-4 w-4"}),"Create Project"]})})]})]})})}function eS(){let{user:e}=(0,s.useAuth)(),{localProjects:t,remoteProjects:m,sharedCommits:h,loading:f,refresh:x}=function(){let{user:e,isAuthenticated:t}=(0,s.useAuth)(),{getAllProjects:a,getDecryptedProject:c,getDecryptedProjects:o}=(0,n.useDexie)(),{toast:d}=(0,i.useToast)(),[m,u]=(0,r.useState)([]),[h,f]=(0,r.useState)([]),[x,p]=(0,r.useState)([]),[y,g]=(0,r.useState)(!0),j=e=>{let t=e.commits[e.commits.length-1];return{...e,latestCommit:t,commitCount:e.commits.length}},v=(0,r.useCallback)(async e=>{try{return await c(e)}catch(t){console.error(`Failed to get decrypted project ${e}:`,t),d({title:"Decryption Failed",description:"Failed to decrypt project data. Please ensure you are logged in with the correct account.",variant:"destructive"});return}},[c,d]),w=(0,r.useCallback)(async e=>{try{return await o(e)}catch(e){return console.error("Failed to get decrypted projects:",e),d({title:"Decryption Failed",description:"Failed to decrypt project data. Please ensure you are logged in with the correct account.",variant:"destructive"}),[]}},[o,d]),b=(0,r.useCallback)(async()=>{g(!0);try{let e=(await a()).map(j);if(u(e),t)try{let[e,t]=await Promise.all([(0,l.getRemoteStructures)(),(0,l.getMySharedCommits)()]);f(e),p(t)}catch(e){console.error("Failed to fetch remote data:",e),d({title:"Sync Error",description:"Failed to fetch remote projects. Using cached data.",variant:"destructive"})}else f([]),p([])}catch(e){console.error("Failed to refresh library data:",e),d({title:"Library Error",description:"Failed to load library data. Please try again.",variant:"destructive"})}finally{g(!1)}},[a,t]);return(0,r.useEffect)(()=>{b()},[b]),(0,r.useEffect)(()=>{b()},[e,b]),{localProjects:m,remoteProjects:h,sharedCommits:x,loading:y,refresh:b,getDecryptedProjectData:v,getDecryptedProjectsData:w}}(),[p,y]=(0,r.useState)(!1),g=new Set(t.filter(e=>e.syncedProjectId).map(e=>e.syncedProjectId)),j=[...t,...m.filter(e=>!g.has(e.id))];return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight font-headline",children:"Library"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Manage your oxDNA projects, sync with cloud, and share with others"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(o.Button,{variant:"outline",size:"icon",onClick:x,disabled:f,children:(0,a.jsx)(d.RefreshCw,{className:f?"animate-spin":""})}),(0,a.jsxs)(o.Button,{onClick:()=>y(!0),children:[(0,a.jsx)(u,{className:"mr-2 h-4 w-4"}),"Create New"]})]})]}),(0,a.jsxs)(c.Card,{children:[(0,a.jsxs)(c.CardHeader,{children:[(0,a.jsx)(c.CardTitle,{children:"Projects"}),(0,a.jsx)(c.CardDescription,{children:"Your local projects and synced projects from the cloud"})]}),(0,a.jsx)(c.CardContent,{children:(0,a.jsx)(ek,{items:j,renderItem:e=>"commits"in e?(0,a.jsx)(ex,{project:e,onRefresh:x},e.id):(0,a.jsx)(ey,{project:e,onRefresh:x},e.id),emptyMessage:"No projects found. Create a new project or log in to see synced projects."})})]}),e&&(0,a.jsxs)(c.Card,{children:[(0,a.jsxs)(c.CardHeader,{children:[(0,a.jsx)(c.CardTitle,{children:"Shared by Me"}),(0,a.jsx)(c.CardDescription,{children:"Individual commits you've shared via unique links"})]}),(0,a.jsx)(c.CardContent,{children:(0,a.jsx)(ek,{items:h,renderItem:e=>(0,a.jsx)(eb,{commit:e,onRefresh:x},e.commitId),emptyMessage:"No shared commits found"})})]}),(0,a.jsx)(eD,{open:p,onOpenChange:y,onSuccess:x})]})}e.s(["default",()=>eS],51462)}]);