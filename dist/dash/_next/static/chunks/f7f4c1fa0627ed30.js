(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,11237,e=>{"use strict";let a=(0,e.i(6817).default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);e.s(["Download",()=>a],11237)},57605,e=>{"use strict";let a=(0,e.i(6817).default)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>a],57605)},69496,e=>{"use strict";var a=e.i(65771),r=e.i(20339),t=e.i(76832);let s=r.forwardRef(({className:e,...r},s)=>(0,a.jsx)("div",{ref:s,className:(0,t.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...r}));s.displayName="Card";let l=r.forwardRef(({className:e,...r},s)=>(0,a.jsx)("div",{ref:s,className:(0,t.cn)("flex flex-col space-y-1.5 p-6",e),...r}));l.displayName="CardHeader";let i=r.forwardRef(({className:e,...r},s)=>(0,a.jsx)("div",{ref:s,className:(0,t.cn)("text-2xl font-semibold leading-none tracking-tight",e),...r}));i.displayName="CardTitle";let n=r.forwardRef(({className:e,...r},s)=>(0,a.jsx)("div",{ref:s,className:(0,t.cn)("text-sm text-muted-foreground",e),...r}));n.displayName="CardDescription";let o=r.forwardRef(({className:e,...r},s)=>(0,a.jsx)("div",{ref:s,className:(0,t.cn)("p-6 pt-0",e),...r}));o.displayName="CardContent";let c=r.forwardRef(({className:e,...r},s)=>(0,a.jsx)("div",{ref:s,className:(0,t.cn)("flex items-center p-6 pt-0",e),...r}));c.displayName="CardFooter",e.s(["Card",()=>s,"CardContent",()=>o,"CardDescription",()=>n,"CardFooter",()=>c,"CardHeader",()=>l,"CardTitle",()=>i])},23858,e=>{"use strict";function a(e,[a,r]){return Math.min(r,Math.max(a,e))}e.s(["clamp",()=>a])},47572,e=>{"use strict";var a=e.i(65771),r=e.i(20339),t=e.i(69496);let s=e=>e?/^[0-9,\s]*$/.test(e)?e.split(",").map(e=>parseInt(e.trim(),10)).filter(e=>!isNaN(e)):(console.warn("Invalid characters in nucleotideIndexes. Aborting script generation."),[]):[];function l({topFile:e,datFile:l,nucleotideIndexes0:i,nucleotideIndexes1:n,height:o="500px",postLoadCommand:c}){let d=(0,r.useRef)(null);return(0,r.useEffect)(()=>{let a=d.current;if(!a?.contentWindow)return;let r=()=>{let r=[{file:e,ext:"top"},{file:l,ext:"dat"}],t=r.map(e=>new Blob([e.file],{type:"text/plain"})),o=r.map(e=>e.ext),d=[],u=s(i);u.length>0&&d.push(`colorElements(new THREE.Color(1, 0, 0), api.getElements([${u.join(",")}]))`);let m=s(n);if(m.length>0&&d.push(`colorElements(new THREE.Color(0, 0, 1), api.getElements([${m.join(",")}]))`),c&&d.push(c),d.length>0){let e=d.join(";\n");t.push(new Blob([e],{type:"application/javascript"})),o.push("js")}a.contentWindow?.postMessage({message:"iframe_drop",files:t,ext:o,inbox_settings:["Monomer","Origin"]},"/")};return a.addEventListener("load",r),()=>{a.removeEventListener("load",r)}},[e,l,i,n,c,d]),(0,a.jsxs)(t.Card,{className:"mt-4",children:[(0,a.jsx)(t.CardHeader,{children:(0,a.jsx)(t.CardTitle,{children:"Structure Preview"})}),(0,a.jsx)(t.CardContent,{children:(0,a.jsx)("iframe",{ref:d,src:"/",width:"100%",height:o,style:{border:"1px solid hsl(var(--border))"},title:"oxDNA Viewer"})})]})}e.s(["OxViewPreview",()=>l])},18410,e=>{"use strict";let a=(0,e.i(6817).default)("ChartLine",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);e.s(["default",()=>a])},95851,e=>{"use strict";var a=e.i(65771),r=e.i(20339),t=e.i(31712),s=e.i(69496),l=e.i(80559),i=e.i(44187),n=e.i(6817);let o=(0,n.default)("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);var c=e.i(11237);let d=(0,n.default)("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);var u=e.i(90945),m=e.i(18410),m=m,h=e.i(57605);let p=(0,n.default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var g=e.i(42792),x=e.i(88442),f=e.i(81775),j=e.i(91493),b=e.i(47572),w=e.i(4126);function N({jobId:e}){let{toast:t}=(0,x.useToast)(),n=(0,r.useRef)(null),[N,v]=(0,r.useState)(null),[y,C]=(0,r.useState)(null),[k,E]=(0,r.useState)(null),[S,$]=(0,r.useState)({pulling:!1,eq:!1,prod:!1}),[I,F]=(0,r.useState)({pulling:0,eq:0,prod:0,freeEnergy:0}),[_,B]=(0,r.useState)(null),[P,T]=(0,r.useState)(1),[D,R]=(0,r.useState)(null),[q,A]=(0,r.useState)(!1),[z,G]=(0,r.useState)("production"),[M,L]=(0,r.useState)(0),[U,H]=(0,r.useState)(null),[V,O]=(0,r.useState)(null),[W,J]=(0,r.useState)(!1),[K,X]=(0,r.useState)(!1),[Q,Y]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!e)return;let a=Date.now(),r={pulling:0,eq:0,prod:0,freeEnergy:0},t=async(a,r)=>{try{let t=await j.api.downloadFile(e,a);if(t.size>0){let e=URL.createObjectURL(t);r(e)}}catch(e){console.warn(`Could not preload image ${a}:`,e)}};(async()=>{try{let{files:s}=await j.api.listJobFiles(e);["pulling","eq","prod"].forEach(l=>{let i=`${l}.webp`;if(s.includes(i)){let e;"pulling"===l?e=v:"eq"===l?e=C:"prod"===l&&(e=E),e&&t(i,e)}let n=localStorage.getItem(`lastFetch_${e}_${l}`);if(n){let e=parseInt(n,10),t=(a-e)/1e3;t<180&&(r[l]=Math.ceil(180-t))}});let l="free_energy.webp";s.includes(l)&&t(l,R);let i=localStorage.getItem(`lastFetch_${e}_freeEnergy`);if(i){let e=parseInt(i,10),t=(a-e)/1e3;t<180&&(r.freeEnergy=Math.ceil(180-t))}F(r)}catch(e){console.error("Failed to list job files:",e)}})()},[e]),(0,r.useEffect)(()=>{let e=setInterval(()=>{F(e=>({pulling:Math.max(0,e.pulling-1),eq:Math.max(0,e.eq-1),prod:Math.max(0,e.prod-1),freeEnergy:Math.max(0,e.freeEnergy-1)}))},1e3);return()=>clearInterval(e)},[]);let Z=async a=>{if(!e)return void t({title:"Error",description:"No job ID provided.",variant:"destructive"});$(e=>({...e,[a]:!0}));try{let r=localStorage.getItem("token");if(!r)throw Error("No authentication token found.");let s=await fetch(`${g.API_BASE_URL_INTERNAL}/dockerImage/${a}/${e}`,{headers:{Authorization:`Bearer ${r}`}});if(!s.ok)throw Error(`Failed to generate ${a} graph: ${s.statusText}`);localStorage.setItem(`lastFetch_${e}_${a}`,Date.now().toString()),F(e=>({...e,[a]:180}));let l=await s.blob(),i=URL.createObjectURL(l);switch(a){case"pulling":v(i);break;case"eq":C(i);break;case"prod":E(i)}t({title:"Success",description:`${a.charAt(0).toUpperCase()+a.slice(1)} graph generated successfully.`})}catch(r){let e=r instanceof Error?r.message:`Failed to generate ${a} graph.`;console.error(`Error generating ${a} graph:`,r),t({title:"Error",description:e,variant:"destructive"})}finally{$(e=>({...e,[a]:!1}))}},ee=(a,r)=>{let t=document.createElement("a");t.href=a,t.download=`${r}_graph_${e}.webp`,document.body.appendChild(t),t.click(),document.body.removeChild(t)},ea=a=>{if(e){if(Date.now()-a>3e5){A(!1),t({title:"Error",description:"Image generation timed out. Please try again later.",variant:"destructive"});return}n.current=setTimeout(async()=>{try{let r=localStorage.getItem("token");if(!r)throw Error("No authentication token found.");let s=await fetch(`${g.API_BASE_URL_INTERNAL}/getDockerBar/${e}/${P}`,{headers:{Authorization:`Bearer ${r}`}});if(!s.ok)throw Error(`Failed to poll for image: ${s.statusText}`);let l=s.headers.get("content-type");if(l&&l.includes("image/webp")){let a=await s.blob(),r=URL.createObjectURL(a);R(r),A(!1),localStorage.setItem(`lastFetch_${e}_freeEnergy`,Date.now().toString()),F(e=>({...e,freeEnergy:180})),t({title:"Success",description:"Free energy profile generated successfully."})}else ea(a)}catch(a){A(!1);let e=a instanceof Error?a.message:"An unknown error occurred while polling for the image.";console.error("Polling error:",a),t({title:"Error",description:e,variant:"destructive"})}},5e3)}},er=async()=>{if(!e)return void t({title:"Error",description:"No job ID provided.",variant:"destructive"});A(!0),R(null);try{let a=localStorage.getItem("token");if(!a)throw Error("No authentication token found.");let r=await fetch(`${g.API_BASE_URL_INTERNAL}/getDockerBar/${e}/${P}`,{headers:{Authorization:`Bearer ${a}`}});if(!r.ok)throw Error(`Failed to start free energy profile generation: ${r.statusText}`);t({title:"Processing",description:"Started free energy profile generation. This may take a few minutes..."}),ea(Date.now())}catch(a){A(!1);let e=a instanceof Error?a.message:"Failed to generate free energy profile.";console.error("Error generating free energy profile:",a),t({title:"Error",description:e,variant:"destructive"})}},et=async()=>{if(e){X(!0),Y(null),O(null);try{let a=U;if(!a){let r=await j.api.downloadFile(e,"input.top");a=new File([r],"input.top"),H(a)}let r=`output/${z}/${M}/last_conf.dat`,t=await j.api.downloadFile(e,r),s=new File([t],`window_${M}_last_conf.dat`);O(s)}catch(a){let e=a instanceof Error?a.message:"An unknown error occurred.";Y(`Failed to load configuration. Please check if the stage and window exist. Error: ${e}`),console.error("Error during file fetching:",a),O(null)}finally{X(!1)}}};return(0,r.useEffect)(()=>{W&&et()},[W]),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Umbrella Sampling Analysis"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Analyze umbrella sampling simulation results and generate insights."}),e&&(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mt-2",children:["Job ID: ",(0,a.jsx)("code",{className:"bg-muted px-2 py-1 rounded",children:e})]})]}),(0,a.jsxs)("div",{className:"grid gap-6 md:grid-cols-1 lg:grid-cols-3",children:[(0,a.jsxs)(s.Card,{children:[(0,a.jsxs)(s.CardHeader,{children:[(0,a.jsxs)(s.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(o,{className:"h-5 w-5"}),"Pulling"]}),(0,a.jsx)(s.CardDescription,{children:"Generate pulling phase analysis graph"})]}),(0,a.jsxs)(s.CardContent,{className:"space-y-4",children:[(0,a.jsx)(l.Button,{onClick:()=>Z("pulling"),disabled:S.pulling||!e||I.pulling>0,className:"w-full",children:S.pulling?"Generating...":I.pulling>0?`Wait ${I.pulling}s`:"Generate Graph"}),N&&(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:N,alt:"Pulling Graph",className:"w-full h-auto rounded-lg border"}),(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex gap-2",children:[(0,a.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>B(N),className:"bg-background/80 backdrop-blur-sm",children:(0,a.jsx)(d,{className:"h-4 w-4"})}),(0,a.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>ee(N,"pulling"),className:"bg-background/80 backdrop-blur-sm",children:(0,a.jsx)(c.Download,{className:"h-4 w-4"})})]})]})})]})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsxs)(s.CardHeader,{children:[(0,a.jsxs)(s.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(o,{className:"h-5 w-5"}),"Equilibrium"]}),(0,a.jsx)(s.CardDescription,{children:"Generate equilibrium phase analysis graph"})]}),(0,a.jsxs)(s.CardContent,{className:"space-y-4",children:[(0,a.jsx)(l.Button,{onClick:()=>Z("eq"),disabled:S.eq||!e||I.eq>0,className:"w-full",children:S.eq?"Generating...":I.eq>0?`Wait ${I.eq}s`:"Generate Graph"}),y&&(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:y,alt:"Equilibrium Graph",className:"w-full h-auto rounded-lg border"}),(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex gap-2",children:[(0,a.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>B(y),className:"bg-background/80 backdrop-blur-sm",children:(0,a.jsx)(d,{className:"h-4 w-4"})}),(0,a.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>ee(y,"eq"),className:"bg-background/80 backdrop-blur-sm",children:(0,a.jsx)(c.Download,{className:"h-4 w-4"})})]})]})})]})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsxs)(s.CardHeader,{children:[(0,a.jsxs)(s.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(o,{className:"h-5 w-5"}),"Production"]}),(0,a.jsx)(s.CardDescription,{children:"Generate production phase analysis graph"})]}),(0,a.jsxs)(s.CardContent,{className:"space-y-4",children:[(0,a.jsx)(l.Button,{onClick:()=>Z("prod"),disabled:S.prod||!e||I.prod>0,className:"w-full",children:S.prod?"Generating...":I.prod>0?`Wait ${I.prod}s`:"Generate Graph"}),k&&(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:k,alt:"Production Graph",className:"w-full h-auto rounded-lg border"}),(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex gap-2",children:[(0,a.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>B(k),className:"bg-background/80 backdrop-blur-sm",children:(0,a.jsx)(d,{className:"h-4 w-4"})}),(0,a.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>ee(k,"prod"),className:"bg-background/80 backdrop-blur-sm",children:(0,a.jsx)(c.Download,{className:"h-4 w-4"})})]})]})})]})]})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsxs)(s.CardHeader,{children:[(0,a.jsxs)(s.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(m.default,{className:"h-5 w-5"}),"Free Energy Profile"]}),(0,a.jsx)(s.CardDescription,{children:"Generate free energy profile with specified number of CPUs"})]}),(0,a.jsxs)(s.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-4 items-end",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{htmlFor:"numCpus",className:"text-sm font-medium mb-2 block",children:"Number of CPUs"}),(0,a.jsx)(i.Input,{id:"numCpus",type:"number",min:"1",value:P,onChange:e=>T(parseInt(e.target.value)||1),className:"w-full",disabled:!e})]}),(0,a.jsx)(l.Button,{onClick:er,disabled:q||!e||I.freeEnergy>0,className:"w-auto",children:q?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):I.freeEnergy>0?`Wait ${I.freeEnergy}s`:"Generate Profile"})]}),q&&!D&&(0,a.jsx)("div",{className:"flex items-center justify-center p-8 border-2 border-dashed rounded-lg",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(p,{className:"mx-auto h-12 w-12 animate-spin text-muted-foreground"}),(0,a.jsx)("p",{className:"mt-4 text-sm text-muted-foreground",children:"Calculating free energy profile... This can take several minutes."})]})}),D&&(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:D,alt:"Free Energy Profile",className:"w-full h-auto rounded-lg border"}),(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex gap-2",children:[(0,a.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>B(D),className:"bg-background/80 backdrop-blur-sm",children:(0,a.jsx)(d,{className:"h-4 w-4"})}),(0,a.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>ee(D,"free_energy"),className:"bg-background/80 backdrop-blur-sm",children:(0,a.jsx)(c.Download,{className:"h-4 w-4"})})]})]})})]})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsxs)(s.CardHeader,{children:[(0,a.jsxs)(s.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(h.Eye,{className:"h-5 w-5"}),"Configuration Preview"]}),(0,a.jsx)(s.CardDescription,{children:"View the last configuration from a specific stage and window of the simulation."})]}),(0,a.jsx)(s.CardContent,{children:W?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Button,{onClick:()=>J(!1),variant:"outline",className:"mb-4",children:"Close Preview"}),(0,a.jsx)(w.Separator,{className:"my-4"}),K&&(0,a.jsx)("p",{children:"Loading preview..."}),Q&&(0,a.jsx)("p",{className:"text-destructive",children:Q}),!K&&!Q&&U&&V&&(0,a.jsx)(b.OxViewPreview,{topFile:U,datFile:V,height:"600px"})]}):(0,a.jsxs)("div",{className:"flex gap-4 items-end",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Stage"}),(0,a.jsxs)(f.Select,{value:z,onValueChange:e=>G(e),children:[(0,a.jsx)(f.SelectTrigger,{children:(0,a.jsx)(f.SelectValue,{placeholder:"Select stage"})}),(0,a.jsxs)(f.SelectContent,{children:[(0,a.jsx)(f.SelectItem,{value:"pre_equilibration",children:"Pre-Equilibration"}),(0,a.jsx)(f.SelectItem,{value:"equilibration",children:"Equilibrium"}),(0,a.jsx)(f.SelectItem,{value:"production",children:"Production"})]})]})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{htmlFor:"windowNum",className:"text-sm font-medium mb-2 block",children:"Window Number"}),(0,a.jsx)(i.Input,{id:"windowNum",type:"number",min:"0",value:M,onChange:e=>L(parseInt(e.target.value)||0)})]}),(0,a.jsx)(l.Button,{onClick:()=>J(!0),disabled:!e,children:"View Configuration"})]})})]}),_&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",onClick:()=>B(null),children:(0,a.jsxs)("div",{className:"relative max-w-[95vw] max-h-[95vh]",children:[(0,a.jsxs)(l.Button,{size:"sm",variant:"outline",onClick:()=>B(null),className:"absolute -top-12 right-0 bg-background",children:[(0,a.jsx)(u.X,{className:"h-4 w-4 mr-2"}),"Close"]}),(0,a.jsx)("img",{src:_,alt:"Enlarged Graph",className:"max-w-full max-h-[90vh] w-auto h-auto rounded-lg border",onClick:e=>e.stopPropagation()})]})})]})}function v(){let e=(0,t.useSearchParams)().get("jobId");return(0,a.jsx)(N,{jobId:e})}function y(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsx)(v,{})})}e.s(["default",()=>y],95851)}]);