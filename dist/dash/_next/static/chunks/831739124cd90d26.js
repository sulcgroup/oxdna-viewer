(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,51462,e=>{"use strict";var t,r=e.i(37081),a=e.i(33506),i=e.i(3614),s=e.i(15556),o=e.i(42792),n=e.i(88442);function c(){let e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}}function l(){return!!localStorage.getItem("token")}function d(){localStorage.removeItem("token")}function m(e){let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r.buffer}async function u(){if(!l())return console.log("User not logged in, returning empty array"),[];try{let e=await fetch(`${o.API_BASE_URL_PUBLIC_AUTH}/sync/projects`,{headers:c()});if(!e.ok){if(401===e.status)return d(),(0,n.toast)({title:"Session expired",description:"Please login again.",variant:"destructive"}),[];throw Error(`HTTP error! status: ${e.status}`)}return(await e.json()).projects||[]}catch(e){return console.error("getRemoteStructures error:",e),(0,n.toast)({title:"Failed to fetch remote projects",description:e instanceof Error?e.message:"Unknown error",variant:"destructive"}),[]}}async function h(e,t){if(!l())return console.log("User not logged in, returning null"),(0,n.toast)({title:"Login required",description:"Please login to create synced projects",variant:"destructive"}),null;try{let r={projectName:e};t&&(r.projectId=t);let a=await fetch(`${o.API_BASE_URL_PUBLIC_AUTH}/sync/project`,{method:"POST",headers:{"Content-Type":"application/json",...c()},body:JSON.stringify(r)});if(!a.ok){if(401===a.status)return d(),(0,n.toast)({title:"Login required",description:"Please login to create synced projects",variant:"destructive"}),null;throw Error(`HTTP error! status: ${a.status}`)}return(await a.json()).project||null}catch(e){return console.error("createRemoteStructure error:",e),null}}async function p(e,t,r,a){if(!l())return console.log("User not logged in, returning null"),(0,n.toast)({title:"Login required",description:"Please login to add commits to synced projects",variant:"destructive"}),null;try{let r={commitName:t.commitName,commitData:function(e){let t=new Uint8Array(e),r="";for(let e=0;e<t.byteLength;e++)r+=String.fromCharCode(t[e]);return btoa(r)}(t.data),parentCommitId:a};t.commitId&&(r.commitId=t.commitId),t.createdAt&&(r.createdAt="number"==typeof t.createdAt?new Date(t.createdAt).toISOString():t.createdAt);let i=await fetch(`${o.API_BASE_URL_PUBLIC_AUTH}/sync/project/${e}/commit`,{method:"POST",headers:{"Content-Type":"application/json",...c()},body:JSON.stringify(r)});if(!i.ok){if(401===i.status)return d(),(0,n.toast)({title:"Login required",description:"Please login to add commits to synced projects",variant:"destructive"}),null;throw Error(`HTTP error! status: ${i.status}`)}return(await i.json()).commit||null}catch(e){return console.error("addRemoteCommit error:",e),null}}async function f(e){if(!l())return(0,n.toast)({title:"Login required",description:"Please login to share commits",variant:"destructive"}),null;try{let t=await fetch(`${o.API_BASE_URL_PUBLIC_AUTH}/share/commit`,{method:"POST",headers:{"Content-Type":"application/json",...c()},body:JSON.stringify({structureData:e})});if(!t.ok){if(401===t.status)return d(),(0,n.toast)({title:"Login required",description:"Please login to share commits",variant:"destructive"}),null;throw Error("Failed to share commit")}return await t.json()}catch(e){return console.error("shareCommit error:",e),null}}async function y(){if(!l())return console.log("User not logged in, returning empty array"),[];try{let e=await fetch(`${o.API_BASE_URL_PUBLIC_AUTH}/share/my-commits`,{headers:c()});if(!e.ok){if(401===e.status)return d(),(0,n.toast)({title:"Login required",description:"Please login to view your shared commits",variant:"destructive"}),[];throw Error("Failed to fetch shared commits")}return(await e.json()).commits||[]}catch(e){return console.error("getMySharedCommits error:",e),[]}}async function g(e){if(!l())return(0,n.toast)({title:"Login required",description:"Please login to toggle project visibility",variant:"destructive"}),{success:!1};try{let t=await fetch(`${o.API_BASE_URL_PUBLIC_AUTH}/sync/project/${e}/public`,{method:"PATCH",headers:c()});if(!t.ok){if(401===t.status)return d(),(0,n.toast)({title:"Login required",description:"Please login to toggle project visibility",variant:"destructive"}),{success:!1};throw Error("Failed to toggle project visibility")}let r=await t.json();return{success:!0,isPublic:r.isPublic}}catch(e){return console.error("toggleProjectPublic error:",e),{success:!1}}}async function x(e){if(!l())return console.log("User not logged in, returning empty array"),[];try{let t=await fetch(`${o.API_BASE_URL_PUBLIC_AUTH}/sync/project/${e}/commits`,{headers:c()});if(!t.ok){if(401===t.status)return d(),(0,n.toast)({title:"Session expired",description:"Please login again.",variant:"destructive"}),[];throw Error(`HTTP error! status: ${t.status}`)}return((await t.json()).commits||[]).map(e=>({id:e.id,commitName:e.commitName,createdAt:e.createdAt,parentCommitId:e.parentCommitId||null}))}catch(e){return console.error("getProjectCommits error:",e),(0,n.toast)({title:"Failed to fetch project commits",description:e instanceof Error?e.message:"Unknown error",variant:"destructive"}),[]}}async function w(e){if(!l())return(0,n.toast)({title:"Login required",description:"Please login to delete synced projects",variant:"destructive"}),!1;try{let t=await fetch(`${o.API_BASE_URL_PUBLIC_AUTH}/sync/project/${e}`,{method:"DELETE",headers:c()});if(!t.ok){if(401===t.status)return d(),(0,n.toast)({title:"Login required",description:"Please login to delete synced projects",variant:"destructive"}),!1;throw Error(`HTTP error! status: ${t.status}`)}return!0}catch(e){return console.error("deleteSyncedProject error:",e),!1}}async function b(e){if(!l())return(0,n.toast)({title:"Login required",description:"Please login to delete shared commits",variant:"destructive"}),!1;if(!e)return console.error("deleteSharedCommit: No shareId provided"),!1;try{let t=await fetch(`${o.API_BASE_URL_PUBLIC_AUTH}/share/commit/${e}`,{method:"DELETE",headers:c()});if(!t.ok){if(401===t.status)return d(),(0,n.toast)({title:"Login required",description:"Please login to delete shared commits",variant:"destructive"}),!1;if(404===t.status)return console.warn(`Shared commit ${e} not found - may have been already deleted`),!1;throw Error("Failed to delete shared commit")}return!0}catch(e){return console.error("deleteSharedCommit error:",e),!1}}class j extends Error{projectId;commitId;statusCode;originalError;constructor(e,t,r,a,i){super(e),this.projectId=t,this.commitId=r,this.statusCode=a,this.originalError=i,this.name="CommitDataError"}}async function v(e,t){if(!l())return console.log("User not logged in, returning null"),(0,n.toast)({title:"Login required",description:"Please login to read commit data",variant:"destructive"}),null;try{let r=await fetch(`${o.API_BASE_URL_PUBLIC_AUTH}/sync/project/${e}/commit/${t}/data`,{headers:c()});if(!r.ok){if(401===r.status)return d(),(0,n.toast)({title:"Session expired",description:"Please login again.",variant:"destructive"}),null;if(404===r.status){let r=`Commit not found: project=${e}, commit=${t}`;throw console.error(r),(0,n.toast)({title:"Commit not found",description:`The commit ${t} may have been deleted or you don't have access.`,variant:"destructive"}),new j(r,e,t,404)}let a=`Failed to read commit data: HTTP ${r.status} for project=${e}, commit=${t}`;throw console.error(a),(0,n.toast)({title:"Failed to read commit data",description:`Server returned status ${r.status}`,variant:"destructive"}),new j(a,e,t,r.status)}let a=await r.json();return m(a.content)}catch(a){if(a instanceof j)throw a;let r=new j(`Error reading commit data: ${a instanceof Error?a.message:"Unknown error"}`,e,t,void 0,a instanceof Error?a:void 0);throw console.error("readCommitData error:",r),(0,n.toast)({title:"Failed to read commit data",description:a instanceof Error?a.message:"Unknown error",variant:"destructive"}),r}}async function N(e){try{let t=await fetch(`${o.API_BASE_URL_PUBLIC_AUTH}/public/project/${e}/commits`);if(!t.ok)return[];return((await t.json()).commits||[]).map(e=>({id:e.id,commitName:e.commitName,createdAt:e.createdAt,parentCommitId:e.parentCommitId||null}))}catch(e){return console.error("getPublicProjectCommits error:",e),[]}}async function C(e,t){try{let r=await fetch(`${o.API_BASE_URL_PUBLIC_AUTH}/public/project/${e}/commit/${t}/data`);if(!r.ok)return null;let a=await r.json();return m(a.content)}catch(e){return console.error("readPublicCommitData error:",e),null}}var k=e.i(59822);function D(e){if(!e||0===e.length)return{main:[]};let t=new Map,r=new Map;for(let a of e){let e=a.commitId||a.id,i=a.parent||a.parentCommitId||null;r.set(e,i),i&&(t.has(i)||t.set(i,[]),t.get(i).push(e))}let a=e.filter(e=>{let r=e.commitId||e.id;return!t.has(r)}),i={};return a.forEach((e,t)=>{let a=e.commitId||e.id,s=0===t?"main":`branch ${t+1}`,o=[],n=a,c=new Set;for(;n&&!c.has(n);)c.add(n),o.unshift(n),n=r.get(n)||null;i[s]=o}),i}async function P(e){try{if(e.publicSourceId&&(!e.isSynced||!e.syncedProjectId))try{let t=await N(e.publicSourceId),r=t?t.length:0,a=e.commits?e.commits.length:0;if(!t)return{status:"public-out-of-sync",direction:"pull",localCommitCount:a,remoteCommitCount:0};let i=new Set(e.commits.map(e=>e.commitId));if(t.some(e=>!i.has(e.id)))return{status:"public-out-of-sync",direction:"pull",localCommitCount:a,remoteCommitCount:r};return{status:"public-synced",localCommitCount:a,remoteCommitCount:r}}catch(t){return console.warn("Public sync status check failed",t),{status:"public-out-of-sync",direction:"pull",localCommitCount:e.commits?e.commits.length:0,remoteCommitCount:0}}if(!e.isSynced||!e.syncedProjectId)return{status:"local",localCommitCount:e.commits?e.commits.length:0};let t=await x(e.syncedProjectId);if(!t)return{status:"out-of-sync",direction:"pull",localCommitCount:e.commits?e.commits.length:0,remoteCommitCount:0};let r=e.commits?e.commits.length:0,a=t.length;if(r===a)return{status:"synced",localCommitCount:r,remoteCommitCount:a};if(r>a)return{status:"out-of-sync",direction:"push",localCommitCount:r,remoteCommitCount:a};return{status:"out-of-sync",direction:"pull",localCommitCount:r,remoteCommitCount:a}}catch(t){return console.error("Error determining project sync status:",t),{status:"local",localCommitCount:e.commits?e.commits.length:0}}}async function I(e,t){try{let r,a,i=t;if(a="object"==typeof e&&null!==e?i=(r=e).id:e,!i&&a){let e=await s.DexieDB.structureData.get(a);e&&e.syncedProjectId&&(i=e.syncedProjectId,console.log(`pullRemoteProject: Resolved remote ID from local project: ${i}`))}if(!i)throw console.error("pullRemoteProject: missing remote project id",{localId:a,remoteProjectId:t}),Error(`No remote project id provided. Local project ID: ${a||"none"}`);let o=await x(i);if(!o)throw Error("Failed to fetch remote commits");let n=[];for(let e of o){let t;try{t=await v(i,e.id)}catch(t){if(t instanceof j)throw console.error(`Failed to fetch commit: project=${t.projectId}, commit=${t.commitId}`,t),Error(`Failed to download commit "${e.commitName}" (${e.id}): The commit data is missing on the server. This may indicate the commit was deleted or the server file storage has an issue.`);throw t}if(!t)throw Error(`Failed to download commit "${e.commitName}" (${e.id}): Received empty data from server`);let r=new Date(e.createdAt).getTime();n.push({commitId:e.id,commitName:e.commitName,data:t,parent:e.parentCommitId||null,createdAt:r})}let c=localStorage.getItem("token"),l=c&&(0,k.isTokenValidForEncryption)(c);if(a){if(!await s.DexieDB.structureData.get(a)){let e=n;l&&(e=await Promise.all(n.map(async e=>{let t=await (0,k.encryptCommit)({data:e.data,commitId:e.commitId,commitName:e.commitName,parent:e.parent,createdAt:e.createdAt},c),r=new ArrayBuffer(0);return{...e,data:r,isEncrypted:!0,encryptedData:t.encryptedData,iv:t.iv}})));let t={id:i,commits:e,structureName:r&&(r.projectName||r.name)||"Remote Project",date:Date.now(),branches:{main:e.length>0?e.map(e=>e.commitId):[]},isSynced:!0,syncedProjectId:i,isRemote:!0,isEncrypted:l,encryptedAt:l?Date.now():void 0,encryptionVersion:l?"1.0":void 0};await s.DexieDB.structureData.put(t);return}let e=n;l&&(e=await Promise.all(n.map(async e=>{let t=await (0,k.encryptCommit)({data:e.data,commitId:e.commitId,commitName:e.commitName,parent:e.parent,createdAt:e.createdAt},c),r=new ArrayBuffer(0);return{...e,data:r,isEncrypted:!0,encryptedData:t.encryptedData,iv:t.iv}}))),await s.DexieDB.structureData.update(a,{commits:e,date:Date.now(),isSynced:!0,syncedProjectId:i,isEncrypted:l,encryptedAt:l?Date.now():void 0,encryptionVersion:l?"1.0":void 0})}else{let e=n;l&&(e=await Promise.all(n.map(async e=>{let t=await (0,k.encryptCommit)({data:e.data,commitId:e.commitId,commitName:e.commitName,parent:e.parent,createdAt:e.createdAt},c),r=new ArrayBuffer(0);return{...e,data:r,isEncrypted:!0,encryptedData:t.encryptedData,iv:t.iv}})));let t={id:i,commits:e,structureName:r&&(r.projectName||r.name)||"Remote Project",date:Date.now(),branches:{main:e.length>0?e.map(e=>e.commitId):[]},isSynced:!0,syncedProjectId:i,isRemote:!0,isEncrypted:l,encryptedAt:l?Date.now():void 0,encryptionVersion:l?"1.0":void 0};await s.DexieDB.structureData.put(t)}}catch(e){throw console.error("Error pulling remote project:",e),e}}async function E(e){try{let t=e.publicSourceId;if(!t)return;let r=await N(t);if(!r||0===r.length)return;let a=new Set((e.commits||[]).map(e=>e.commitId)),i=r.filter(e=>!a.has(e.id));if(0===i.length)return;for(let r of i){let a=await C(t,r.id);if(!a){console.warn(`refreshPublicClonedProject: Failed to read commit data for ${r.id}`);continue}let i=r.createdAt?new Date(r.createdAt).getTime():Date.now();e.commits.push({commitId:r.id,commitName:r.commitName||"Commit",data:a,parent:r.parentCommitId||null,createdAt:i}),e.branches||(e.branches={main:[]}),e.branches.main||(e.branches.main=[]),e.branches.main.push(r.id)}if(e.commits||(e.commits=[]),e.commits.sort((e,t)=>(e.createdAt||0)-(t.createdAt||0)),e.commits.length<=1||e.commits.some((e,t)=>t>0&&e.parent)){let t=D(e.commits);e.branches=t}else e.branches={main:e.commits.map(e=>e.commitId)};await s.DexieDB.structureData.put({...e,date:Date.now()})}catch(e){throw console.error("refreshPublicClonedProject error",e),e}}async function S(e,t){try{let r=await s.DexieDB.structureData.get(e);if(!r)throw Error("Local project not found");if(r.publicSourceId)throw Error("This project was cloned from a public source and cannot be synced upstream.");let a=localStorage.getItem("token"),i=a&&(0,k.isTokenValidForEncryption)(a);if(r.isSynced&&r.syncedProjectId){let t=r.syncedProjectId,s=await x(t),o=new Set(s.map(e=>e.id));for(let e of r.commits.filter(e=>!o.has(e.commitId))){let r=e;if(e.isEncrypted&&e.encryptedData&&e.iv&&i){let t=await (0,k.decryptCommit)({encryptedData:e.encryptedData,iv:e.iv,originalCommitId:e.commitId,originalCommitName:e.commitName,originalParent:e.parent,originalCreatedAt:e.createdAt},a);r={...e,data:t.data,isEncrypted:!1,encryptedData:void 0,iv:void 0}}await p(t,r,"main",r.parent),r.data&&(r.data=new ArrayBuffer(0))}await M(e);return}let o=await h(t);if(!o)throw Error("Failed to create remote project");for(let e of r.commits){let t=e;if(e.isEncrypted&&e.encryptedData&&e.iv&&i){let r=await (0,k.decryptCommit)({encryptedData:e.encryptedData,iv:e.iv,originalCommitId:e.commitId,originalCommitName:e.commitName,originalParent:e.parent,originalCreatedAt:e.createdAt},a);t={...e,data:r.data,isEncrypted:!1,encryptedData:void 0,iv:void 0}}await p(o.id,t,"main",t.parent),t.data&&(t.data=new ArrayBuffer(0))}await A(e,o.id),await M(e)}catch(e){throw console.error("Error syncing project to cloud:",e),e}}async function A(e,t){await s.DexieDB.structureData.update(e,{isSynced:!0,syncedProjectId:t})}async function M(e){try{let t=localStorage.getItem("token");if(!t||!(0,k.isTokenValidForEncryption)(t))return void console.warn("Cannot encrypt project: no valid token available");let r=await s.DexieDB.structureData.get(e);if(!r)throw Error("Project not found");let a=await Promise.all(r.commits.map(async e=>{if(!e.isEncrypted){let r=await (0,k.encryptCommit)({data:e.data,commitId:e.commitId,commitName:e.commitName,parent:e.parent,createdAt:e.createdAt},t);return{...e,data:new ArrayBuffer(0),isEncrypted:!0,encryptedData:r.encryptedData,iv:r.iv}}return e}));await s.DexieDB.structureData.update(e,{commits:a,isEncrypted:!0,encryptedAt:Date.now(),encryptionVersion:"1.0"}),setTimeout(()=>{window.gc&&window.gc()},100),console.log(`Project ${e} encrypted successfully`)}catch(e){throw console.error("Failed to encrypt local project:",e),Error("Failed to encrypt project data")}}function T(){let[e,t]=(0,a.useState)(!1),r=(0,a.useCallback)(()=>localStorage.getItem("token"),[]),i=(0,a.useCallback)(async e=>{let t=r();if(!e.isEncrypted||!t||!(0,k.isTokenValidForEncryption)(t))return e;if(!crypto.subtle)return console.warn("Encryption not available in non-secure context, returning encrypted project as-is"),e;try{let r=await Promise.all(e.commits.map(async e=>{if(e.isEncrypted&&e.encryptedData&&e.iv){let r=await (0,k.decryptCommit)({encryptedData:e.encryptedData,iv:e.iv,originalCommitId:e.commitId,originalCommitName:e.commitName,originalParent:e.parent,originalCreatedAt:e.createdAt},t);return{...e,data:r.data,isEncrypted:!1,encryptedData:void 0,iv:void 0}}return e}));return{...e,commits:r,isEncrypted:!1,encryptedAt:void 0,encryptionVersion:void 0}}catch(e){throw console.error("Failed to decrypt project commits:",e),Error("Failed to decrypt project data. Please ensure you are logged in with the correct account.")}},[r]),o=(0,a.useCallback)(async t=>{if(!e)return void console.warn("Database not ready, returning undefined");try{let e=await s.DexieDB.structureData.get(t);if(e){let t=await i(e);return setTimeout(()=>{window.gc&&window.gc()},100),t}return}catch(e){console.error(`Failed to get decrypted project ${t}:`,e);return}},[e,i]),n=(0,a.useCallback)(async t=>{if(!e)return console.warn("Database not ready, returning empty array"),[];try{let e=await s.DexieDB.structureData.bulkGet(t),r=await Promise.all(e.filter(Boolean).map(e=>i(e)));return setTimeout(()=>{window.gc&&window.gc()},100),r}catch(e){return console.error("Failed to get decrypted projects:",e),[]}},[e,i]),c=(0,a.useCallback)(async(t,a)=>{if(!e)return void console.warn("Database not ready, returning undefined");try{let e=await s.DexieDB.structureData.get(t);if(!e)return;let i=e.commits.find(e=>e.commitId===a);if(!i)return;if(i.isEncrypted&&i.encryptedData&&i.iv){let e=r();if(!e||!(0,k.isTokenValidForEncryption)(e))return i;let t=await (0,k.decryptCommit)({encryptedData:i.encryptedData,iv:i.iv,originalCommitId:i.commitId,originalCommitName:i.commitName,originalParent:i.parent,originalCreatedAt:i.createdAt},e),a={...i,data:t.data,isEncrypted:!1,encryptedData:void 0,iv:void 0};return setTimeout(()=>{window.gc&&window.gc()},100),a}return i}catch(e){console.error(`Failed to get decrypted commit ${a} from project ${t}:`,e);return}},[e,r]),l=(0,a.useCallback)(async e=>{let t=r();if(!e.isSynced||!t||!(0,k.isTokenValidForEncryption)(t))return e;if(!crypto.subtle)return console.warn("Encryption not available in non-secure context, returning project unencrypted"),e;try{let r=await Promise.all(e.commits.map(async e=>{if(!e.isEncrypted){let r=await (0,k.encryptCommit)({data:e.data,commitId:e.commitId,commitName:e.commitName,parent:e.parent,createdAt:e.createdAt},t);return{...e,data:new ArrayBuffer(0),isEncrypted:!0,encryptedData:r.encryptedData,iv:r.iv}}return e}));return{...e,commits:r,isEncrypted:!0,encryptedAt:Date.now(),encryptionVersion:"1.0"}}catch(e){throw console.error("Failed to encrypt project commits:",e),Error("Failed to encrypt project data for sync.")}},[r]);(0,a.useEffect)(()=>{let e=async()=>{try{if(!window.indexedDB){console.error("IndexedDB is not available in this browser"),t(!1);return}await s.DexieDB.open(),t(!0),console.log("Database initialized successfully")}catch(r){console.error("Failed to initialize Dexie database:",r),t(!1),setTimeout(()=>{console.log("Retrying database initialization..."),e()},2e3)}};e()},[]);let d=(0,a.useCallback)(async()=>{if(!e)return console.warn("Database not ready, returning empty array"),[];try{let e=await s.DexieDB.structureData.toArray();return await Promise.all(e.map(e=>i(e)))}catch(e){return console.error("Failed to get all projects:",e),[]}},[e,i]),m=(0,a.useCallback)(async t=>{if(!e)return void console.warn("Database not ready, returning undefined");try{let e=await s.DexieDB.structureData.get(t);if(e)return await i(e);return}catch(e){console.error(`Failed to get project ${t}:`,e);return}},[e,i]),u=(0,a.useCallback)(async t=>{if(!e)throw Error("Database not ready");try{let e=Math.random().toString(36).substring(2)+Date.now().toString(36),r={...t,id:e,date:Date.now()},a=await l(r);return await s.DexieDB.structureData.add(a),e}catch(e){throw console.error("Failed to create project:",e),e}},[e,l]),h=(0,a.useCallback)(async(t,r)=>{if(!e)throw Error("Database not ready");try{if(r.commits){let e=await s.DexieDB.structureData.get(t);if(e){let t={...e,...r},a=await l(t);await s.DexieDB.structureData.put(a);return}}await s.DexieDB.structureData.update(t,r)}catch(e){throw console.error(`Failed to update project ${t}:`,e),e}},[e,l]),p=(0,a.useCallback)(async t=>{if(!e)throw Error("Database not ready");try{await s.DexieDB.structureData.delete(t)}catch(e){throw console.error(`Failed to delete project ${t}:`,e),e}},[e]),f=(0,a.useCallback)(async(t,r)=>{if(!e)throw Error("Database not ready");try{await s.DexieDB.structureData.update(t,{isSynced:!0,syncedProjectId:r})}catch(e){throw console.error(`Failed to mark project ${t} as synced:`,e),e}},[e]);return{isReady:e,getAllProjects:d,getProject:m,createProject:u,updateProject:h,deleteProject:p,markProjectAsSynced:f,getDecryptedProject:o,getDecryptedProjects:n,getDecryptedCommit:c}}var B=e.i(69496),F=e.i(80559),U=e.i(69663),$=e.i(34270);let L=(0,$.default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var R=e.i(74502);let _=(0,$.default)("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),H=(0,$.default)("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]),q=(0,$.default)("CloudDownload",[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]]),z=(0,$.default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),W=(0,$.default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),O=(0,$.default)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);function V({syncState:e}){let{status:t,direction:a}=e;return(0,r.jsxs)(R.Badge,{variant:"outline",className:`gap-1.5 text-xs font-medium border ${(()=>{switch(t){case"local":return"bg-slate-100 text-slate-700 border-slate-200 hover:bg-slate-200";case"synced":return"bg-emerald-100 text-emerald-700 border-emerald-200 hover:bg-emerald-200";case"out-of-sync":return"bg-amber-100 text-amber-700 border-amber-200 hover:bg-amber-200";case"conflict":return"bg-red-100 text-red-700 border-red-200 hover:bg-red-200";case"public-synced":case"public-out-of-sync":return"bg-blue-100 text-blue-700 border-blue-200 hover:bg-blue-200";default:return"bg-gray-100 text-gray-700 border-gray-200 hover:bg-gray-200"}})()}`,children:[(()=>{switch(t){case"local":default:return(0,r.jsx)(_,{className:"h-3 w-3"});case"synced":return(0,r.jsx)(W,{className:"h-3 w-3"});case"out-of-sync":if("push"===a)return(0,r.jsx)(H,{className:"h-3 w-3"});if("pull"===a)return(0,r.jsx)(q,{className:"h-3 w-3"});return(0,r.jsx)(_,{className:"h-3 w-3"});case"conflict":return(0,r.jsx)(z,{className:"h-3 w-3"});case"public-synced":case"public-out-of-sync":return(0,r.jsx)(O,{className:"h-3 w-3"})}})(),(0,r.jsx)("span",{children:(()=>{switch(t){case"local":return"Local";case"synced":return"Synced";case"out-of-sync":if("push"===a)return"Push ↑";if("pull"===a)return"Pull ↓";return"Out of Sync";case"conflict":return"Conflict ⚠";case"public-synced":return"Public";case"public-out-of-sync":return"Update Available";default:return"Unknown"}})()})]})}var X=e.i(29984);let Y=(0,$.default)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var J=e.i(59450);let G=(0,$.default)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),K=(0,$.default)("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);function Q({refreshCallback:t}={}){let{getProject:r,deleteProject:i,markProjectAsSynced:s}=T(),{toast:o}=(0,n.useToast)(),c=(0,a.useCallback)(async(e,a)=>{try{if(!await r(e))throw Error("Local project not found");return await S(e,a),o({title:"Project synced successfully",description:`${a} has been synced to the cloud`,variant:"default"}),t&&t(),{success:!0,message:"Project synced successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return o({title:"Sync failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[r,o,t]),l=(0,a.useCallback)(async(e,r)=>{try{return await I(e,r),o({title:"Project pulled successfully",description:"Remote project has been pulled to local",variant:"default"}),t&&t(),{success:!0,message:"Project pulled successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return o({title:"Pull failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[o,t]),d=(0,a.useCallback)(async e=>{try{return await i(e),o({title:"Project deleted",description:"Local project has been deleted",variant:"default"}),t&&t(),{success:!0,message:"Project deleted successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return o({title:"Delete failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[i,o,t]),m=(0,a.useCallback)(async e=>{try{let a=await r(e);if(!a?.syncedProjectId)throw Error("Project is not synced to cloud");if(!await w(a.syncedProjectId))throw Error("Failed to delete remote project");return await s(e,""),o({title:"Remote project deleted",description:"Remote project has been deleted",variant:"default"}),t&&t(),{success:!0,message:"Remote project deleted successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return o({title:"Delete failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[r,s,o,t]),u=(0,a.useCallback)(async a=>{try{let i=await r(a);if(!i?.syncedProjectId)throw Error("Project must be synced to toggle public status");let s=await g(i.syncedProjectId);if(!s.success)throw Error("Failed to toggle public status");let{DexieDB:n}=await e.A(97551);return await n.structureData.update(a,{isPublic:s.isPublic}),o({title:"Public status updated",description:`Project is now ${s.isPublic?"public":"private"}`,variant:"default"}),t&&t(),{success:!0,message:"Public status updated successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return o({title:"Toggle failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[r,o,t]);return{syncToCloud:c,pullFromRemote:l,deleteLocal:d,deleteRemote:m,togglePublic:u,refreshPublicClone:(0,a.useCallback)(async e=>{try{if(!e.publicSourceId)throw Error("Project is not a public clone");return await E(e),o({title:"Public clone refreshed",description:"Project has been updated with latest public commits",variant:"default"}),t&&t(),{success:!0,message:"Public clone refreshed successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return o({title:"Refresh failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[o,t]),resolveConflict:(0,a.useCallback)(async(e,r,a)=>{try{return"pull"===a?(await I(e.id,r.id),o({title:"Pulled remote changes",description:"Local project was overwritten with remote commits",variant:"default"})):(await S(e.id,e.structureName),o({title:"Pushed local changes",description:"Remote project was overwritten with local commits",variant:"default"})),t&&t(),{success:!0,message:"Conflict resolved successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return o({title:"Conflict resolution failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[o,t])}}var Z=e.i(10837);let ee=(0,$.default)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);var et=e.i(57021),er=e.i(73672),ea=e.i(88177),ei=e.i(76832);let es=(0,ea.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),eo=a.forwardRef(({className:e,variant:t,...a},i)=>(0,r.jsx)("div",{ref:i,role:"alert",className:(0,ei.cn)(es({variant:t}),e),...a}));eo.displayName="Alert",a.forwardRef(({className:e,...t},a)=>(0,r.jsx)("h5",{ref:a,className:(0,ei.cn)("mb-1 font-medium leading-none tracking-tight",e),...t})).displayName="AlertTitle";let en=a.forwardRef(({className:e,...t},a)=>(0,r.jsx)("div",{ref:a,className:(0,ei.cn)("text-sm [&_p]:leading-relaxed",e),...t}));en.displayName="AlertDescription";let ec=(0,$.default)("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),el=(0,$.default)("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);async function ed(e){let t=localStorage.getItem("token");if(!e.isEncrypted||!t||!(0,k.isTokenValidForEncryption)(t))return e;try{let r=await Promise.all(e.commits.map(async e=>{if(e.isEncrypted&&e.encryptedData&&e.iv){let r=await (0,k.decryptCommit)({encryptedData:e.encryptedData,iv:e.iv,originalCommitId:e.commitId,originalCommitName:e.commitName,originalParent:e.parent,originalCreatedAt:e.createdAt},t);return{...e,data:r.data,isEncrypted:!1,encryptedData:void 0,iv:void 0}}return e}));return{...e,commits:r,isEncrypted:!1,encryptedAt:void 0,encryptionVersion:void 0}}catch(e){throw console.error("Failed to decrypt project on-demand:",e),Error("Failed to decrypt project data. Please ensure you are logged in with the correct account.")}}async function em(e){let t=localStorage.getItem("token");if(!e.isEncrypted||!t||!(0,k.isTokenValidForEncryption)(t))return e;try{if(e.encryptedData&&e.iv){let r=await (0,k.decryptCommit)({encryptedData:e.encryptedData,iv:e.iv,originalCommitId:e.commitId,originalCommitName:e.commitName,originalParent:e.parent,originalCreatedAt:e.createdAt},t);return{...e,data:r.data,isEncrypted:!1,encryptedData:void 0,iv:void 0}}return e}catch(e){throw console.error("Failed to decrypt commit on-demand:",e),Error("Failed to decrypt commit data. Please ensure you are logged in with the correct account.")}}async function eu(e){let t=localStorage.getItem("token");if(!t||!(0,k.isTokenValidForEncryption)(t))return e;try{let t=await Promise.all(e.map(e=>ed(e)));return setTimeout(()=>{window.gc&&window.gc()},100),t}catch(e){throw console.error("Failed to decrypt projects on-demand:",e),e}}function eh(){window.gc&&window.gc()}function ep(e){return!!e.isEncrypted}function ef(e){return!!e.isEncrypted}function ey(e){let t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new e.constructor(+e):new Date("number"==typeof e||"[object Number]"===t||"string"==typeof e||"[object String]"===t?e:NaN)}function eg(e,t){let r=ey(e),a=ey(t),i=r.getTime()-a.getTime();return i<0?-1:i>0?1:i}let ex={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function ew(e){return (t={})=>{let r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}let eb={date:ew({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:ew({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:ew({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},ej={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function ev(e){return(t,r)=>{let a;if("formatting"===(r?.context?String(r.context):"standalone")&&e.formattingValues){let t=e.defaultFormattingWidth||e.defaultWidth,i=r?.width?String(r.width):t;a=e.formattingValues[i]||e.formattingValues[t]}else{let t=e.defaultWidth,i=r?.width?String(r.width):e.defaultWidth;a=e.values[i]||e.values[t]}return a[e.argumentCallback?e.argumentCallback(t):t]}}function eN(e){return(t,r={})=>{let a,i=r.width,s=i&&e.matchPatterns[i]||e.matchPatterns[e.defaultMatchWidth],o=t.match(s);if(!o)return null;let n=o[0],c=i&&e.parsePatterns[i]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(c)?function(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r}(c,e=>e.test(n)):function(e,t){for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return r}(c,e=>e.test(n));return a=e.valueCallback?e.valueCallback(l):l,{value:a=r.valueCallback?r.valueCallback(a):a,rest:t.slice(n.length)}}}let eC={code:"en-US",formatDistance:(e,t,r)=>{let a,i=ex[e];if(a="string"==typeof i?i:1===t?i.one:i.other.replace("{{count}}",t.toString()),r?.addSuffix)if(r.comparison&&r.comparison>0)return"in "+a;else return a+" ago";return a},formatLong:eb,formatRelative:(e,t,r,a)=>ej[e],localize:{ordinalNumber:(e,t)=>{let r=Number(e),a=r%100;if(a>20||a<10)switch(a%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},era:ev({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:ev({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:ev({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:ev({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:ev({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(t={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)},(e,r={})=>{let a=e.match(t.matchPattern);if(!a)return null;let i=a[0],s=e.match(t.parsePattern);if(!s)return null;let o=t.valueCallback?t.valueCallback(s[0]):s[0];return{value:o=r.valueCallback?r.valueCallback(o):o,rest:e.slice(i.length)}}),era:eN({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:eN({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:eN({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:eN({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:eN({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}},ek={};function eD(e){let t=ey(e),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),e-r}function eP(e){if(null==e)return"Unknown date";try{let t="string"==typeof e?new Date(e).getTime():e;return function(e,t){var r;return function(e,t,r){var a,i,s;let o,n,c,l,d=r?.locale??ek.locale??eC,m=eg(e,t);if(isNaN(m))throw RangeError("Invalid time value");let u=Object.assign({},r,{addSuffix:r?.addSuffix,comparison:m});m>0?(o=ey(t),n=ey(e)):(o=ey(e),n=ey(t));let h=(a=n,i=o,l=(ey(a)-ey(i))/1e3,(s=void 0,e=>{let t=(s?Math[s]:Math.trunc)(e);return 0===t?0:t})(l)),p=Math.round((h-(eD(n)-eD(o))/1e3)/60);if(p<2)if(r?.includeSeconds)if(h<5)return d.formatDistance("lessThanXSeconds",5,u);else if(h<10)return d.formatDistance("lessThanXSeconds",10,u);else if(h<20)return d.formatDistance("lessThanXSeconds",20,u);else if(h<40)return d.formatDistance("halfAMinute",0,u);else if(h<60)return d.formatDistance("lessThanXMinutes",1,u);else return d.formatDistance("xMinutes",1,u);else if(0===p)return d.formatDistance("lessThanXMinutes",1,u);else return d.formatDistance("xMinutes",p,u);if(p<45)return d.formatDistance("xMinutes",p,u);if(p<90)return d.formatDistance("aboutXHours",1,u);if(p<1440){let e=Math.round(p/60);return d.formatDistance("aboutXHours",e,u)}if(p<2520)return d.formatDistance("xDays",1,u);else if(p<43200){let e=Math.round(p/1440);return d.formatDistance("xDays",e,u)}else if(p<86400)return c=Math.round(p/43200),d.formatDistance("aboutXMonths",c,u);if((c=function(e,t){let r,a,i,s,o=ey(e),n=ey(t),c=eg(o,n),l=Math.abs((a=ey(o),i=ey(n),s=a.getFullYear()-i.getFullYear(),12*s+(a.getMonth()-i.getMonth())));if(l<1)r=0;else{var d;let t,a,i,s;1===o.getMonth()&&o.getDate()>27&&o.setDate(30),o.setMonth(o.getMonth()-c*l);let m=eg(o,n)===-c;d=ey(e),s=ey(d),+((t=ey(s)).setHours(23,59,59,999),t)==+(i=(a=ey(s)).getMonth(),a.setFullYear(a.getFullYear(),i+1,0),a.setHours(23,59,59,999),a)&&1===l&&1===eg(e,n)&&(m=!1),r=c*(l-Number(m))}return 0===r?0:r}(n,o))<12){let e=Math.round(p/43200);return d.formatDistance("xMonths",e,u)}{let e=c%12,t=Math.trunc(c/12);return e<3?d.formatDistance("aboutXYears",t,u):e<9?d.formatDistance("overXYears",t,u):d.formatDistance("almostXYears",t+1,u)}}(e,(r=Date.now(),e instanceof Date?new e.constructor(r):new Date(r)),t)}(new Date(t),{addSuffix:!0})}catch{return"Unknown date"}}function eI({commit:e,projectId:t,isCurrentCommit:i=!1,isBranchHead:o=!1,branchName:c,branchColor:l,isCurrentBranch:d=!1,shareInfo:m}){let{toast:u}=(0,n.useToast)(),{decryptCommit:h,isDecrypting:p}=function(){let{toast:e}=(0,n.useToast)(),[t,r]=(0,a.useState)(!1),i=(0,a.useRef)(null),s=(0,a.useCallback)(()=>{i.current&&(clearTimeout(i.current),i.current=null)},[]),o=(0,a.useCallback)(async(t,a=5e3)=>{if(!ep(t))return t;r(!0),s();try{let e=await ed(t);return i.current=setTimeout(()=>{eh(),i.current=null},a),e}catch(t){return console.error("Failed to decrypt project:",t),e({title:"Decryption Failed",description:"Failed to decrypt project data. Please ensure you are logged in with the correct account.",variant:"destructive"}),null}finally{r(!1)}},[e,s]),c=(0,a.useCallback)(async(t,a=5e3)=>{if(!ef(t))return t;r(!0),s();try{let e=await em(t);return i.current=setTimeout(()=>{eh(),i.current=null},a),e}catch(t){return console.error("Failed to decrypt commit:",t),e({title:"Decryption Failed",description:"Failed to decrypt commit data. Please ensure you are logged in with the correct account.",variant:"destructive"}),null}finally{r(!1)}},[e,s]),l=(0,a.useCallback)(async(t,a=5e3)=>{r(!0),s();try{let e=await eu(t);return i.current=setTimeout(()=>{eh(),i.current=null},a),e}catch(t){return console.error("Failed to decrypt projects:",t),e({title:"Decryption Failed",description:"Failed to decrypt project data. Please ensure you are logged in with the correct account.",variant:"destructive"}),[]}finally{r(!1)}},[e,s]);return{isDecrypting:t,decryptProject:o,decryptCommit:c,decryptProjects:l,clearDecryptedData:(0,a.useCallback)(()=>{s(),eh(),e({title:"Data Cleared",description:"Decrypted data has been cleared from memory.",variant:"default"})},[e,s]),needsDecryption:(0,a.useCallback)(e=>"commits"in e?ep(e):ef(e),[])}}(),{getProject:y}=T(),[g,x]=(0,a.useState)(!1),[w,b]=(0,a.useState)(!1),j=async()=>{if(m)return void b(!0);x(!0);try{let r=await y(t);if(!r)throw Error("Project not found");let a=r.commits?.find(t=>t.commitId===e.commitId);if(!a)throw Error("Commit not found");let i=a;if(a.isEncrypted){let e=await h(a);if(!e)throw Error("Failed to decrypt commit for sharing");i=e}if(!i.data||0===i.data.byteLength)throw Error("Commit data not available");let o=new Uint8Array(i.data),n=Array.from(o,e=>String.fromCharCode(e)).join(""),c=btoa(n),l={structureName:r.structureName,commit:{commitId:e.commitId,commitName:e.commitName,data:c,parent:i.parent}},d=await f(l);if(d&&d.shareUrl){let a={shareUrl:d.shareUrl,shareId:d.shareId,createdAt:new Date(Date.now()),expiresAt:new Date(Date.now()+2592e6)},i=r.commits?.map(t=>t.commitId===e.commitId?{...t,shareInfo:a}:t);await s.DexieDB.structureData.update(t,{commits:i}),b(!0),u({title:"Commit shared successfully",description:"Share link created and copied"})}else throw Error("Failed to create share link")}catch(e){console.error("Error sharing commit:",e),u({title:"Failed to share commit",description:e instanceof Error?e.message:"Unknown error",variant:"destructive"})}finally{x(!1)}},v=e.createdAt||e.date;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(B.Card,{className:`relative border-0 shadow-sm bg-gradient-to-br from-white to-slate-50 transition-all group ${i?"ring-2 ring-blue-500 shadow-md":"hover:shadow-md"}`,children:[l&&(0,r.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 rounded-t-lg",style:{background:`linear-gradient(90deg, ${l}, ${l}88)`}}),(0,r.jsx)(B.CardHeader,{className:`pb-3 ${l?"pt-4":"pt-3"}`,children:(0,r.jsx)("div",{className:"flex items-start justify-between gap-2",children:(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h3",{className:"font-semibold text-sm text-gray-900 truncate",title:e.commitName,children:e.commitName}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5 mt-2",children:[i&&(0,r.jsx)(R.Badge,{className:"text-xs bg-blue-100 text-blue-700 border-0",children:"Current"}),o&&c&&(0,r.jsxs)(R.Badge,{className:`text-xs gap-1 border-0 ${d?"bg-blue-600 text-white":"bg-slate-100 text-slate-700"}`,title:d?"Current branch":void 0,children:[(0,r.jsx)(el,{className:"h-3 w-3"}),c]}),m&&(0,r.jsx)(R.Badge,{className:"text-xs bg-purple-100 text-purple-700 border-0",children:"Shared"})]})]})})}),(0,r.jsxs)(B.CardContent,{className:"pt-0 pb-3",children:[(0,r.jsxs)("p",{className:"text-xs text-gray-500 mb-3",children:[function(e){if(null==e)return"Unknown date";try{let t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return"Unknown date"}}(v),m&&(0,r.jsx)("span",{className:"ml-2 text-purple-600 font-medium",children:"• Shared"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(F.Button,{size:"sm",variant:"outline",onClick:()=>{window.location.href=`/?structureId=${t}&commit=${e.commitId}&load=true`},className:"flex items-center gap-1 text-xs h-8 hover:bg-blue-50 hover:border-blue-200 hover:text-blue-600",children:[(0,r.jsx)(J.Eye,{className:"h-3 w-3"}),"View"]}),(0,r.jsxs)(F.Button,{size:"sm",variant:"outline",onClick:j,disabled:g||p,className:`flex items-center gap-1 text-xs h-8 ${m?"hover:bg-purple-50 hover:border-purple-200 hover:text-purple-600":"hover:bg-emerald-50 hover:border-emerald-200 hover:text-emerald-600"}`,title:m?`Shared on ${new Date(m.createdAt).toLocaleDateString()}`:"Generate shareable link",children:[(0,r.jsx)(ec,{className:"h-3 w-3"}),g?"Sharing...":p?"Decrypting...":m?"Shared":"Share"]})]})]})]}),w&&m&&(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:()=>b(!1)}),(0,r.jsxs)("div",{className:"relative bg-white rounded-lg shadow-lg p-6 max-w-md w-full mx-4 border border-slate-200",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-1 text-gray-900",children:"Share Link"}),(0,r.jsxs)("p",{className:"text-xs text-gray-600 mb-4",children:["Expires on ",new Date(m.expiresAt).toLocaleDateString()]}),(0,r.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,r.jsx)("input",{type:"text",value:m.shareUrl,readOnly:!0,className:"flex-1 px-3 py-2 border border-slate-300 rounded-lg bg-slate-50 text-xs font-mono"}),(0,r.jsx)(F.Button,{size:"sm",onClick:()=>{navigator.clipboard.writeText(m.shareUrl),u({title:"Copied!",description:"Share link copied to clipboard"})},className:"h-8",children:"Copy"})]}),(0,r.jsx)("div",{className:"flex justify-end gap-2",children:(0,r.jsx)(F.Button,{variant:"outline",size:"sm",onClick:()=>b(!1),className:"h-8",children:"Close"})})]})]})]})}let eE=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#14b8a6","#f97316"];function eS({commits:e,currentCommitId:t,branches:a,projectId:i,currentBranchName:s="main"}){if(!e||0===e.length)return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,r.jsx)(el,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No commits found"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"This project doesn't have any commit history yet."})]});let o=new Map;e.forEach(e=>{o.set(e.commitId,e)});let n=new Map;e.forEach(e=>{let t=e.parent;t&&(n.has(t)||n.set(t,[]),n.get(t).push(e.commitId))});let c=new Map;Object.entries(a).forEach(([e,t])=>{if(t.length>0){let r=t[t.length-1];c.set(r,e)}});let l=new Map,d=0;Object.keys(a).forEach(e=>{l.set(e,eE[d%eE.length]),d++});let m=new Map;Object.entries(a).forEach(([e,t])=>{t.forEach(t=>{m.has(t)||m.set(t,e)})});let u=(e,a=0)=>{let d=o.get(e);if(!d)return null;let h=e===t,p=c.has(e),f=m.get(e),y=l.get(f),g=f===s,x=n.get(e)||[];return(0,r.jsxs)("div",{className:"commit-node relative ml-4 border-l-2 border-slate-300 pl-4",children:[(0,r.jsx)("div",{className:"absolute -left-[9px] top-2 w-4 h-4 rounded-full border-2 border-white shadow-sm z-10 transition-transform group-hover:scale-110",style:{backgroundColor:y||"#3b82f6"}}),(0,r.jsx)("div",{className:"commit-details mb-3",children:(0,r.jsx)(eI,{commit:d,projectId:i,isCurrentCommit:h,isBranchHead:p,branchName:f,branchColor:y,isCurrentBranch:g})}),x.length>0&&(0,r.jsx)("div",{className:"children ml-3",children:x.map(e=>u(e,a+1))})]},e)},h=e.filter(e=>!e.parent);return(0,r.jsxs)("div",{className:"flex flex-col flex-1 overflow-hidden",children:[(0,r.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-3",children:h.map(e=>u(e.commitId))}),Object.keys(a).length>1&&(0,r.jsxs)("div",{className:"px-6 py-4 border-t border-slate-200 bg-gradient-to-r from-slate-50 to-white",children:[(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wider mb-3",children:"Branches"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:Object.entries(a).map(([e,t])=>{let a=e===s;return(0,r.jsxs)("div",{className:`flex items-center gap-2 px-2.5 py-1.5 rounded-lg text-xs font-medium transition-all ${a?"bg-blue-100 text-blue-700 border border-blue-200":"bg-slate-100 text-slate-700 border border-slate-200 hover:bg-slate-200"}`,children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:l.get(e)}}),(0,r.jsx)("span",{children:e}),(0,r.jsxs)("span",{className:"opacity-70",children:["(",t.length,")"]})]},e)})})]})]})}var eA=e.i(10636),eM=e.i(66868);function eT({isOpen:e,onClose:t,projectId:i,projectName:s}){let o=(0,eM.useSearchParams)().get("branch")||"main",{commits:n,loading:c,error:l,currentCommitId:d,branches:m}=function(e){let{getProject:t}=T(),[r,i]=(0,a.useState)({commits:[],loading:!0,error:null,currentCommitId:null,branches:{}});return(0,a.useEffect)(()=>{(async()=>{try{i(e=>({...e,loading:!0,error:null}));let r=await t(e);if(!r)return void i(e=>({...e,loading:!1,error:"Project not found",commits:[],currentCommitId:null,branches:{}}));let a=(r.commits||[]).sort((e,t)=>(e.createdAt||e.date||0)-(t.createdAt||t.date||0)),s=a.length>0?a[a.length-1].commitId:null,o=D(a);i({commits:a,loading:!1,error:null,currentCommitId:s,branches:o})}catch(e){console.error("Error fetching commit history:",e),i(t=>({...t,loading:!1,error:e instanceof Error?e.message:"Unknown error",commits:[],currentCommitId:null,branches:{}}))}})()},[e,t]),r}(i);return(0,r.jsx)(et.Dialog,{open:e,onOpenChange:t,children:(0,r.jsxs)(et.DialogContent,{className:"max-w-5xl max-h-[85vh] flex flex-col border-0 shadow-lg bg-white","aria-describedby":"commit-history-description",children:[(0,r.jsxs)(et.DialogHeader,{className:"flex flex-row items-center justify-between border-b border-slate-200 pb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,r.jsx)(el,{className:"h-5 w-5 text-blue-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)(et.DialogTitle,{className:"text-xl",children:"Commit History"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",id:"commit-history-description",children:s})]})]}),(0,r.jsx)(F.Button,{variant:"ghost",size:"sm",onClick:t,className:"h-8 w-8 p-0 hover:bg-slate-100",children:(0,r.jsx)(eA.X,{className:"h-4 w-4"})})]}),(0,r.jsxs)("div",{className:"flex flex-col flex-1 min-h-0",children:[!c&&!l&&n.length>0&&(0,r.jsx)("div",{className:"px-6 py-3 bg-gradient-to-r from-slate-50 to-white border-b border-slate-100",children:(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,r.jsx)("span",{className:"font-semibold text-gray-900",children:n.length})," ",1===n.length?"commit":"commits"," • ",(0,r.jsx)("span",{className:"font-semibold text-gray-900",children:Object.keys(m).length})," ",1===Object.keys(m).length?"branch":"branches"]})}),(0,r.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:c?(0,r.jsx)("div",{className:"p-6 space-y-4",children:Array.from({length:3}).map((e,t)=>(0,r.jsxs)("div",{className:"border border-slate-200 rounded-lg p-4 bg-slate-50/50",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,r.jsx)(er.Skeleton,{className:"h-4 w-40"}),(0,r.jsx)(er.Skeleton,{className:"h-6 w-20"})]}),(0,r.jsx)(er.Skeleton,{className:"h-3 w-32"})]},t))}):l?(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)(eo,{variant:"destructive",children:[(0,r.jsx)(z,{className:"h-4 w-4"}),(0,r.jsxs)(en,{children:["Failed to load commit history: ",l]})]})}):0===n.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center flex-1 text-center py-12",children:[(0,r.jsx)("div",{className:"p-3 bg-slate-100 rounded-full mb-4",children:(0,r.jsx)(el,{className:"h-8 w-8 text-slate-600"})}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"No commits found"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"This project doesn't have any commit history yet."})]}):(0,r.jsx)(eS,{commits:n,currentCommitId:d,branches:m,projectId:i,currentBranchName:o})}),!c&&n.length>0&&(0,r.jsx)("div",{className:"flex justify-end gap-2 pt-4 px-6 pb-4 border-t border-slate-200 bg-gradient-to-r from-slate-50 to-white",children:(0,r.jsx)(F.Button,{variant:"outline",onClick:t,className:"hover:bg-slate-100",children:"Close"})})]})]})})}let eB=(0,$.default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),eF=(0,$.default)("GitCommitHorizontal",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]]),eU=(0,$.default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);var e$=e.i(69311),eL=e.i(75977),eR=e.i(70185);function e_({open:e,onOpenChange:t,project:a,remoteProject:i,remoteCommitCount:s,onResolvePush:o,onResolvePull:n}){let c=a.commits?.length||0,l=s??i?.commitCount??0;return(0,r.jsx)(et.Dialog,{open:e,onOpenChange:t,children:(0,r.jsxs)(et.DialogContent,{className:"max-w-2xl",children:[(0,r.jsxs)(et.DialogHeader,{children:[(0,r.jsxs)(et.DialogTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(Y,{className:"h-5 w-5 text-warning"}),"Resolve Sync Conflict"]}),(0,r.jsx)(et.DialogDescription,{children:"This project has conflicting changes between local and remote versions. Choose how to resolve the conflict."})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 py-4",children:[(0,r.jsxs)("div",{className:"space-y-4 p-4 border rounded-lg bg-muted/30",children:[(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsxs)(R.Badge,{variant:"secondary",className:"flex items-center gap-1",children:[(0,r.jsx)(e$.FileText,{className:"h-3 w-3"}),"Local Version"]})}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center text-sm",children:[(0,r.jsx)(eB,{className:"h-4 w-4 mr-2 text-muted-foreground"}),(0,r.jsxs)("span",{children:["Last modified: ",eP(a.date)]})]}),(0,r.jsxs)("div",{className:"flex items-center text-sm",children:[(0,r.jsx)(eF,{className:"h-4 w-4 mr-2 text-muted-foreground"}),(0,r.jsxs)("span",{children:[c," local commit",1!==c?"s":""]})]}),a.commits?.length>0&&(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("div",{className:"font-medium mb-1",children:"Latest commit:"}),(0,r.jsx)("div",{className:"text-muted-foreground truncate",title:a.commits[a.commits.length-1].commitName,children:a.commits[a.commits.length-1].commitName})]})]})]}),(0,r.jsxs)("div",{className:"space-y-4 p-4 border rounded-lg bg-muted/30",children:[(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsxs)(R.Badge,{variant:"outline",className:"flex items-center gap-1",children:[(0,r.jsx)(_,{className:"h-3 w-3"}),"Remote Version"]})}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center text-sm",children:[(0,r.jsx)(eB,{className:"h-4 w-4 mr-2 text-muted-foreground"}),(0,r.jsxs)("span",{children:["Created: ",eP(i?.createdAt)]})]}),(0,r.jsxs)("div",{className:"flex items-center text-sm",children:[(0,r.jsx)(eU,{className:"h-4 w-4 mr-2 text-muted-foreground"}),(0,r.jsxs)("span",{children:["Updated: ",eP(i?.updatedAt)]})]}),(0,r.jsxs)("div",{className:"flex items-center text-sm",children:[(0,r.jsx)(eF,{className:"h-4 w-4 mr-2 text-muted-foreground"}),(0,r.jsxs)("span",{children:[l," remote commit",1!==l?"s":""]})]}),i?.latestCommit&&(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("div",{className:"font-medium mb-1",children:"Latest commit:"}),(0,r.jsx)("div",{className:"text-muted-foreground truncate",title:i.latestCommit.commitName,children:i.latestCommit.commitName})]})]})]})]}),(0,r.jsxs)(et.DialogFooter,{className:"flex gap-2",children:[(0,r.jsx)(F.Button,{variant:"outline",onClick:()=>t(!1),children:"Cancel"}),(0,r.jsxs)(F.Button,{variant:"secondary",onClick:()=>{o(),t(!1)},className:"flex items-center gap-2",children:[(0,r.jsx)(eR.Upload,{className:"h-4 w-4"}),"Keep Local (Push)"]}),(0,r.jsxs)(F.Button,{variant:"default",onClick:()=>{n(),t(!1)},className:"flex items-center gap-2",children:[(0,r.jsx)(eL.Download,{className:"h-4 w-4"}),"Use Remote (Pull)"]})]})]})})}function eH({project:e,syncState:t,onRefresh:i,remoteProject:s}){let o,{syncToCloud:c,pullFromRemote:l,deleteLocal:d,deleteRemote:m,togglePublic:u,refreshPublicClone:h,resolveConflict:p}=Q({refreshCallback:i}),{toast:f}=(0,n.useToast)(),[y,g]=(0,a.useState)(!1),[x,w]=(0,a.useState)(!1),b=async()=>{await c(e.id,e.structureName)},j=async()=>{await l(e.id)},v=async()=>{window.confirm("Delete local copy? This cannot be undone.")&&await d(e.id)},N=async()=>{window.confirm("Delete cloud copy? This cannot be undone.")&&await m(e.id)},C=async()=>{await u(e.id)},k=async()=>{await h(e)},D=async()=>{if(!e.syncedProjectId)return;let t=window.location.origin,r=e.commits&&e.commits.length>0?e.commits[e.commits.length-1]:null,a=r?`&commit=${r.commitId}`:"",i=`${t}/?publicProject=${e.syncedProjectId}${a}&load=true`;try{await navigator.clipboard.writeText(i),f({title:"Link copied!",description:"Public project link copied to clipboard",variant:"default"})}catch(e){f({title:"Failed to copy",description:"Could not copy link to clipboard",variant:"destructive"})}},P=(0,a.useMemo)(()=>void 0!==t.remoteCommitCount?t.remoteCommitCount:s?.commitCount!==void 0?s.commitCount:void 0,[s?.commitCount,t.remoteCommitCount]),I=(e.commits?.length||0)>0,E=void 0!==P&&P>0,S="out-of-sync"===t.status&&I&&E,A=async()=>{if(!s){await c(e.id,e.structureName),w(!1);return}await p(e,s,"push"),w(!1)},M=async()=>{if(!s){await l(e.id),w(!1);return}await p(e,s,"pull"),w(!1)},T=(()=>{switch(t.status){case"local":return{label:"Sync to Cloud",icon:H,onClick:b,variant:"default"};case"synced":case"public-synced":default:return null;case"out-of-sync":if(S)return{label:"Resolve (Push or Pull)",icon:Y,onClick:()=>w(!0),variant:"default"};if("push"===t.direction)return{label:"Push Changes",icon:H,onClick:b,variant:"default"};if("pull"===t.direction)return{label:"Pull Updates",icon:q,onClick:j,variant:"default"};return null;case"conflict":return{label:"Resolve Conflict",icon:Y,onClick:()=>w(!0),variant:"destructive"};case"public-out-of-sync":return{label:"Update from Public",icon:U.RefreshCw,onClick:k,variant:"default"}}})(),B=((o=[]).push({label:"Delete Local",icon:X.Trash2,onClick:v,destructive:!0}),"local"!==t.status&&e.syncedProjectId&&o.push({label:"Delete from Cloud",icon:X.Trash2,onClick:N,destructive:!0}),"local"!==t.status&&e.syncedProjectId&&o.push({label:e.isPublic?"Make Private":"Make Public",icon:O,onClick:C,destructive:!1}),o);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,r.jsxs)(F.Button,{size:"sm",variant:"outline",onClick:()=>{let t=e.commits?.[e.commits.length-1];t?.commitId?window.location.href=`/?structureId=${e.id}&commit=${t.commitId}&load=true`:window.location.href=`/?structureId=${e.id}&load=true`},className:"h-8 text-xs gap-1.5 hover:bg-blue-50 hover:text-blue-700 hover:border-blue-300",children:[(0,r.jsx)(J.Eye,{className:"h-3.5 w-3.5"}),"Open"]}),e.commits&&e.commits.length>0&&(0,r.jsxs)(F.Button,{size:"sm",variant:"outline",onClick:()=>{g(!0)},className:"h-8 text-xs gap-1.5 hover:bg-slate-100 hover:border-slate-400",children:[(0,r.jsx)(G,{className:"h-3.5 w-3.5"}),"History"]}),e.isPublic&&e.syncedProjectId&&(0,r.jsxs)(F.Button,{size:"sm",variant:"outline",onClick:D,className:"h-8 text-xs gap-1.5 hover:bg-emerald-50 hover:text-emerald-700 hover:border-emerald-300",children:[(0,r.jsx)(K,{className:"h-3.5 w-3.5"}),"Copy Link"]}),T&&(0,r.jsxs)(F.Button,{size:"sm",variant:T.variant,onClick:T.onClick,className:`h-8 text-xs gap-1.5 ${"default"===T.variant?"bg-blue-600 hover:bg-blue-700 text-white":"destructive"===T.variant?"bg-red-600 hover:bg-red-700 text-white":""}`,children:[(0,r.jsx)(T.icon,{className:"h-3.5 w-3.5"}),T.label]}),B.length>0&&(0,r.jsxs)(Z.DropdownMenu,{children:[(0,r.jsx)(Z.DropdownMenuTrigger,{asChild:!0,children:(0,r.jsx)(F.Button,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 hover:bg-slate-100",children:(0,r.jsx)(ee,{className:"h-4 w-4"})})}),(0,r.jsx)(Z.DropdownMenuContent,{align:"end",className:"w-40",children:B.map((e,t)=>(0,r.jsxs)(Z.DropdownMenuItem,{onClick:e.onClick,className:e.destructive?"text-red-600 focus:bg-red-50 focus:text-red-700":"hover:bg-slate-100",children:[(0,r.jsx)(e.icon,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{className:"text-sm",children:e.label})]},t))})]})]}),(0,r.jsx)(eT,{isOpen:y,onClose:()=>g(!1),projectId:e.id,projectName:e.structureName}),(0,r.jsx)(e_,{open:x,onOpenChange:w,project:e,remoteProject:s,remoteCommitCount:P,onResolvePush:A,onResolvePull:M})]})}var eq=e.i(79470);let ez=(0,$.default)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),eW=(0,$.default)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);function eO({project:e,onRefresh:t,remoteProject:s}){let{syncState:o,loading:n}=function({project:e}){let[t,r]=(0,a.useState)({status:"local",localCommitCount:0}),[i,s]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{(async()=>{if(!e)return r({status:"local",localCommitCount:0});s(!0);try{let t=await P(e);r(t)}catch(t){console.error("Failed to get project sync status:",t),r({status:"local",localCommitCount:e.commits?.length||0})}finally{s(!1)}})()},[e]),{syncState:t,loading:i}}({project:e}),{user:c}=(0,i.useAuth)(),l=e.isEncrypted&&!c,d=e.commits?.[e.commits.length-1],m=e.commits?.length||0;return n?(0,r.jsxs)(B.Card,{className:"animate-pulse border-0 bg-gradient-to-br from-slate-50 to-slate-100",children:[(0,r.jsxs)(B.CardHeader,{children:[(0,r.jsx)("div",{className:"h-6 bg-gray-300 rounded w-3/4 mb-2"}),(0,r.jsx)("div",{className:"h-4 bg-gray-300 rounded w-1/2"})]}),(0,r.jsx)(B.CardContent,{children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-300 rounded"}),(0,r.jsx)("div",{className:"h-4 bg-gray-300 rounded w-5/6"})]})})]}):(0,r.jsxs)(B.Card,{className:`border-0 shadow-sm bg-gradient-to-br from-white to-slate-50 transition-all duration-300 group overflow-hidden ${l?"opacity-75 cursor-not-allowed":"hover:shadow-md hover:scale-[1.02]"}`,children:[(0,r.jsx)("div",{className:`h-1 bg-gradient-to-r transition-opacity duration-300 ${l?"from-gray-400 via-gray-500 to-gray-600 opacity-100":"from-blue-400 via-blue-500 to-blue-600 opacity-0 group-hover:opacity-100"}`}),(0,r.jsx)(B.CardHeader,{className:"pb-4 pt-5",children:(0,r.jsx)("div",{className:"flex items-start justify-between gap-3",children:(0,r.jsxs)("div",{className:"flex-1 min-w-0 space-y-2.5",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("h3",{className:"text-base font-semibold text-gray-900 truncate leading-tight",title:e.structureName,children:e.structureName}),l&&(0,r.jsx)(eW,{className:"h-4 w-4 text-gray-500 flex-shrink-0"})]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[l&&(0,r.jsxs)(R.Badge,{className:"gap-1 bg-gray-100 text-gray-700 border-0",children:[(0,r.jsx)(eW,{className:"h-3 w-3"}),"Encrypted - Sign in to access"]}),!l&&(0,r.jsx)(V,{syncState:o}),e.isPublic&&(0,r.jsxs)(R.Badge,{variant:"secondary",className:"gap-1 bg-amber-100 text-amber-900 border-0",children:[(0,r.jsx)(ez,{className:"h-3 w-3"}),"Public"]}),s&&(0,r.jsxs)(R.Badge,{variant:"outline",className:"text-xs gap-1 bg-slate-100 text-slate-700 border-slate-200",children:[(0,r.jsx)(_,{className:"h-3 w-3"}),"Synced"]})]})]})})}),(0,r.jsxs)(B.CardContent,{className:"pb-4 space-y-3",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3 py-2 px-3 bg-slate-50/60 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,r.jsx)(eF,{className:"h-4 w-4 text-blue-500 flex-shrink-0"}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700 truncate",children:m}),(0,r.jsxs)("span",{className:"text-xs text-gray-500 truncate",children:["commit",1!==m?"s":""]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,r.jsx)(eB,{className:"h-4 w-4 text-blue-500 flex-shrink-0"}),(0,r.jsx)("span",{className:"text-xs text-gray-600 truncate",children:eP(e.date)})]})]}),d?.commitName&&(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Latest Commit"}),(0,r.jsx)("p",{className:"text-sm text-gray-700 font-medium truncate",title:d.commitName,children:d.commitName})]}),(void 0!==o.localCommitCount||void 0!==o.remoteCommitCount)&&(0,r.jsxs)("div",{className:"flex items-center gap-3 pt-1 text-xs text-gray-600",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-emerald-500"}),o.localCommitCount??m," local"]}),void 0!==o.remoteCommitCount&&(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-blue-500"}),o.remoteCommitCount," remote"]})]}),e.publicSourceId&&(0,r.jsxs)("div",{className:"flex items-center gap-2 pt-2 px-3 py-2 bg-blue-50 rounded-lg text-xs text-blue-700",children:[(0,r.jsx)(_,{className:"h-3 w-3 flex-shrink-0"}),(0,r.jsx)("span",{children:"Cloned from public project"})]})]}),(0,r.jsx)(B.CardFooter,{className:"pt-0 pb-4",children:(0,r.jsx)("div",{className:"w-full",children:l?(0,r.jsxs)("div",{className:"text-center py-2",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"This project is encrypted"}),(0,r.jsx)(eq.default,{href:"/login",className:"text-sm text-blue-600 hover:text-blue-700 font-medium underline",children:"Sign in to access"})]}):(0,r.jsx)(eH,{project:e,syncState:o,onRefresh:t,remoteProject:s})})})]})}function eV({project:e,onRefresh:t}){let{pullFromRemote:a}=Q({refreshCallback:t}),i=async()=>{await a(e,e.id)};return(0,r.jsxs)(B.Card,{className:"border-0 shadow-sm bg-gradient-to-br from-white to-slate-50 transition-all duration-300 hover:shadow-md hover:scale-[1.02] group overflow-hidden",children:[(0,r.jsx)("div",{className:"h-1 bg-gradient-to-r from-emerald-400 via-emerald-500 to-emerald-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),(0,r.jsx)(B.CardHeader,{className:"pb-4 pt-5",children:(0,r.jsx)("div",{className:"flex items-start justify-between gap-3",children:(0,r.jsxs)("div",{className:"flex-1 min-w-0 space-y-2.5",children:[(0,r.jsx)("h3",{className:"text-base font-semibold text-gray-900 truncate leading-tight",title:e.projectName,children:e.projectName}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,r.jsxs)(R.Badge,{variant:"outline",className:"gap-1.5 text-xs font-medium bg-emerald-100 text-emerald-700 border-emerald-200",children:[(0,r.jsx)(_,{className:"h-3 w-3"}),"Remote"]}),e.isPublic&&(0,r.jsxs)(R.Badge,{variant:"secondary",className:"gap-1 text-xs bg-blue-100 text-blue-700 border-0",children:[(0,r.jsx)(J.Eye,{className:"h-3 w-3"}),"Public"]})]})]})})}),(0,r.jsxs)(B.CardContent,{className:"pb-4 space-y-3",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3 py-2 px-3 bg-slate-50/60 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,r.jsx)(eB,{className:"h-4 w-4 text-emerald-500 flex-shrink-0"}),(0,r.jsx)("span",{className:"text-xs text-gray-600 truncate",children:eP(e.createdAt)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,r.jsx)(eF,{className:"h-4 w-4 text-emerald-500 flex-shrink-0"}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.commitCount})]})]}),e.latestCommit?.commitName&&(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Latest Commit"}),(0,r.jsx)("p",{className:"text-sm text-gray-700 font-medium truncate",title:e.latestCommit.commitName,children:e.latestCommit.commitName})]})]}),(0,r.jsxs)(B.CardFooter,{className:"pt-0 pb-4 flex gap-2",children:[(0,r.jsxs)(F.Button,{onClick:()=>{e.latestCommit?.id?window.open(`/?publicProject=${e.id}&commit=${e.latestCommit.id}&load=true`,"_blank"):window.open(`/?publicProject=${e.id}&load=true`,"_blank")},size:"sm",variant:"outline",className:"flex-1 h-8 text-xs gap-1.5 hover:bg-blue-50 hover:text-blue-700 hover:border-blue-300",children:[(0,r.jsx)(J.Eye,{className:"h-3.5 w-3.5"}),"Preview"]}),(0,r.jsxs)(F.Button,{onClick:i,size:"sm",className:"flex-1 h-8 text-xs gap-1.5 bg-emerald-600 hover:bg-emerald-700 text-white",children:[(0,r.jsx)(eL.Download,{className:"h-3.5 w-3.5"}),"Pull"]})]})]})}var eX=e.i(44187);let eY=(0,$.default)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),eJ=(0,$.default)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var eG=e.i(45381);let eK=(0,$.default)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);function eQ({commit:e,onRefresh:t}){let[i,s]=(0,a.useState)(!1),{toast:o}=(0,n.useToast)(),c=async()=>{try{await navigator.clipboard.writeText(e.shareUrl),s(!0),o({title:"URL copied",description:"Share URL has been copied to clipboard",variant:"default"}),setTimeout(()=>s(!1),2e3)}catch(e){o({title:"Failed to copy",description:"Could not copy URL to clipboard",variant:"destructive"})}},l=async()=>{if(window.confirm("Delete this shared link? This will revoke access."))try{if(!await b(e.commitId))throw Error("Failed to delete shared commit");o({title:"Share deleted",description:"The shared commit has been removed",variant:"default"}),t()}catch(e){o({title:"Delete failed",description:"Could not delete the shared commit",variant:"destructive"})}};return(0,r.jsxs)(B.Card,{className:"border-0 shadow-sm bg-gradient-to-br from-white to-slate-50 transition-all duration-300 hover:shadow-md hover:scale-[1.02] group overflow-hidden",children:[(0,r.jsx)("div",{className:"h-1 bg-gradient-to-r from-purple-400 via-purple-500 to-purple-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),(0,r.jsx)(B.CardHeader,{className:"pb-4 pt-5",children:(0,r.jsx)("div",{className:"flex items-start justify-between gap-3",children:(0,r.jsxs)("div",{className:"flex-1 min-w-0 space-y-2.5",children:[(0,r.jsx)("h3",{className:"text-base font-semibold text-gray-900 truncate leading-tight",title:e.commitName,children:e.commitName}),(0,r.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:(0,r.jsxs)(R.Badge,{variant:"outline",className:"gap-1.5 text-xs font-medium bg-purple-100 text-purple-700 border-purple-200",children:[(0,r.jsx)(eK,{className:"h-3 w-3"}),"Shared"]})})]})})}),(0,r.jsxs)(B.CardContent,{className:"pb-4 space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 py-2 px-3 bg-slate-50/60 rounded-lg",children:[(0,r.jsx)(eB,{className:"h-4 w-4 text-purple-500 flex-shrink-0"}),(0,r.jsxs)("span",{className:"text-xs text-gray-600",children:["Shared ",eP(e.createdAt)]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Share Link"}),(0,r.jsxs)("div",{className:"flex gap-1.5",children:[(0,r.jsx)(eX.Input,{value:e.shareUrl,readOnly:!0,className:"flex-1 text-xs px-2.5 py-1.5 border-slate-200 bg-slate-50 h-8"}),(0,r.jsx)(F.Button,{size:"sm",variant:"outline",onClick:c,className:"h-8 w-8 p-0 flex-shrink-0 hover:bg-purple-50 hover:border-purple-300",children:i?(0,r.jsx)(eG.Check,{className:"h-4 w-4 text-green-600"}):(0,r.jsx)(eJ,{className:"h-4 w-4"})})]})]})]}),(0,r.jsxs)(B.CardFooter,{className:"pt-0 pb-4 flex gap-2",children:[(0,r.jsxs)(F.Button,{onClick:()=>{window.open(e.shareUrl,"_blank")},size:"sm",className:"flex-1 h-8 text-xs gap-1.5 bg-purple-600 hover:bg-purple-700 text-white",children:[(0,r.jsx)(eY,{className:"h-3.5 w-3.5"}),"View"]}),(0,r.jsx)(F.Button,{onClick:l,size:"sm",variant:"outline",className:"h-8 px-2.5 text-xs hover:bg-red-50 hover:text-red-700 hover:border-red-300",children:(0,r.jsx)(X.Trash2,{className:"h-3.5 w-3.5"})})]})]})}var eZ=e.i(2380),e0=e.i(64312);function e1({items:e,renderItem:t,emptyMessage:i="No items to display",itemsPerPage:s=6}){let[o,n]=(0,a.useState)(1),c=Math.max(1,Math.ceil(e.length/s));(0,a.useEffect)(()=>{n(e=>Math.min(e,c))},[c]);let{startIndex:l,endIndex:d,currentItems:m}=(0,a.useMemo)(()=>{let t=(o-1)*s,r=t+s;return{startIndex:t,endIndex:r,currentItems:e.slice(t,r)}},[o,e,s]);return 0===e.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center gap-3 rounded-lg border border-dashed bg-muted/30 px-6 py-10 text-center",children:[(0,r.jsx)("div",{className:"relative h-24 w-24 text-muted-foreground",children:(0,r.jsxs)("svg",{viewBox:"0 0 120 120",className:"h-24 w-24","aria-hidden":"true",children:[(0,r.jsx)("defs",{children:(0,r.jsxs)("linearGradient",{id:"grid-ill",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,r.jsx)("stop",{offset:"0%",stopColor:"#9ca3af",stopOpacity:"0.2"}),(0,r.jsx)("stop",{offset:"100%",stopColor:"#3b82f6",stopOpacity:"0.35"})]})}),(0,r.jsx)("rect",{x:"14",y:"14",width:"92",height:"92",rx:"12",fill:"url(#grid-ill)"}),(0,r.jsx)("rect",{x:"32",y:"32",width:"56",height:"56",rx:"8",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeDasharray:"6 6"}),(0,r.jsx)("path",{d:"M52 60h16M60 52v16",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold tracking-tight",children:i}),(0,r.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Create or pull a project to get started."})]})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",children:m.map((e,r)=>t(e,l+r))}),c>1&&e.length>s&&(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 pt-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(F.Button,{variant:"outline",size:"sm",onClick:()=>{o>1&&n(o-1)},disabled:1===o,className:"gap-1.5",children:[(0,r.jsx)(eZ.ChevronLeft,{className:"h-4 w-4"}),"Prev"]}),(0,r.jsx)("div",{className:"flex items-center gap-1",children:(()=>{let e=[];if(c<=5)for(let t=1;t<=c;t++)e.push(t);else{e.push(1),o>3&&e.push("...");let t=Math.max(2,o-1),r=Math.min(c-1,o+1);for(let a=t;a<=r;a++)e.push(a);o<c-2&&e.push("..."),e.push(c)}return e.map((e,t)=>"..."===e?(0,r.jsx)("span",{className:"px-2 text-muted-foreground",children:"..."},`ellipsis-${t}`):(0,r.jsx)(F.Button,{variant:o===e?"default":"outline",size:"sm",onClick:()=>{n(e)},className:"min-w-[2rem]",children:e},e))})()}),(0,r.jsxs)(F.Button,{variant:"outline",size:"sm",onClick:()=>{o<c&&n(o+1)},disabled:o===c,className:"gap-1.5",children:["Next",(0,r.jsx)(e0.ChevronRight,{className:"h-4 w-4"})]})]}),(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Showing ",l+1," to ",Math.min(d,e.length)," of ",e.length]})]})]})}var e2=e.i(60031),e4=e.i(89966);function e3({open:e,onOpenChange:t,onSuccess:i}){let[s,o]=(0,a.useState)(""),[c,l]=(0,a.useState)(!1),{createProject:d}=T(),{toast:m}=(0,n.useToast)(),u=async()=>{if(!s.trim())return void m({title:"Project name required",description:"Please enter a project name",variant:"destructive"});l(!0);try{await d({structureName:s.trim(),isSynced:!1,syncedProjectId:"",isRemote:!1,isPublic:!1,publicSourceId:"",branches:{main:[]},commits:[]}),m({title:"Project created",description:`${s} has been created successfully`,variant:"default"}),o(""),t(!1),i()}catch(e){m({title:"Create failed",description:e instanceof Error?e.message:"Failed to create project",variant:"destructive"})}finally{l(!1)}};return(0,r.jsx)(et.Dialog,{open:e,onOpenChange:t,children:(0,r.jsxs)(et.DialogContent,{className:"sm:max-w-md",children:[(0,r.jsxs)(et.DialogHeader,{children:[(0,r.jsxs)(et.DialogTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(e4.Folder,{className:"h-5 w-5"}),"Create New Project"]}),(0,r.jsx)(et.DialogDescription,{children:"Enter a name for your new project. It will be created locally."})]}),(0,r.jsx)("div",{className:"grid gap-4 py-4",children:(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsx)(e2.Label,{htmlFor:"projectName",children:"Project Name"}),(0,r.jsx)(eX.Input,{id:"projectName",value:s,onChange:e=>o(e.target.value),onKeyPress:e=>{"Enter"===e.key&&!c&&s.trim()&&u()},placeholder:"Enter project name...",disabled:c,autoFocus:!0})]})}),(0,r.jsxs)(et.DialogFooter,{children:[(0,r.jsx)(F.Button,{variant:"outline",onClick:()=>t(!1),disabled:c,children:"Cancel"}),(0,r.jsx)(F.Button,{onClick:u,disabled:c||!s.trim(),className:"flex items-center gap-2",children:c?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),"Creating..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(L,{className:"h-4 w-4"}),"Create Project"]})})]})]})})}function e5(){let{user:e}=(0,i.useAuth)(),{localProjects:t,remoteProjects:s,sharedCommits:o,loading:c,refresh:l}=function(){let{user:e,isAuthenticated:t}=(0,i.useAuth)(),{getAllProjects:r,getDecryptedProject:s,getDecryptedProjects:o}=T(),{toast:c}=(0,n.useToast)(),[l,d]=(0,a.useState)([]),[m,h]=(0,a.useState)([]),[p,f]=(0,a.useState)([]),[g,x]=(0,a.useState)(!0),w=e=>{let t=e.commits[e.commits.length-1];return{...e,latestCommit:t,commitCount:e.commits.length}},b=(0,a.useCallback)(async e=>{try{return await s(e)}catch(t){console.error(`Failed to get decrypted project ${e}:`,t),c({title:"Decryption Failed",description:"Failed to decrypt project data. Please ensure you are logged in with the correct account.",variant:"destructive"});return}},[s,c]),j=(0,a.useCallback)(async e=>{try{return await o(e)}catch(e){return console.error("Failed to get decrypted projects:",e),c({title:"Decryption Failed",description:"Failed to decrypt project data. Please ensure you are logged in with the correct account.",variant:"destructive"}),[]}},[o,c]),v=(0,a.useCallback)(async()=>{x(!0);try{let e=(await r()).map(w);if(d(e),t)try{let[e,t]=await Promise.all([u(),y()]);h(e),f(t)}catch(e){console.error("Failed to fetch remote data:",e),c({title:"Sync Error",description:"Failed to fetch remote projects. Using cached data.",variant:"destructive"})}else h([]),f([])}catch(e){console.error("Failed to refresh library data:",e),c({title:"Library Error",description:"Failed to load library data. Please try again.",variant:"destructive"})}finally{x(!1)}},[r,t]);return(0,a.useEffect)(()=>{v()},[v]),(0,a.useEffect)(()=>{v()},[e,v]),{localProjects:l,remoteProjects:m,sharedCommits:p,loading:g,refresh:v,getDecryptedProjectData:b,getDecryptedProjectsData:j}}(),[d,m]=(0,a.useState)(!1),h=new Set(t.filter(e=>e.syncedProjectId).map(e=>e.syncedProjectId)),p=s.filter(e=>!h.has(e.id)),f=new Map(s.map(e=>[e.id,e])),g=[...t,...p];return(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-4xl font-bold tracking-tight font-headline text-gray-900",children:"Library"}),(0,r.jsx)("p",{className:"text-base text-gray-600 mt-2 max-w-lg",children:"Manage your oxDNA projects, sync with the cloud, and share with others"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(F.Button,{variant:"outline",size:"icon",onClick:l,disabled:c,className:"hover:bg-slate-100",children:(0,r.jsx)(U.RefreshCw,{className:`h-5 w-5 ${c?"animate-spin":""}`})}),(0,r.jsxs)(F.Button,{onClick:()=>m(!0),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[(0,r.jsx)(L,{className:"mr-2 h-5 w-5"}),"Create New"]})]})]}),(0,r.jsxs)(B.Card,{className:"border-0 shadow-sm",children:[(0,r.jsxs)(B.CardHeader,{className:"border-b border-slate-200 bg-gradient-to-r from-slate-50 to-white",children:[(0,r.jsx)(B.CardTitle,{className:"text-xl",children:"Projects"}),(0,r.jsx)(B.CardDescription,{children:"Your local projects and synced projects from the cloud"})]}),(0,r.jsx)(B.CardContent,{className:"pt-6",children:(0,r.jsx)(e1,{items:g,renderItem:e=>"commits"in e?(0,r.jsx)(eO,{project:e,onRefresh:l,remoteProject:e.syncedProjectId?f.get(e.syncedProjectId):void 0},e.id):(0,r.jsx)(eV,{project:e,onRefresh:l},e.id),emptyMessage:"No projects found. Create a new project or log in to see synced projects."})})]}),e&&(0,r.jsxs)(B.Card,{className:"border-0 shadow-sm",children:[(0,r.jsxs)(B.CardHeader,{className:"border-b border-slate-200 bg-gradient-to-r from-slate-50 to-white",children:[(0,r.jsx)(B.CardTitle,{className:"text-xl",children:"Shared by Me"}),(0,r.jsx)(B.CardDescription,{children:"Individual commits you've shared via unique links"})]}),(0,r.jsx)(B.CardContent,{className:"pt-6",children:(0,r.jsx)(e1,{items:o,renderItem:e=>(0,r.jsx)(eQ,{commit:e,onRefresh:l},e.commitId),emptyMessage:"No shared commits found"})})]}),(0,r.jsx)(e3,{open:d,onOpenChange:m,onSuccess:l})]})}e.s(["default",()=>e5],51462)}]);