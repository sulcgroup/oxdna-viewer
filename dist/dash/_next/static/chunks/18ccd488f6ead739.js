(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,51462,e=>{"use strict";var t,a=e.i(37081),r=e.i(33506),s=e.i(3614),i=e.i(29233),n=e.i(88442),l=e.i(42163),o=e.i(69496),c=e.i(80559),d=e.i(69663),m=e.i(34270);let u=(0,m.default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var h=e.i(74502);let x=(0,m.default)("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),p=(0,m.default)("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]),f=(0,m.default)("CloudDownload",[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]]),g=(0,m.default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),y=(0,m.default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),b=(0,m.default)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);function j({syncState:e}){let{status:t,direction:r}=e;return(0,a.jsxs)(h.Badge,{variant:"outline",className:`gap-1.5 text-xs font-medium border ${(()=>{switch(t){case"local":return"bg-slate-100 text-slate-700 border-slate-200 hover:bg-slate-200";case"synced":return"bg-emerald-100 text-emerald-700 border-emerald-200 hover:bg-emerald-200";case"out-of-sync":return"bg-amber-100 text-amber-700 border-amber-200 hover:bg-amber-200";case"conflict":return"bg-red-100 text-red-700 border-red-200 hover:bg-red-200";case"public-synced":case"public-out-of-sync":return"bg-blue-100 text-blue-700 border-blue-200 hover:bg-blue-200";default:return"bg-gray-100 text-gray-700 border-gray-200 hover:bg-gray-200"}})()}`,children:[(()=>{switch(t){case"local":default:return(0,a.jsx)(x,{className:"h-3 w-3"});case"synced":return(0,a.jsx)(y,{className:"h-3 w-3"});case"out-of-sync":if("push"===r)return(0,a.jsx)(p,{className:"h-3 w-3"});if("pull"===r)return(0,a.jsx)(f,{className:"h-3 w-3"});return(0,a.jsx)(x,{className:"h-3 w-3"});case"conflict":return(0,a.jsx)(g,{className:"h-3 w-3"});case"public-synced":case"public-out-of-sync":return(0,a.jsx)(b,{className:"h-3 w-3"})}})(),(0,a.jsx)("span",{children:(()=>{switch(t){case"local":return"Local";case"synced":return"Synced";case"out-of-sync":if("push"===r)return"Push ↑";if("pull"===r)return"Pull ↓";return"Out of Sync";case"conflict":return"Conflict ⚠";case"public-synced":return"Public";case"public-out-of-sync":return"Update Available";default:return"Unknown"}})()})]})}var v=e.i(29984);let w=(0,m.default)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var N=e.i(59450);let C=(0,m.default)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);var k=e.i(20819);function P({refreshCallback:e}={}){let{getProject:t,deleteProject:a,markProjectAsSynced:s}=(0,i.useDexie)(),{toast:o}=(0,n.useToast)(),c=(0,r.useCallback)(async(a,r)=>{try{if(!await t(a))throw Error("Local project not found");return await (0,k.syncProjectToCloud)(a,r),o({title:"Project synced successfully",description:`${r} has been synced to the cloud`,variant:"default"}),e&&e(),{success:!0,message:"Project synced successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return o({title:"Sync failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[t,o,e]),d=(0,r.useCallback)(async(t,a)=>{try{return await (0,k.pullRemoteProject)(t,a),o({title:"Project pulled successfully",description:"Remote project has been pulled to local",variant:"default"}),e&&e(),{success:!0,message:"Project pulled successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return o({title:"Pull failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[o,e]),m=(0,r.useCallback)(async t=>{try{return await a(t),o({title:"Project deleted",description:"Local project has been deleted",variant:"default"}),e&&e(),{success:!0,message:"Project deleted successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return o({title:"Delete failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[a,o,e]),u=(0,r.useCallback)(async a=>{try{let r=await t(a);if(!r?.syncedProjectId)throw Error("Project is not synced to cloud");if(!await (0,l.deleteSyncedProject)(r.syncedProjectId))throw Error("Failed to delete remote project");return await s(a,""),o({title:"Remote project deleted",description:"Remote project has been deleted",variant:"default"}),e&&e(),{success:!0,message:"Remote project deleted successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return o({title:"Delete failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[t,s,o,e]),h=(0,r.useCallback)(async a=>{try{let r=await t(a);if(!r?.syncedProjectId)throw Error("Project must be synced to toggle public status");let s=await (0,l.toggleProjectPublic)(r.syncedProjectId);if(!s.success)throw Error("Failed to toggle public status");return o({title:"Public status updated",description:`Project is now ${s.isPublic?"public":"private"}`,variant:"default"}),e&&e(),{success:!0,message:"Public status updated successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return o({title:"Toggle failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[t,o,e]);return{syncToCloud:c,pullFromRemote:d,deleteLocal:m,deleteRemote:u,togglePublic:h,refreshPublicClone:(0,r.useCallback)(async t=>{try{if(!t.publicSourceId)throw Error("Project is not a public clone");return await (0,k.refreshPublicClonedProject)(t),o({title:"Public clone refreshed",description:"Project has been updated with latest public commits",variant:"default"}),e&&e(),{success:!0,message:"Public clone refreshed successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return o({title:"Refresh failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[o,e]),resolveConflict:(0,r.useCallback)(async(t,a,r)=>{try{return"pull"===r?(await (0,k.pullRemoteProject)(t.id,a.id),o({title:"Pulled remote changes",description:"Local project was overwritten with remote commits",variant:"default"})):(await (0,k.syncProjectToCloud)(t.id,t.structureName),o({title:"Pushed local changes",description:"Remote project was overwritten with local commits",variant:"default"})),e&&e(),{success:!0,message:"Conflict resolved successfully"}}catch(t){let e=t instanceof Error?t.message:"Unknown error occurred";return o({title:"Conflict resolution failed",description:e,variant:"destructive"}),{success:!1,error:e}}},[o,e])}}var M=e.i(10837);let D=(0,m.default)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);var S=e.i(57021),E=e.i(73672),F=e.i(88177),I=e.i(76832);let T=(0,F.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),A=r.forwardRef(({className:e,variant:t,...r},s)=>(0,a.jsx)("div",{ref:s,role:"alert",className:(0,I.cn)(T({variant:t}),e),...r}));A.displayName="Alert",r.forwardRef(({className:e,...t},r)=>(0,a.jsx)("h5",{ref:r,className:(0,I.cn)("mb-1 font-medium leading-none tracking-tight",e),...t})).displayName="AlertTitle";let B=r.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,I.cn)("text-sm [&_p]:leading-relaxed",e),...t}));B.displayName="AlertDescription";let U=(0,m.default)("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),W=(0,m.default)("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);var R=e.i(59822);async function z(e){let t=localStorage.getItem("token");if(!e.isEncrypted||!t||!(0,R.isTokenValidForEncryption)(t))return e;try{let a=await Promise.all(e.commits.map(async e=>{if(e.isEncrypted&&e.encryptedData&&e.iv){let a=await (0,R.decryptCommit)({encryptedData:e.encryptedData,iv:e.iv,originalCommitId:e.commitId,originalCommitName:e.commitName,originalParent:e.parent,originalCreatedAt:e.createdAt},t);return{...e,data:a.data,isEncrypted:!1,encryptedData:void 0,iv:void 0}}return e}));return{...e,commits:a,isEncrypted:!1,encryptedAt:void 0,encryptionVersion:void 0}}catch(e){throw console.error("Failed to decrypt project on-demand:",e),Error("Failed to decrypt project data. Please ensure you are logged in with the correct account.")}}async function L(e){let t=localStorage.getItem("token");if(!e.isEncrypted||!t||!(0,R.isTokenValidForEncryption)(t))return e;try{if(e.encryptedData&&e.iv){let a=await (0,R.decryptCommit)({encryptedData:e.encryptedData,iv:e.iv,originalCommitId:e.commitId,originalCommitName:e.commitName,originalParent:e.parent,originalCreatedAt:e.createdAt},t);return{...e,data:a.data,isEncrypted:!1,encryptedData:void 0,iv:void 0}}return e}catch(e){throw console.error("Failed to decrypt commit on-demand:",e),Error("Failed to decrypt commit data. Please ensure you are logged in with the correct account.")}}async function O(e){let t=localStorage.getItem("token");if(!t||!(0,R.isTokenValidForEncryption)(t))return e;try{let t=await Promise.all(e.map(e=>z(e)));return setTimeout(()=>{window.gc&&window.gc()},100),t}catch(e){throw console.error("Failed to decrypt projects on-demand:",e),e}}function $(){window.gc&&window.gc()}function q(e){return!!e.isEncrypted}function H(e){return!!e.isEncrypted}function X({commit:t,projectId:s,isCurrentCommit:i=!1,isBranchHead:d=!1,branchName:m,branchColor:u,isCurrentBranch:x=!1,shareInfo:p}){let{toast:f}=(0,n.useToast)(),{decryptCommit:g,isDecrypting:y}=function(){let{toast:e}=(0,n.useToast)(),[t,a]=(0,r.useState)(!1),s=(0,r.useRef)(null),i=(0,r.useCallback)(()=>{s.current&&(clearTimeout(s.current),s.current=null)},[]),l=(0,r.useCallback)(async(t,r=5e3)=>{if(!q(t))return t;a(!0),i();try{let e=await z(t);return s.current=setTimeout(()=>{$(),s.current=null},r),e}catch(t){return console.error("Failed to decrypt project:",t),e({title:"Decryption Failed",description:"Failed to decrypt project data. Please ensure you are logged in with the correct account.",variant:"destructive"}),null}finally{a(!1)}},[e,i]),o=(0,r.useCallback)(async(t,r=5e3)=>{if(!H(t))return t;a(!0),i();try{let e=await L(t);return s.current=setTimeout(()=>{$(),s.current=null},r),e}catch(t){return console.error("Failed to decrypt commit:",t),e({title:"Decryption Failed",description:"Failed to decrypt commit data. Please ensure you are logged in with the correct account.",variant:"destructive"}),null}finally{a(!1)}},[e,i]),c=(0,r.useCallback)(async(t,r=5e3)=>{a(!0),i();try{let e=await O(t);return s.current=setTimeout(()=>{$(),s.current=null},r),e}catch(t){return console.error("Failed to decrypt projects:",t),e({title:"Decryption Failed",description:"Failed to decrypt project data. Please ensure you are logged in with the correct account.",variant:"destructive"}),[]}finally{a(!1)}},[e,i]);return{isDecrypting:t,decryptProject:l,decryptCommit:o,decryptProjects:c,clearDecryptedData:(0,r.useCallback)(()=>{i(),$(),e({title:"Data Cleared",description:"Decrypted data has been cleared from memory.",variant:"default"})},[e,i]),needsDecryption:(0,r.useCallback)(e=>"commits"in e?q(e):H(e),[])}}(),[b,j]=(0,r.useState)(!1),[v,w]=(0,r.useState)(!1),C=async()=>{if(p)return void w(!0);j(!0);try{let{useDexie:a}=await e.A(71710),{getProject:r}=a(),i=await r(s);if(!i)throw Error("Project not found");let n=i.commits?.find(e=>e.commitId===t.commitId);if(!n)throw Error("Commit not found");let o=n;if(n.isEncrypted){let e=await g(n);if(!e)throw Error("Failed to decrypt commit for sharing");o=e}if(!o.data||0===o.data.byteLength)throw Error("Commit data not available");let c=new Uint8Array(o.data),d=Array.from(c,e=>String.fromCharCode(e)).join(""),m=btoa(d),u={structureName:i.structureName,commit:{commitId:t.commitId,commitName:t.commitName,data:m,parent:o.parent}},h=await (0,l.shareCommit)(u);if(h&&h.shareUrl){let a={shareUrl:h.shareUrl,shareId:h.shareId,createdAt:new Date(Date.now()),expiresAt:new Date(Date.now()+2592e6)},r=i.commits?.map(e=>e.commitId===t.commitId?{...e,shareInfo:a}:e);await e.A(97551).then(({DexieDB:e})=>e.structureData.update(s,{commits:r})),w(!0),f({title:"Commit shared successfully",description:"Share link created and copied"})}else throw Error("Failed to create share link")}catch(e){console.error("Error sharing commit:",e),f({title:"Failed to share commit",description:e instanceof Error?e.message:"Unknown error",variant:"destructive"})}finally{j(!1)}},k=t.createdAt||t.date;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(o.Card,{className:`relative border-0 shadow-sm bg-gradient-to-br from-white to-slate-50 transition-all group ${i?"ring-2 ring-blue-500 shadow-md":"hover:shadow-md"}`,children:[u&&(0,a.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 rounded-t-lg",style:{background:`linear-gradient(90deg, ${u}, ${u}88)`}}),(0,a.jsx)(o.CardHeader,{className:`pb-3 ${u?"pt-4":"pt-3"}`,children:(0,a.jsx)("div",{className:"flex items-start justify-between gap-2",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"font-semibold text-sm text-gray-900 truncate",title:t.commitName,children:t.commitName}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5 mt-2",children:[i&&(0,a.jsx)(h.Badge,{className:"text-xs bg-blue-100 text-blue-700 border-0",children:"Current"}),d&&m&&(0,a.jsxs)(h.Badge,{className:`text-xs gap-1 border-0 ${x?"bg-blue-600 text-white":"bg-slate-100 text-slate-700"}`,title:x?"Current branch":void 0,children:[(0,a.jsx)(W,{className:"h-3 w-3"}),m]}),p&&(0,a.jsx)(h.Badge,{className:"text-xs bg-purple-100 text-purple-700 border-0",children:"Shared"})]})]})})}),(0,a.jsxs)(o.CardContent,{className:"pt-0 pb-3",children:[(0,a.jsxs)("p",{className:"text-xs text-gray-500 mb-3",children:[(e=>{if(!e)return"Unknown date";let t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})(k),p&&(0,a.jsx)("span",{className:"ml-2 text-purple-600 font-medium",children:"• Shared"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(c.Button,{size:"sm",variant:"outline",onClick:()=>{window.location.href=`/?structureId=${s}&commit=${t.commitId}&load=true`},className:"flex items-center gap-1 text-xs h-8 hover:bg-blue-50 hover:border-blue-200 hover:text-blue-600",children:[(0,a.jsx)(N.Eye,{className:"h-3 w-3"}),"View"]}),(0,a.jsxs)(c.Button,{size:"sm",variant:"outline",onClick:C,disabled:b||y,className:`flex items-center gap-1 text-xs h-8 ${p?"hover:bg-purple-50 hover:border-purple-200 hover:text-purple-600":"hover:bg-emerald-50 hover:border-emerald-200 hover:text-emerald-600"}`,title:p?`Shared on ${new Date(p.createdAt).toLocaleDateString()}`:"Generate shareable link",children:[(0,a.jsx)(U,{className:"h-3 w-3"}),b?"Sharing...":y?"Decrypting...":p?"Shared":"Share"]})]})]})]}),v&&p&&(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:()=>w(!1)}),(0,a.jsxs)("div",{className:"relative bg-white rounded-lg shadow-lg p-6 max-w-md w-full mx-4 border border-slate-200",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-1 text-gray-900",children:"Share Link"}),(0,a.jsxs)("p",{className:"text-xs text-gray-600 mb-4",children:["Expires on ",new Date(p.expiresAt).toLocaleDateString()]}),(0,a.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,a.jsx)("input",{type:"text",value:p.shareUrl,readOnly:!0,className:"flex-1 px-3 py-2 border border-slate-300 rounded-lg bg-slate-50 text-xs font-mono"}),(0,a.jsx)(c.Button,{size:"sm",onClick:()=>{navigator.clipboard.writeText(p.shareUrl),f({title:"Copied!",description:"Share link copied to clipboard"})},className:"h-8",children:"Copy"})]}),(0,a.jsx)("div",{className:"flex justify-end gap-2",children:(0,a.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>w(!1),className:"h-8",children:"Close"})})]})]})]})}let V=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#14b8a6","#f97316"];function Y({commits:e,currentCommitId:t,branches:r,projectId:s,currentBranchName:i="main"}){if(!e||0===e.length)return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,a.jsx)(W,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No commits found"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"This project doesn't have any commit history yet."})]});let n=new Map;e.forEach(e=>{n.set(e.commitId,e)});let l=new Map;e.forEach(e=>{let t=e.parent;t&&(l.has(t)||l.set(t,[]),l.get(t).push(e.commitId))});let o=new Map;Object.entries(r).forEach(([e,t])=>{if(t.length>0){let a=t[t.length-1];o.set(a,e)}});let c=new Map,d=0;Object.keys(r).forEach(e=>{c.set(e,V[d%V.length]),d++});let m=new Map;Object.entries(r).forEach(([e,t])=>{t.forEach(t=>{m.has(t)||m.set(t,e)})});let u=(e,r=0)=>{let d=n.get(e);if(!d)return null;let h=e===t,x=o.has(e),p=m.get(e),f=c.get(p),g=p===i,y=l.get(e)||[];return(0,a.jsxs)("div",{className:"commit-node relative ml-4 border-l-2 border-slate-300 pl-4",children:[(0,a.jsx)("div",{className:"absolute -left-[9px] top-2 w-4 h-4 rounded-full border-2 border-white shadow-sm z-10 transition-transform group-hover:scale-110",style:{backgroundColor:f||"#3b82f6"}}),(0,a.jsx)("div",{className:"commit-details mb-3",children:(0,a.jsx)(X,{commit:d,projectId:s,isCurrentCommit:h,isBranchHead:x,branchName:p,branchColor:f,isCurrentBranch:g})}),y.length>0&&(0,a.jsx)("div",{className:"children ml-3",children:y.map(e=>u(e,r+1))})]},e)},h=e.filter(e=>!e.parent);return(0,a.jsxs)("div",{className:"flex flex-col flex-1 overflow-hidden",children:[(0,a.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-3",children:h.map(e=>u(e.commitId))}),Object.keys(r).length>1&&(0,a.jsxs)("div",{className:"px-6 py-4 border-t border-slate-200 bg-gradient-to-r from-slate-50 to-white",children:[(0,a.jsx)("h4",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wider mb-3",children:"Branches"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:Object.entries(r).map(([e,t])=>{let r=e===i;return(0,a.jsxs)("div",{className:`flex items-center gap-2 px-2.5 py-1.5 rounded-lg text-xs font-medium transition-all ${r?"bg-blue-100 text-blue-700 border border-blue-200":"bg-slate-100 text-slate-700 border border-slate-200 hover:bg-slate-200"}`,children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:c.get(e)}}),(0,a.jsx)("span",{children:e}),(0,a.jsxs)("span",{className:"opacity-70",children:["(",t.length,")"]})]},e)})})]})]})}var J=e.i(10636),G=e.i(66868);function K({isOpen:e,onClose:t,projectId:s,projectName:n}){let l=(0,G.useSearchParams)().get("branch")||"main",{commits:o,loading:d,error:m,currentCommitId:u,branches:h}=function(e){let{getProject:t}=(0,i.useDexie)(),[a,s]=(0,r.useState)({commits:[],loading:!0,error:null,currentCommitId:null,branches:{}});return(0,r.useEffect)(()=>{(async()=>{try{s(e=>({...e,loading:!0,error:null}));let a=await t(e);if(!a)return void s(e=>({...e,loading:!1,error:"Project not found",commits:[],currentCommitId:null,branches:{}}));let r=a.commits||[],i=(0,k.sortCommitsChronologically)(r),n=i.length>0?i[i.length-1].commitId:null,l=(0,k.reconstructBranchesFromParents)(i);s({commits:i,loading:!1,error:null,currentCommitId:n,branches:l})}catch(e){console.error("Error fetching commit history:",e),s(t=>({...t,loading:!1,error:e instanceof Error?e.message:"Unknown error",commits:[],currentCommitId:null,branches:{}}))}})()},[e,t]),a}(s);return(0,a.jsx)(S.Dialog,{open:e,onOpenChange:t,children:(0,a.jsxs)(S.DialogContent,{className:"max-w-5xl max-h-[85vh] flex flex-col border-0 shadow-lg bg-white","aria-describedby":"commit-history-description",children:[(0,a.jsxs)(S.DialogHeader,{className:"flex flex-row items-center justify-between border-b border-slate-200 pb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,a.jsx)(W,{className:"h-5 w-5 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(S.DialogTitle,{className:"text-xl",children:"Commit History"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",id:"commit-history-description",children:n})]})]}),(0,a.jsx)(c.Button,{variant:"ghost",size:"sm",onClick:t,className:"h-8 w-8 p-0 hover:bg-slate-100",children:(0,a.jsx)(J.X,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"flex flex-col flex-1 min-h-0",children:[!d&&!m&&o.length>0&&(0,a.jsx)("div",{className:"px-6 py-3 bg-gradient-to-r from-slate-50 to-white border-b border-slate-100",children:(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,a.jsx)("span",{className:"font-semibold text-gray-900",children:o.length})," ",1===o.length?"commit":"commits"," • ",(0,a.jsx)("span",{className:"font-semibold text-gray-900",children:Object.keys(h).length})," ",1===Object.keys(h).length?"branch":"branches"]})}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:d?(0,a.jsx)("div",{className:"p-6 space-y-4",children:Array.from({length:3}).map((e,t)=>(0,a.jsxs)("div",{className:"border border-slate-200 rounded-lg p-4 bg-slate-50/50",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,a.jsx)(E.Skeleton,{className:"h-4 w-40"}),(0,a.jsx)(E.Skeleton,{className:"h-6 w-20"})]}),(0,a.jsx)(E.Skeleton,{className:"h-3 w-32"})]},t))}):m?(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)(A,{variant:"destructive",children:[(0,a.jsx)(g,{className:"h-4 w-4"}),(0,a.jsxs)(B,{children:["Failed to load commit history: ",m]})]})}):0===o.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center flex-1 text-center py-12",children:[(0,a.jsx)("div",{className:"p-3 bg-slate-100 rounded-full mb-4",children:(0,a.jsx)(W,{className:"h-8 w-8 text-slate-600"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"No commits found"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"This project doesn't have any commit history yet."})]}):(0,a.jsx)(Y,{commits:o,currentCommitId:u,branches:h,projectId:s,currentBranchName:l})}),!d&&o.length>0&&(0,a.jsx)("div",{className:"flex justify-end gap-2 pt-4 px-6 pb-4 border-t border-slate-200 bg-gradient-to-r from-slate-50 to-white",children:(0,a.jsx)(c.Button,{variant:"outline",onClick:t,className:"hover:bg-slate-100",children:"Close"})})]})]})})}function Q(e){let t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new e.constructor(+e):new Date("number"==typeof e||"[object Number]"===t||"string"==typeof e||"[object String]"===t?e:NaN)}function _(e,t){let a=Q(e),r=Q(t),s=a.getTime()-r.getTime();return s<0?-1:s>0?1:s}let Z={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function ee(e){return (t={})=>{let a=t.width?String(t.width):e.defaultWidth;return e.formats[a]||e.formats[e.defaultWidth]}}let et={date:ee({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:ee({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:ee({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},ea={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function er(e){return(t,a)=>{let r;if("formatting"===(a?.context?String(a.context):"standalone")&&e.formattingValues){let t=e.defaultFormattingWidth||e.defaultWidth,s=a?.width?String(a.width):t;r=e.formattingValues[s]||e.formattingValues[t]}else{let t=e.defaultWidth,s=a?.width?String(a.width):e.defaultWidth;r=e.values[s]||e.values[t]}return r[e.argumentCallback?e.argumentCallback(t):t]}}function es(e){return(t,a={})=>{let r,s=a.width,i=s&&e.matchPatterns[s]||e.matchPatterns[e.defaultMatchWidth],n=t.match(i);if(!n)return null;let l=n[0],o=s&&e.parsePatterns[s]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(o)?function(e,t){for(let a=0;a<e.length;a++)if(t(e[a]))return a}(o,e=>e.test(l)):function(e,t){for(let a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&t(e[a]))return a}(o,e=>e.test(l));return r=e.valueCallback?e.valueCallback(c):c,{value:r=a.valueCallback?a.valueCallback(r):r,rest:t.slice(l.length)}}}let ei={code:"en-US",formatDistance:(e,t,a)=>{let r,s=Z[e];if(r="string"==typeof s?s:1===t?s.one:s.other.replace("{{count}}",t.toString()),a?.addSuffix)if(a.comparison&&a.comparison>0)return"in "+r;else return r+" ago";return r},formatLong:et,formatRelative:(e,t,a,r)=>ea[e],localize:{ordinalNumber:(e,t)=>{let a=Number(e),r=a%100;if(r>20||r<10)switch(r%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},era:er({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:er({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:er({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:er({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:er({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(t={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)},(e,a={})=>{let r=e.match(t.matchPattern);if(!r)return null;let s=r[0],i=e.match(t.parsePattern);if(!i)return null;let n=t.valueCallback?t.valueCallback(i[0]):i[0];return{value:n=a.valueCallback?a.valueCallback(n):n,rest:e.slice(s.length)}}),era:es({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:es({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:es({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:es({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:es({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}},en={};function el(e){let t=Q(e),a=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return a.setUTCFullYear(t.getFullYear()),e-a}function eo(e,t){var a;return function(e,t,a){var r,s,i;let n,l,o,c=a?.locale??en.locale??ei,d=_(e,t);if(isNaN(d))throw RangeError("Invalid time value");let m=Object.assign({},a,{addSuffix:a?.addSuffix,comparison:d});d>0?(n=Q(t),l=Q(e)):(n=Q(e),l=Q(t));let u=(r=l,s=n,(i=void 0,e=>{let t=(i?Math[i]:Math.trunc)(e);return 0===t?0:t})((Q(r)-Q(s))/1e3)),h=Math.round((u-(el(l)-el(n))/1e3)/60);if(h<2)if(a?.includeSeconds)if(u<5)return c.formatDistance("lessThanXSeconds",5,m);else if(u<10)return c.formatDistance("lessThanXSeconds",10,m);else if(u<20)return c.formatDistance("lessThanXSeconds",20,m);else if(u<40)return c.formatDistance("halfAMinute",0,m);else if(u<60)return c.formatDistance("lessThanXMinutes",1,m);else return c.formatDistance("xMinutes",1,m);else if(0===h)return c.formatDistance("lessThanXMinutes",1,m);else return c.formatDistance("xMinutes",h,m);if(h<45)return c.formatDistance("xMinutes",h,m);if(h<90)return c.formatDistance("aboutXHours",1,m);if(h<1440){let e=Math.round(h/60);return c.formatDistance("aboutXHours",e,m)}if(h<2520)return c.formatDistance("xDays",1,m);else if(h<43200){let e=Math.round(h/1440);return c.formatDistance("xDays",e,m)}else if(h<86400)return o=Math.round(h/43200),c.formatDistance("aboutXMonths",o,m);if((o=function(e,t){let a,r,s,i=Q(e),n=Q(t),l=_(i,n),o=Math.abs((r=Q(i),s=Q(n),12*(r.getFullYear()-s.getFullYear())+(r.getMonth()-s.getMonth())));if(o<1)a=0;else{var c;let t,r,s,d;1===i.getMonth()&&i.getDate()>27&&i.setDate(30),i.setMonth(i.getMonth()-l*o);let m=_(i,n)===-l;c=Q(e),d=Q(c),+((t=Q(d)).setHours(23,59,59,999),t)==+(s=(r=Q(d)).getMonth(),r.setFullYear(r.getFullYear(),s+1,0),r.setHours(23,59,59,999),r)&&1===o&&1===_(e,n)&&(m=!1),a=l*(o-Number(m))}return 0===a?0:a}(l,n))<12){let e=Math.round(h/43200);return c.formatDistance("xMonths",e,m)}{let e=o%12,t=Math.trunc(o/12);return e<3?c.formatDistance("aboutXYears",t,m):e<9?c.formatDistance("overXYears",t,m):c.formatDistance("almostXYears",t+1,m)}}(e,(a=Date.now(),e instanceof Date?new e.constructor(a):new Date(a)),t)}let ec=(0,m.default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),ed=(0,m.default)("GitCommitHorizontal",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]]),em=(0,m.default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);var eu=e.i(69311),eh=e.i(75977),ex=e.i(70185);function ep({open:e,onOpenChange:t,project:r,remoteProject:s,remoteCommitCount:i,onResolvePush:n,onResolvePull:l}){let o=r.commits?.length||0,d=i??s?.commitCount??0,m=e=>{try{let t="string"==typeof e?parseInt(e):e;return eo(new Date(t),{addSuffix:!0})}catch{return"Unknown date"}};return(0,a.jsx)(S.Dialog,{open:e,onOpenChange:t,children:(0,a.jsxs)(S.DialogContent,{className:"max-w-2xl",children:[(0,a.jsxs)(S.DialogHeader,{children:[(0,a.jsxs)(S.DialogTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(w,{className:"h-5 w-5 text-warning"}),"Resolve Sync Conflict"]}),(0,a.jsx)(S.DialogDescription,{children:"This project has conflicting changes between local and remote versions. Choose how to resolve the conflict."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 py-4",children:[(0,a.jsxs)("div",{className:"space-y-4 p-4 border rounded-lg bg-muted/30",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)(h.Badge,{variant:"secondary",className:"flex items-center gap-1",children:[(0,a.jsx)(eu.FileText,{className:"h-3 w-3"}),"Local Version"]})}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center text-sm",children:[(0,a.jsx)(ec,{className:"h-4 w-4 mr-2 text-muted-foreground"}),(0,a.jsxs)("span",{children:["Last modified: ",m(r.date)]})]}),(0,a.jsxs)("div",{className:"flex items-center text-sm",children:[(0,a.jsx)(ed,{className:"h-4 w-4 mr-2 text-muted-foreground"}),(0,a.jsxs)("span",{children:[o," local commit",1!==o?"s":""]})]}),r.commits?.length>0&&(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("div",{className:"font-medium mb-1",children:"Latest commit:"}),(0,a.jsx)("div",{className:"text-muted-foreground truncate",title:r.commits[r.commits.length-1].commitName,children:r.commits[r.commits.length-1].commitName})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4 p-4 border rounded-lg bg-muted/30",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)(h.Badge,{variant:"outline",className:"flex items-center gap-1",children:[(0,a.jsx)(x,{className:"h-3 w-3"}),"Remote Version"]})}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center text-sm",children:[(0,a.jsx)(ec,{className:"h-4 w-4 mr-2 text-muted-foreground"}),(0,a.jsxs)("span",{children:["Created: ",s?m(s.createdAt):"Unknown"]})]}),(0,a.jsxs)("div",{className:"flex items-center text-sm",children:[(0,a.jsx)(em,{className:"h-4 w-4 mr-2 text-muted-foreground"}),(0,a.jsxs)("span",{children:["Updated: ",s?m(s.updatedAt):"Unknown"]})]}),(0,a.jsxs)("div",{className:"flex items-center text-sm",children:[(0,a.jsx)(ed,{className:"h-4 w-4 mr-2 text-muted-foreground"}),(0,a.jsxs)("span",{children:[d," remote commit",1!==d?"s":""]})]}),s?.latestCommit&&(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("div",{className:"font-medium mb-1",children:"Latest commit:"}),(0,a.jsx)("div",{className:"text-muted-foreground truncate",title:s.latestCommit.commitName,children:s.latestCommit.commitName})]})]})]})]}),(0,a.jsxs)(S.DialogFooter,{className:"flex gap-2",children:[(0,a.jsx)(c.Button,{variant:"outline",onClick:()=>t(!1),children:"Cancel"}),(0,a.jsxs)(c.Button,{variant:"secondary",onClick:()=>{n(),t(!1)},className:"flex items-center gap-2",children:[(0,a.jsx)(ex.Upload,{className:"h-4 w-4"}),"Keep Local (Push)"]}),(0,a.jsxs)(c.Button,{variant:"default",onClick:()=>{l(),t(!1)},className:"flex items-center gap-2",children:[(0,a.jsx)(eh.Download,{className:"h-4 w-4"}),"Use Remote (Pull)"]})]})]})})}function ef({project:e,syncState:t,onRefresh:s,remoteProject:i}){let n,{syncToCloud:l,pullFromRemote:o,deleteLocal:m,deleteRemote:u,togglePublic:h,refreshPublicClone:x,resolveConflict:g}=P({refreshCallback:s}),[y,j]=(0,r.useState)(!1),[k,S]=(0,r.useState)(!1),E=async()=>{await l(e.id,e.structureName)},F=async()=>{await o(e.id)},I=async()=>{window.confirm("Delete local copy? This cannot be undone.")&&await m(e.id)},T=async()=>{window.confirm("Delete cloud copy? This cannot be undone.")&&await u(e.id)},A=async()=>{await h(e.id)},B=async()=>{await x(e)},U=(0,r.useMemo)(()=>void 0!==t.remoteCommitCount?t.remoteCommitCount:i?.commitCount!==void 0?i.commitCount:void 0,[i?.commitCount,t.remoteCommitCount]),W=(e.commits?.length||0)>0,R=void 0!==U&&U>0,z="out-of-sync"===t.status&&W&&R,L=async()=>{if(!i){await l(e.id,e.structureName),S(!1);return}await g(e,i,"push"),S(!1)},O=async()=>{if(!i){await o(e.id),S(!1);return}await g(e,i,"pull"),S(!1)},$=(()=>{switch(t.status){case"local":return{label:"Sync to Cloud",icon:p,onClick:E,variant:"default"};case"synced":case"public-synced":default:return null;case"out-of-sync":if(z)return{label:"Resolve (Push or Pull)",icon:w,onClick:()=>S(!0),variant:"default"};if("push"===t.direction)return{label:"Push Changes",icon:p,onClick:E,variant:"default"};if("pull"===t.direction)return{label:"Pull Updates",icon:f,onClick:F,variant:"default"};return null;case"conflict":return{label:"Resolve Conflict",icon:w,onClick:()=>S(!0),variant:"destructive"};case"public-out-of-sync":return{label:"Update from Public",icon:d.RefreshCw,onClick:B,variant:"default"}}})(),q=((n=[]).push({label:"Delete Local",icon:v.Trash2,onClick:I,destructive:!0}),"local"!==t.status&&e.syncedProjectId&&n.push({label:"Delete from Cloud",icon:v.Trash2,onClick:T,destructive:!0}),"local"!==t.status&&e.syncedProjectId&&n.push({label:e.isPublic?"Make Private":"Make Public",icon:b,onClick:A,destructive:!1}),n);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,a.jsxs)(c.Button,{size:"sm",variant:"outline",onClick:()=>{let t=e.commits?.[e.commits.length-1];t?.commitId?window.location.href=`/?structureId=${e.id}&commit=${t.commitId}&load=true`:window.location.href=`/?structureId=${e.id}&load=true`},className:"h-8 text-xs gap-1.5 hover:bg-blue-50 hover:text-blue-700 hover:border-blue-300",children:[(0,a.jsx)(N.Eye,{className:"h-3.5 w-3.5"}),"Open"]}),e.commits&&e.commits.length>0&&(0,a.jsxs)(c.Button,{size:"sm",variant:"outline",onClick:()=>{j(!0)},className:"h-8 text-xs gap-1.5 hover:bg-slate-100 hover:border-slate-400",children:[(0,a.jsx)(C,{className:"h-3.5 w-3.5"}),"History"]}),$&&(0,a.jsxs)(c.Button,{size:"sm",variant:$.variant,onClick:$.onClick,className:`h-8 text-xs gap-1.5 ${"default"===$.variant?"bg-blue-600 hover:bg-blue-700 text-white":"destructive"===$.variant?"bg-red-600 hover:bg-red-700 text-white":""}`,children:[(0,a.jsx)($.icon,{className:"h-3.5 w-3.5"}),$.label]}),q.length>0&&(0,a.jsxs)(M.DropdownMenu,{children:[(0,a.jsx)(M.DropdownMenuTrigger,{asChild:!0,children:(0,a.jsx)(c.Button,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 hover:bg-slate-100",children:(0,a.jsx)(D,{className:"h-4 w-4"})})}),(0,a.jsx)(M.DropdownMenuContent,{align:"end",className:"w-40",children:q.map((e,t)=>(0,a.jsxs)(M.DropdownMenuItem,{onClick:e.onClick,className:e.destructive?"text-red-600 focus:bg-red-50 focus:text-red-700":"hover:bg-slate-100",children:[(0,a.jsx)(e.icon,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm",children:e.label})]},t))})]})]}),(0,a.jsx)(K,{isOpen:y,onClose:()=>j(!1),projectId:e.id,projectName:e.structureName}),(0,a.jsx)(ep,{open:k,onOpenChange:S,project:e,remoteProject:i,remoteCommitCount:U,onResolvePush:L,onResolvePull:O})]})}let eg=(0,m.default)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);function ey({project:e,onRefresh:t,remoteProject:s}){let{syncState:i,loading:n}=function({project:e}){let[t,a]=(0,r.useState)({status:"local",localCommitCount:0}),[s,i]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{(async()=>{if(!e)return a({status:"local",localCommitCount:0});i(!0);try{let t=await (0,k.getProjectSyncStatus)(e);a(t)}catch(t){console.error("Failed to get project sync status:",t),a({status:"local",localCommitCount:e.commits?.length||0})}finally{i(!1)}})()},[e]),{syncState:t,loading:s}}({project:e}),l=e.commits?.[e.commits.length-1],c=e.commits?.length||0;return n?(0,a.jsxs)(o.Card,{className:"animate-pulse border-0 bg-gradient-to-br from-slate-50 to-slate-100",children:[(0,a.jsxs)(o.CardHeader,{children:[(0,a.jsx)("div",{className:"h-6 bg-gray-300 rounded w-3/4 mb-2"}),(0,a.jsx)("div",{className:"h-4 bg-gray-300 rounded w-1/2"})]}),(0,a.jsx)(o.CardContent,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-300 rounded"}),(0,a.jsx)("div",{className:"h-4 bg-gray-300 rounded w-5/6"})]})})]}):(0,a.jsxs)(o.Card,{className:"border-0 shadow-sm bg-gradient-to-br from-white to-slate-50 transition-all duration-300 hover:shadow-md hover:scale-[1.02] group overflow-hidden",children:[(0,a.jsx)("div",{className:"h-1 bg-gradient-to-r from-blue-400 via-blue-500 to-blue-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),(0,a.jsx)(o.CardHeader,{className:"pb-4 pt-5",children:(0,a.jsx)("div",{className:"flex items-start justify-between gap-3",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0 space-y-2.5",children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900 truncate leading-tight",title:e.structureName,children:e.structureName}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsx)(j,{syncState:i}),e.isPublic&&(0,a.jsxs)(h.Badge,{variant:"secondary",className:"gap-1 bg-amber-100 text-amber-900 border-0",children:[(0,a.jsx)(eg,{className:"h-3 w-3"}),"Public"]}),s&&(0,a.jsxs)(h.Badge,{variant:"outline",className:"text-xs gap-1 bg-slate-100 text-slate-700 border-slate-200",children:[(0,a.jsx)(x,{className:"h-3 w-3"}),"Synced"]})]})]})})}),(0,a.jsxs)(o.CardContent,{className:"pb-4 space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 py-2 px-3 bg-slate-50/60 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,a.jsx)(ed,{className:"h-4 w-4 text-blue-500 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700 truncate",children:c}),(0,a.jsxs)("span",{className:"text-xs text-gray-500 truncate",children:["commit",1!==c?"s":""]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,a.jsx)(ec,{className:"h-4 w-4 text-blue-500 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-xs text-gray-600 truncate",children:(e=>{try{return eo(new Date(e),{addSuffix:!0})}catch{return"Unknown date"}})(e.date)})]})]}),l?.commitName&&(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Latest Commit"}),(0,a.jsx)("p",{className:"text-sm text-gray-700 font-medium truncate",title:l.commitName,children:l.commitName})]}),(void 0!==i.localCommitCount||void 0!==i.remoteCommitCount)&&(0,a.jsxs)("div",{className:"flex items-center gap-3 pt-1 text-xs text-gray-600",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-emerald-500"}),i.localCommitCount??c," local"]}),void 0!==i.remoteCommitCount&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-blue-500"}),i.remoteCommitCount," remote"]})]}),e.publicSourceId&&(0,a.jsxs)("div",{className:"flex items-center gap-2 pt-2 px-3 py-2 bg-blue-50 rounded-lg text-xs text-blue-700",children:[(0,a.jsx)(x,{className:"h-3 w-3 flex-shrink-0"}),(0,a.jsx)("span",{children:"Cloned from public project"})]})]}),(0,a.jsx)(o.CardFooter,{className:"pt-0 pb-4",children:(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(ef,{project:e,syncState:i,onRefresh:t,remoteProject:s})})})]})}function eb({project:e,onRefresh:t}){let{pullFromRemote:r}=P({refreshCallback:t}),s=async()=>{await r(e,e.id)};return(0,a.jsxs)(o.Card,{className:"border-0 shadow-sm bg-gradient-to-br from-white to-slate-50 transition-all duration-300 hover:shadow-md hover:scale-[1.02] group overflow-hidden",children:[(0,a.jsx)("div",{className:"h-1 bg-gradient-to-r from-emerald-400 via-emerald-500 to-emerald-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),(0,a.jsx)(o.CardHeader,{className:"pb-4 pt-5",children:(0,a.jsx)("div",{className:"flex items-start justify-between gap-3",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0 space-y-2.5",children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900 truncate leading-tight",title:e.projectName,children:e.projectName}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsxs)(h.Badge,{variant:"outline",className:"gap-1.5 text-xs font-medium bg-emerald-100 text-emerald-700 border-emerald-200",children:[(0,a.jsx)(x,{className:"h-3 w-3"}),"Remote"]}),e.isPublic&&(0,a.jsxs)(h.Badge,{variant:"secondary",className:"gap-1 text-xs bg-blue-100 text-blue-700 border-0",children:[(0,a.jsx)(N.Eye,{className:"h-3 w-3"}),"Public"]})]})]})})}),(0,a.jsxs)(o.CardContent,{className:"pb-4 space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 py-2 px-3 bg-slate-50/60 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,a.jsx)(ec,{className:"h-4 w-4 text-emerald-500 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-xs text-gray-600 truncate",children:(e=>{try{let t="string"==typeof e?parseInt(e):e;return eo(new Date(t),{addSuffix:!0})}catch{return"Unknown date"}})(e.createdAt)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,a.jsx)(ed,{className:"h-4 w-4 text-emerald-500 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.commitCount})]})]}),e.latestCommit?.commitName&&(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Latest Commit"}),(0,a.jsx)("p",{className:"text-sm text-gray-700 font-medium truncate",title:e.latestCommit.commitName,children:e.latestCommit.commitName})]})]}),(0,a.jsxs)(o.CardFooter,{className:"pt-0 pb-4 flex gap-2",children:[(0,a.jsxs)(c.Button,{onClick:()=>{e.latestCommit?.id?window.open(`/?publicProject=${e.id}&commit=${e.latestCommit.id}&load=true`,"_blank"):window.open(`/?publicProject=${e.id}&load=true`,"_blank")},size:"sm",variant:"outline",className:"flex-1 h-8 text-xs gap-1.5 hover:bg-blue-50 hover:text-blue-700 hover:border-blue-300",children:[(0,a.jsx)(N.Eye,{className:"h-3.5 w-3.5"}),"Preview"]}),(0,a.jsxs)(c.Button,{onClick:s,size:"sm",className:"flex-1 h-8 text-xs gap-1.5 bg-emerald-600 hover:bg-emerald-700 text-white",children:[(0,a.jsx)(eh.Download,{className:"h-3.5 w-3.5"}),"Pull"]})]})]})}var ej=e.i(44187);let ev=(0,m.default)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),ew=(0,m.default)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var eN=e.i(45381);let eC=(0,m.default)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);function ek({commit:e,onRefresh:t}){let[s,i]=(0,r.useState)(!1),{toast:l}=(0,n.useToast)(),d=async()=>{try{await navigator.clipboard.writeText(e.shareUrl),i(!0),l({title:"URL copied",description:"Share URL has been copied to clipboard",variant:"default"}),setTimeout(()=>i(!1),2e3)}catch(e){l({title:"Failed to copy",description:"Could not copy URL to clipboard",variant:"destructive"})}},m=async()=>{if(window.confirm("Delete this shared link? This will revoke access."))try{if(!(await fetch(`/api/v1/share/commit/${e.commitId}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok)throw Error("Failed to delete shared commit");l({title:"Share deleted",description:"The shared commit has been removed",variant:"default"}),t()}catch(e){l({title:"Delete failed",description:"Could not delete the shared commit",variant:"destructive"})}};return(0,a.jsxs)(o.Card,{className:"border-0 shadow-sm bg-gradient-to-br from-white to-slate-50 transition-all duration-300 hover:shadow-md hover:scale-[1.02] group overflow-hidden",children:[(0,a.jsx)("div",{className:"h-1 bg-gradient-to-r from-purple-400 via-purple-500 to-purple-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),(0,a.jsx)(o.CardHeader,{className:"pb-4 pt-5",children:(0,a.jsx)("div",{className:"flex items-start justify-between gap-3",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0 space-y-2.5",children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900 truncate leading-tight",title:e.commitName,children:e.commitName}),(0,a.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:(0,a.jsxs)(h.Badge,{variant:"outline",className:"gap-1.5 text-xs font-medium bg-purple-100 text-purple-700 border-purple-200",children:[(0,a.jsx)(eC,{className:"h-3 w-3"}),"Shared"]})})]})})}),(0,a.jsxs)(o.CardContent,{className:"pb-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 py-2 px-3 bg-slate-50/60 rounded-lg",children:[(0,a.jsx)(ec,{className:"h-4 w-4 text-purple-500 flex-shrink-0"}),(0,a.jsxs)("span",{className:"text-xs text-gray-600",children:["Shared ",(e=>{try{return eo(new Date(e),{addSuffix:!0})}catch{return"Unknown date"}})(e.createdAt)]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-xs font-medium text-gray-700 uppercase tracking-wider",children:"Share Link"}),(0,a.jsxs)("div",{className:"flex gap-1.5",children:[(0,a.jsx)(ej.Input,{value:e.shareUrl,readOnly:!0,className:"flex-1 text-xs px-2.5 py-1.5 border-slate-200 bg-slate-50 h-8"}),(0,a.jsx)(c.Button,{size:"sm",variant:"outline",onClick:d,className:"h-8 w-8 p-0 flex-shrink-0 hover:bg-purple-50 hover:border-purple-300",children:s?(0,a.jsx)(eN.Check,{className:"h-4 w-4 text-green-600"}):(0,a.jsx)(ew,{className:"h-4 w-4"})})]})]})]}),(0,a.jsxs)(o.CardFooter,{className:"pt-0 pb-4 flex gap-2",children:[(0,a.jsxs)(c.Button,{onClick:()=>{window.open(e.shareUrl,"_blank")},size:"sm",className:"flex-1 h-8 text-xs gap-1.5 bg-purple-600 hover:bg-purple-700 text-white",children:[(0,a.jsx)(ev,{className:"h-3.5 w-3.5"}),"View"]}),(0,a.jsx)(c.Button,{onClick:m,size:"sm",variant:"outline",className:"h-8 px-2.5 text-xs hover:bg-red-50 hover:text-red-700 hover:border-red-300",children:(0,a.jsx)(v.Trash2,{className:"h-3.5 w-3.5"})})]})]})}var eP=e.i(2380),eM=e.i(64312);function eD({items:e,renderItem:t,emptyMessage:s="No items to display",itemsPerPage:i=6}){let[n,l]=(0,r.useState)(1),o=Math.max(1,Math.ceil(e.length/i));(0,r.useEffect)(()=>{l(e=>Math.min(e,o))},[o]);let{startIndex:d,endIndex:m,currentItems:u}=(0,r.useMemo)(()=>{let t=(n-1)*i,a=t+i;return{startIndex:t,endIndex:a,currentItems:e.slice(t,a)}},[n,e,i]);return 0===e.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center gap-3 rounded-lg border border-dashed bg-muted/30 px-6 py-10 text-center",children:[(0,a.jsx)("div",{className:"relative h-24 w-24 text-muted-foreground",children:(0,a.jsxs)("svg",{viewBox:"0 0 120 120",className:"h-24 w-24","aria-hidden":"true",children:[(0,a.jsx)("defs",{children:(0,a.jsxs)("linearGradient",{id:"grid-ill",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,a.jsx)("stop",{offset:"0%",stopColor:"#9ca3af",stopOpacity:"0.2"}),(0,a.jsx)("stop",{offset:"100%",stopColor:"#3b82f6",stopOpacity:"0.35"})]})}),(0,a.jsx)("rect",{x:"14",y:"14",width:"92",height:"92",rx:"12",fill:"url(#grid-ill)"}),(0,a.jsx)("rect",{x:"32",y:"32",width:"56",height:"56",rx:"8",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeDasharray:"6 6"}),(0,a.jsx)("path",{d:"M52 60h16M60 52v16",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold tracking-tight",children:s}),(0,a.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Create or pull a project to get started."})]})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",children:u.map((e,a)=>t(e,d+a))}),o>1&&e.length>i&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 pt-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(c.Button,{variant:"outline",size:"sm",onClick:()=>{n>1&&l(n-1)},disabled:1===n,className:"gap-1.5",children:[(0,a.jsx)(eP.ChevronLeft,{className:"h-4 w-4"}),"Prev"]}),(0,a.jsx)("div",{className:"flex items-center gap-1",children:(()=>{let e=[];if(o<=5)for(let t=1;t<=o;t++)e.push(t);else{e.push(1),n>3&&e.push("...");let t=Math.max(2,n-1),a=Math.min(o-1,n+1);for(let r=t;r<=a;r++)e.push(r);n<o-2&&e.push("..."),e.push(o)}return e.map((e,t)=>"..."===e?(0,a.jsx)("span",{className:"px-2 text-muted-foreground",children:"..."},`ellipsis-${t}`):(0,a.jsx)(c.Button,{variant:n===e?"default":"outline",size:"sm",onClick:()=>{l(e)},className:"min-w-[2rem]",children:e},e))})()}),(0,a.jsxs)(c.Button,{variant:"outline",size:"sm",onClick:()=>{n<o&&l(n+1)},disabled:n===o,className:"gap-1.5",children:["Next",(0,a.jsx)(eM.ChevronRight,{className:"h-4 w-4"})]})]}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Showing ",d+1," to ",Math.min(m,e.length)," of ",e.length]})]})]})}var eS=e.i(60031),eE=e.i(89966);function eF({open:e,onOpenChange:t,onSuccess:s}){let[l,o]=(0,r.useState)(""),[d,m]=(0,r.useState)(!1),{createProject:h}=(0,i.useDexie)(),{toast:x}=(0,n.useToast)(),p=async()=>{if(!l.trim())return void x({title:"Project name required",description:"Please enter a project name",variant:"destructive"});m(!0);try{await h({structureName:l.trim(),isSynced:!1,syncedProjectId:"",isRemote:!1,isPublic:!1,publicSourceId:"",branches:{main:[]},commits:[{commitId:`initial-${Date.now()}`,commitName:"Initial commit",data:new ArrayBuffer(0),parent:null,createdAt:Date.now()}]}),x({title:"Project created",description:`${l} has been created successfully`,variant:"default"}),o(""),t(!1),s()}catch(e){x({title:"Create failed",description:e instanceof Error?e.message:"Failed to create project",variant:"destructive"})}finally{m(!1)}};return(0,a.jsx)(S.Dialog,{open:e,onOpenChange:t,children:(0,a.jsxs)(S.DialogContent,{className:"sm:max-w-md",children:[(0,a.jsxs)(S.DialogHeader,{children:[(0,a.jsxs)(S.DialogTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(eE.Folder,{className:"h-5 w-5"}),"Create New Project"]}),(0,a.jsx)(S.DialogDescription,{children:"Enter a name for your new project. It will be created locally with an initial empty commit."})]}),(0,a.jsx)("div",{className:"grid gap-4 py-4",children:(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(eS.Label,{htmlFor:"projectName",children:"Project Name"}),(0,a.jsx)(ej.Input,{id:"projectName",value:l,onChange:e=>o(e.target.value),onKeyPress:e=>{"Enter"===e.key&&!d&&l.trim()&&p()},placeholder:"Enter project name...",disabled:d,autoFocus:!0})]})}),(0,a.jsxs)(S.DialogFooter,{children:[(0,a.jsx)(c.Button,{variant:"outline",onClick:()=>t(!1),disabled:d,children:"Cancel"}),(0,a.jsx)(c.Button,{onClick:p,disabled:d||!l.trim(),className:"flex items-center gap-2",children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),"Creating..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u,{className:"h-4 w-4"}),"Create Project"]})})]})]})})}function eI(){let{user:e}=(0,s.useAuth)(),{localProjects:t,remoteProjects:m,sharedCommits:h,loading:x,refresh:p}=function(){let{user:e,isAuthenticated:t}=(0,s.useAuth)(),{getAllProjects:a,getDecryptedProject:o,getDecryptedProjects:c}=(0,i.useDexie)(),{toast:d}=(0,n.useToast)(),[m,u]=(0,r.useState)([]),[h,x]=(0,r.useState)([]),[p,f]=(0,r.useState)([]),[g,y]=(0,r.useState)(!0),b=e=>{let t=e.commits[e.commits.length-1];return{...e,latestCommit:t,commitCount:e.commits.length}},j=(0,r.useCallback)(async e=>{try{return await o(e)}catch(t){console.error(`Failed to get decrypted project ${e}:`,t),d({title:"Decryption Failed",description:"Failed to decrypt project data. Please ensure you are logged in with the correct account.",variant:"destructive"});return}},[o,d]),v=(0,r.useCallback)(async e=>{try{return await c(e)}catch(e){return console.error("Failed to get decrypted projects:",e),d({title:"Decryption Failed",description:"Failed to decrypt project data. Please ensure you are logged in with the correct account.",variant:"destructive"}),[]}},[c,d]),w=(0,r.useCallback)(async()=>{y(!0);try{let e=(await a()).map(b);if(u(e),t)try{let[e,t]=await Promise.all([(0,l.getRemoteStructures)(),(0,l.getMySharedCommits)()]);x(e),f(t)}catch(e){console.error("Failed to fetch remote data:",e),d({title:"Sync Error",description:"Failed to fetch remote projects. Using cached data.",variant:"destructive"})}else x([]),f([])}catch(e){console.error("Failed to refresh library data:",e),d({title:"Library Error",description:"Failed to load library data. Please try again.",variant:"destructive"})}finally{y(!1)}},[a,t]);return(0,r.useEffect)(()=>{w()},[w]),(0,r.useEffect)(()=>{w()},[e,w]),{localProjects:m,remoteProjects:h,sharedCommits:p,loading:g,refresh:w,getDecryptedProjectData:j,getDecryptedProjectsData:v}}(),[f,g]=(0,r.useState)(!1),y=new Set(t.filter(e=>e.syncedProjectId).map(e=>e.syncedProjectId)),b=m.filter(e=>!y.has(e.id)),j=new Map(m.map(e=>[e.id,e])),v=[...t,...b];return(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-4xl font-bold tracking-tight font-headline text-gray-900",children:"Library"}),(0,a.jsx)("p",{className:"text-base text-gray-600 mt-2 max-w-lg",children:"Manage your oxDNA projects, sync with the cloud, and share with others"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(c.Button,{variant:"outline",size:"icon",onClick:p,disabled:x,className:"hover:bg-slate-100",children:(0,a.jsx)(d.RefreshCw,{className:`h-5 w-5 ${x?"animate-spin":""}`})}),(0,a.jsxs)(c.Button,{onClick:()=>g(!0),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[(0,a.jsx)(u,{className:"mr-2 h-5 w-5"}),"Create New"]})]})]}),(0,a.jsxs)(o.Card,{className:"border-0 shadow-sm",children:[(0,a.jsxs)(o.CardHeader,{className:"border-b border-slate-200 bg-gradient-to-r from-slate-50 to-white",children:[(0,a.jsx)(o.CardTitle,{className:"text-xl",children:"Projects"}),(0,a.jsx)(o.CardDescription,{children:"Your local projects and synced projects from the cloud"})]}),(0,a.jsx)(o.CardContent,{className:"pt-6",children:(0,a.jsx)(eD,{items:v,renderItem:e=>"commits"in e?(0,a.jsx)(ey,{project:e,onRefresh:p,remoteProject:e.syncedProjectId?j.get(e.syncedProjectId):void 0},e.id):(0,a.jsx)(eb,{project:e,onRefresh:p},e.id),emptyMessage:"No projects found. Create a new project or log in to see synced projects."})})]}),e&&(0,a.jsxs)(o.Card,{className:"border-0 shadow-sm",children:[(0,a.jsxs)(o.CardHeader,{className:"border-b border-slate-200 bg-gradient-to-r from-slate-50 to-white",children:[(0,a.jsx)(o.CardTitle,{className:"text-xl",children:"Shared by Me"}),(0,a.jsx)(o.CardDescription,{children:"Individual commits you've shared via unique links"})]}),(0,a.jsx)(o.CardContent,{className:"pt-6",children:(0,a.jsx)(eD,{items:h,renderItem:e=>(0,a.jsx)(ek,{commit:e,onRefresh:p},e.commitId),emptyMessage:"No shared commits found"})})]}),(0,a.jsx)(eF,{open:f,onOpenChange:g,onSuccess:p})]})}e.s(["default",()=>eI],51462)}]);